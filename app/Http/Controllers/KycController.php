<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use GuzzleHttp\Client;
use GuzzleHttp\Exception\RequestException;
use GuzzleHttp\Exception\BadResponseException;
use GuzzleHttp\Exception\ClientException;
use GuzzleHttp\Psr7;
use Exception;
use Auth;
use App\Models\ApiMaster;
use App\Models\SchemeMaster;
use App\Models\UserSchemeMaster;
use App\Models\HitCountMaster;
use App\Models\SchemeTypeMaster;
use App\Models\User;
use App\Models\Rcfull;
use App\Models\Crif;
use Illuminate\Support\ViewErrorBag;
use Redirect;
use File;
use Barryvdh\DomPDF\Facade\Pdf;
use DOMDocument;
use App\Models\Transaction;
use Carbon\Carbon;
use DB;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Facades\Http;
// use Illuminate\Support\Facades\Str;
use Illuminate\Support\Str;
use Illuminate\Http\Request as HttpRequest;
class KycController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
    }

    private $crif_url = "https://loantap.in/affiliate/apiv1-1/docboyz/crif";

    private $sandbox_url = 'https://sandbox.flowboard.in/api/v1';
    // private $sandbox_token = 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2MjUzOTIyMTYsImp0aSI6IjhkOWZmNTFiLTJiYmItNDc4My1iYmI5LTg5ZWMzNGY3MDNmZiIsImlkZW50aXR5IjoiZGV2LmRvY2JveXpAYWFkaGFhcmFwaS5pbyIsImZyZXNoIjpmYWxzZSwiaWF0IjoxNTkzODU2MjE2LCJuYmYiOjE1OTM4NTYyMTYsInVzZXJfY2xhaW1zIjp7InNjb3BlcyI6WyJyZWFkIl19LCJ0eXBlIjoiYWNjZXNzIn0.f0Ea5UmL_DQsSCBF6sWJzU-n7NPT9TL_IkKFY_a-3KQ';
    private $sandbox_token = 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTYyNTczNDU2MCwianRpIjoiMDE2OWRmYTctNWY3Yi00OTZhLWI3Y2MtMjZhNmExNDZiMjdlIiwidHlwZSI6ImFjY2VzcyIsImlkZW50aXR5IjoiZGV2LmRvY2JveXpAYWFkaGFhcmFwaS5pbyIsIm5iZiI6MTYyNTczNDU2MCwiZXhwIjoxOTQxMDk0NTYwLCJ1c2VyX2NsYWltcyI6eyJzY29wZXMiOlsicmVhZCJdfX0.XCjAFtZlAqWySAGf-2-TP6ICs-6z9Xpoi33l8UqUywg';
    private $base_url = 'https://kyc-api.flowboard.in/api/v1';
    private $token = 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MDI3Njc0NDUsIm5iZiI6MTYwMjc2NzQ0NSwianRpIjoiNzRjNzRmNjMtNGZhNS00N2I0LTkxYmYtNjcyYjZiMmRjNzYyIiwiZXhwIjoxOTE4MTI3NDQ1LCJpZGVudGl0eSI6ImRldi5kb2Nib3l6QGZsb3dib2FyZC5pbiIsImZyZXNoIjpmYWxzZSwidHlwZSI6ImFjY2VzcyIsInVzZXJfY2xhaW1zIjp7InNjb3BlcyI6WyJyZWFkIl19fQ.2vNK9AhqCAk5Vz3K9rAZ_YtxIzTLoxK8zejh-ES4Meo';

    public function saveHitCount($user_id, $api_id, $remark, $statusCode)
    {
        // dd($statusCode);
        $cnt200 = 0;
        $cnt400 = 0;
        $cnt101 = 0;
        $payableHits = 0;
        $scheme_price = 0;
        $total_amount = 0;
        $updateHitCount = UserSchemeMaster::where('user_id', $user_id)->where('api_id', $api_id)->orderBy('id', 'desc')->first();
        $payment_slab = explode(',', $updateHitCount->payment_slab);
        $scheme_prices = explode(',', $updateHitCount->scheme_price);
        // $transactions = Transaction::where('user_id', $user_id)->where('api_id',$api_id)->where('hit_year_month', date('Y-m'))->get();
        $transactions = Transaction::where('user_id', $user_id)->where('api_id', $api_id)->where('hit_year_month', date('Y-m'))->count();
        if ($transactions) {
            // for($i=0; $i<count($transactions);$i++){
            //     if($transactions[$i]['status_code'] == 102){
            //         $cnt400++;
            //     }else if($transactions[$i]['status_code'] == 200){
            //         $cnt200++;
            //     }else if($transactions[$i]['status_code'] == 101){
            //         $cnt101++;
            //     }
            // }
            // $payableHits = $cnt200 + $cnt400 + $cnt101;
            $payableHits = $transactions;

            for ($i = 0; $i < count($payment_slab); $i++) {
                if ($i == (count($payment_slab) - 1)) {
                    if ($payableHits <= $payment_slab[$i]) {
                        $scheme_price = $scheme_prices[$i];
                        $total_amount = $payableHits * $scheme_prices[$i];
                    } else {
                        $scheme_price = $scheme_prices[$i];
                        $total_amount = $payableHits * $scheme_prices[$i];
                    }
                    break;
                } else {
                    if ($payableHits <= $payment_slab[$i]) {
                        $scheme_price = $scheme_prices[$i];
                        $total_amount = $payableHits * $scheme_prices[$i];
                        break;
                    }
                }
            }
        } else {
            $scheme_price = $scheme_prices[0];
            $total_amount = $scheme_prices[0];
        }

        $updateHitCount->update([
            'total_transaction_amount_per_api' => $total_amount
        ]);

        $addHitCount = new HitCountMaster;
        $addHitCount->user_id = $user_id;
        $addHitCount->api_id = $api_id;
        $addHitCount->scheme_price = $scheme_price;
        $addHitCount->hit_year_month = date('Y-m');
        $addHitCount->hit_count = 1;
        $addHitCount->save();
        // dd($statusCode);
        $this->update_wallet_balance($user_id, $scheme_price);
        $this->update_transaction($user_id, $api_id, $scheme_price, $remark, $statusCode);
    }

    public function update_wallet_balance($user_id, $amount)
    {
        $userwallet = User::where('id', $user_id)->first();
        $subusercount = User::where('subparent_id', $user_id)->Where('subparent_id','!=', 1)->count();

        if($userwallet->subparent_id !=1 || $subusercount > 0){

            if($subusercount > 0){
            // return '$finalamountsss';
                $finalamount = $userwallet->wallet_amount - $amount;
                $userwallet->wallet_amount = $finalamount;
                $userwallet->save();
                $updatewalletbalance = User::where('subparent_id', $user_id)->update(['wallet_amount' =>$finalamount]);

            }
            else{
                // return 
                $finalamount = $userwallet->wallet_amount - $amount;
                $subparent = $userwallet->subparent_id;
              
                // $userwallet->wallet_amount = $finalamount;
                // $userwallet->save();

                $updatewalletbalance = User::where('subparent_id', $subparent)->update(['wallet_amount' =>$finalamount]);
                $updatewalletbalanceparent = User::where('id', $subparent)->update(['wallet_amount' =>$finalamount]);
                

            }
           


        }
        else{

            $userwallet->wallet_amount = $userwallet->wallet_amount - $amount;
            $userwallet->save();

        }
        
    }
    
    public function transaction_id()
    {
        $str_result = '1234567890';
        $transaction_gen = substr(str_shuffle($str_result), 0, 12);

        $transaction = Transaction::where('transaction_id', $transaction_gen)->first();
        if ($transaction) {
            $transaction_gen = substr(str_shuffle($str_result), 0, 12);
        }

        return $transaction_gen;
    }

    public function update_transaction($user_id, $api_id, $amount, $remark, $statusCode)
    {
        // dd($statusCode);
        // $transaction = new Transaction;
        // $transaction->transaction_id = $this->transaction_id();
        // $transaction->user_id = Auth()->user()->id;
        // $transaction->api_id = $api_id; //work
        // $transaction->type_creditdebit = 'Debit';
        // $transaction->scheme_price = $amount;  //work
        // if ($statusCode == 200) {
        //     $transaction->status = 'Success';
        // } else {
        //     $transaction->status = 'Failed';
        // }
        // $transaction->status_code = $statusCode;
        // // $transaction->status = 'Success';
        // $transaction->amount = $amount;
        // $transaction->remark = $remark;
        // $transaction->updated_balance = Auth()->user()->wallet_amount - $amount;
        // $transaction->save();
        $user_id = Auth()->user()->id;
        $user = User::where('id', $user_id)->first();
        $transaction = new Transaction;
        $transaction->transaction_id = $this->transaction_id();
        $transaction->user_id = $user_id;
        $transaction->api_id = $api_id; //work
        $transaction->type_creditdebit = 'Debit';
        $transaction->hit_year_month = date('Y-m');
        $transaction->scheme_price = $amount;  //work
        if ($statusCode == 200) {
            $transaction->status = 'Success';
        } else {
            $transaction->status = 'Failed';
        }
        $transaction->status_code = $statusCode;
        $transaction->amount = $amount;
        $transaction->remark = $remark;
        if ($statusCode != 500) {
            $transaction->updated_balance = $user->wallet_amount - $amount;
            $user->wallet_amount -= $amount;
        } else {
            $transaction->updated_balance = $user->wallet_amount;
        }
        // dd($transaction);
        $transaction->save();
        $user->save();
    }

    // public function update_wallet_balance($amount)
    // {
    //     $userwallet = User::where('id', Auth()->user()->id)->first();
    //     // $userwallet->wallet_amount = $userwallet->wallet_amount - $amount;
    //     $userwallet->wallet_amount = $userwallet->wallet_amount;
    //     $userwallet->save();
    // }

    // public function pancard(Request $request) {
    //     $statusCode = null;
    //     $pancard = null;
    //     $hit_limits_exceeded = 0;
    //     $low_wallet_balance = 0;

    //     if($request->isMethod('GET')){
    //         return view('kyc.pancard', compact('pancard', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));
    //     }
    //     if($request->isMethod('POST')){
    //         $client = new Client();
    //         // $headers = [
    //         //     'Authorization' => $this->token,        
    //         //     'Accept'        => 'application/json',
    //         // ];

    //         // $body =  [
    //         //     'id_number' => $request->pan_number
    //         // ];
    //         $accessToken = Auth::user()->access_token;

    //         $headers = [
    //             'AccessToken' => $accessToken,
    //         ];
    //        $body =  [
    //         'pan_number' => $request->pan_number
    //         ];
    //         if(Auth::user()->scheme_type!='demo') {
    //             if(Auth::user()->role_id==1) {
    //                 $apiamster = ApiMaster::where('api_slug','pancard')->first();
    //                 if($apiamster)
    //                     $api_id = $apiamster->id;
    //             }
    //             // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
    //             try{//dd($body);
    //                 $res = $client->post('http://regtechapi.in/api/pancard',['headers' => $headers, 'json' => $body]);

    //                 $pancard = json_decode($res->getBody(), true);
    //                 return  $pancard;
    //             //   return $pancard[0]['pancard'];
    //                 if(isset($pancard[0]['statusCode'])){
    //                     $statusCode = $pancard[0]['statusCode'];
    //                 }
    //             } catch(BadResponseException $e) {
    //                 $statusCode = $e->getResponse()->getStatusCode();
    //                 if($statusCode == 500){
    //                     $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
    //                 }else if($statusCode == 422){
    //                     $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
    //                 }else{
    //                     $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
    //                 }
    //                 return view('kyc.pancard', compact('statusCode','errorMessage'));
    //             }
    //         } else {
    //             $scheme_type = SchemeTypeMaster::where('id',Auth::user()->scheme_type_id)->first();
    //             $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
    //             if($hit_count_remaining>0)
    //             {
    //                 try{
    //                 $res = $client->post('http://regtechapi.in/api/pancard',['headers' => $headers, 'json' => $body]);
    //                     $pancard = json_decode($res->getBody(), true);
    //                     $user = User::where('id',Auth::user()->id)->first();
    //                     $user->scheme_hit_count = $user->scheme_hit_count+1;
    //                     $user->save();
    //                 } catch(BadResponseException $e) {
    //                     $statusCode = $e->getResponse()->getStatusCode();
    //                     if($statusCode == 500){
    //                         $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
    //                     }else if($statusCode == 422){
    //                         $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
    //                     }else{
    //                         $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
    //                     }
    //                     return view('kyc.pancard', compact('statusCode','errorMessage'));
    //                 }
    //             } else {
    //                 $hit_limits_exceeded = 1;

    //                 return view('kyc.pancard', compact('pancard', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));
    //             }
    //         }
    //     }

    //     return view('kyc.pancard', compact('pancard', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));
    // }

    public function pancard(Request $request)
    {
        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.pancard', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pan_number' => $request->pan_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pancard')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/pancard', ['headers' => $headers, 'json' => $body]);
                    $pancard = json_decode($res->getBody(), true);
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.pancard', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/pancard', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();

                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.pancard', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.pancard', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        if($pancard['statusCode'] == 200){
              $pdf = Pdf::loadView('kyc.pancardvalidation_pdf', [
                'pancard' => $pancard
            ]);
          return $pdf->download('pancardvalidation.pdf');
        //   return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }

        return view('kyc.pancard', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    // public function pancard_details(Request $request) {

    //     $statusCode = null;
    //     $pancard = null;
    //     $hit_limits_exceeded = 0;
    //     $low_wallet_balance = 0;

    //     if($request->isMethod('GET')){
    //         return view('kyc.pandetails', compact('pancard', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));
    //     }

    //     if($request->isMethod('POST')){
    //         $client = new Client();

    //         // $headers = [
    //         //     'Authorization' => $this->token,        
    //         //     'Accept'        => 'application/json',
    //         // ];

    //         // $body =  [
    //         //     'id_number' => $request->pan_number
    //         // ];
    //         $accessToken = Auth::user()->access_token;

    //         $headers = [
    //             'AccessToken' => $accessToken,
    //         ];
    //        $body =  [
    //         'pan_number' => $request->pan_number
    //         ];
    //         if(Auth::user()->scheme_type!='demo') {
    //             if(Auth::user()->role_id==1) {
    //                 $apiamster = ApiMaster::where('api_slug','pancard')->first();
    //                 if($apiamster)
    //                     $api_id = $apiamster->id;
    //             }
    //             // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
    //             try{//dd($body);
    //                 $res = $client->post('http://regtechapi.in/api/pancard_details',['headers' => $headers, 'json' => $body]);

    //                 $pancard = json_decode($res->getBody(), true);
    //                 // dd($pancard);
    //                 if(isset($pancard[0]['pancard']['code'])){
    //                     $statusCode = $pancard[0]['pancard']['code'];
    //                 }
    //             } catch(BadResponseException $e) {
    //                 $statusCode = $e->getResponse()->getStatusCode();
    //                 if($statusCode == 500){
    //                     $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
    //                 }else if($statusCode == 422){
    //                     $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
    //                 }else{
    //                     $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
    //                 }
    //                 return view('kyc.pandetails', compact('statusCode','errorMessage'));
    //             }
    //         } else {

    //             $scheme_type = SchemeTypeMaster::where('id',Auth::user()->scheme_type_id)->first();
    //             $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
    //             // dd($hit_count_remaining);
    //             if($hit_count_remaining>0)
    //             {

    //                 try{
    //                     // dd('$hit_count_remaining try21');
    //                     $res = $client->post('http://regtechapi.in/api/pancard_details',['headers' => $headers, 'json' => $body]);
    //                     $pancard = json_decode($res->getBody(), true);
    //                     // dd($pancard);
    //                     $user = User::where('id',Auth::user()->id)->first();
    //                     $user->scheme_hit_count = $user->scheme_hit_count+1;
    //                     $user->save();
    //                 } catch(BadResponseException $e) {
    //                     $statusCode = $e->getResponse()->getStatusCode();
    //                     if($statusCode == 500){
    //                         $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
    //                     }else if($statusCode == 422){
    //                         $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
    //                     }else{
    //                         $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
    //                     }
    //                     return view('kyc.pandetails', compact('statusCode','errorMessage'));
    //                 }
    //             } else {
    //                 $hit_limits_exceeded = 1;

    //                 return view('kyc.pandetails', compact('pancard', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));
    //             }
    //         }
    //     }

    //     return view('kyc.pandetails', compact('pancard', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));
    // }
    public function pancard_details(Request $request)
    {

        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.pandetails', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }

        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pan_number' => $request->pan_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 't11';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pandetails1')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/pancard_details', ['headers' => $headers, 'json' => $body]);

                    $pancard = json_decode($res->getBody(), true);
                    // return $pancard;
                    if (isset($pancard[0]['pancard']['code'])) {
                        $statusCode = $pancard[0]['pancard']['code'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.pandetails', compact('statusCode', 'errorMessage'));
                }
            } else {
                //    return 't2';
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {

                    try {

                        $res = $client->post('http://regtechapi.in/api/pancard_details', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.pandetails', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.pandetails', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
          if($pancard['statusCode'] == 200){
            // return $pancard;
              $pdf = Pdf::loadView('kyc.pandetails_pdf', [
                'pancard' => $pancard
            ]);
          return $pdf->download('pandetails.pdf');
        //   return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }

        return view('kyc.pandetails', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
    //pan upload api implementation
    public function pancard_upload(Request $request)
    {
        // return 'ok'; 
        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $pancard2 = null;

        if ($request->isMethod('GET')) {
            $client = new Client();
            return view('kyc.pancard_upload', compact('pancard', 'pancard2', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            //checking if file exists or not
            if (!$request->hasFile('file')) {
                return json_encode(['message' => "file not found"], true);
            }

            $accessToken = Auth::user()->access_token;
            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                CURLOPT_URL => "http://regtechapi.in/api/panupload", //"https://kyc-api.flowboard.in/api/v1/pan/pan-upload",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                ),
                CURLOPT_HTTPHEADER => array(
                    "AccessToken: " . $accessToken,
                ),
            ));
            // $get_data1 = curl_exec($curl1);
            $result = curl_exec($curl1);
            $pancard = json_decode($result, true);
            // return $pancard;
            $statusCode = '';
            if (isset($pancard[0]['statusCode'])) {
                $statusCode = $pancard[0]['statusCode'];
            }
            $pan_verified = 0;
            $pancard2 = null;
            if ($statusCode == 200) {
                $pan_no = $pancard[0]['pancard']['pan_number'];
                $client = new Client();

                $headers = [
                    'AccessToken' => $accessToken,
                ];
                $body = [
                    'pan_number' => $pan_no
                ];
                try {
                    //$res = $client->post($this->base_url.'/pan/pan', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/pancard', ['headers' => $headers, 'json' => $body]);
                    $pancard2 = json_decode($res->getBody(), true);
                    // return $pancard2[0]['pancard'];
                    if ($pancard2[0]['statusCode'] == 200)
                        $pan_verified = 1;
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $pan_verified = 0;
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.pancard_upload', compact('statusCode', 'errorMessage'));
                }
            }
            return view('kyc.pancard_upload', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'pan_verified', 'pancard2'));
        }
    }

    public function searchkyc(Request $request)
    {
        //    return 'ok';
        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.searchkyc', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }


        if ($request->isMethod('POST')) {
            // return $request->dob;
            $client = new Client();

            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->pan_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pano' => $request->pan_number,
                'dob' => $request->dob
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'searchkyc')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/ckycSearchfull', ['headers' => $headers, 'json' => $body]);

                    $pancard = json_decode($res->getBody(), true);
                    return $pancard;
                    // dd($pancard['response']['kycDetails']['personalIdentifiableData']);
                    if (isset($pancard['statusCode'])) {
                        // dd($pancard['statusCode']);
                        $statusCode = $pancard['statusCode'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.searchkyc', compact('statusCode', 'errorMessage'));
                }
            } else {

                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // dd($hit_count_remaining);
                if ($hit_count_remaining > 0) {

                    try {
                        // dd('$hit_count_remaining try21');
                        $res = $client->post('http://regtechapi.in/api/ckycSearch', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        // dd($pancard);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.searchkyc', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.searchkyc', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.searchkyc', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function searchkyclite(Request $request)
    {

        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.searchkyclite', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }


        if ($request->isMethod('POST')) {
            // return $request->dob;
            $client = new Client();

            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->pan_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pano' => $request->pan_number,
                'dob' => $request->dob
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pancard')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/search', ['headers' => $headers, 'json' => $body]);

                    $pancard = json_decode($res->getBody(), true);
                    // dd($pancard['response']['kycDetails']['personalIdentifiableData']);
                    if (isset($pancard['statusCode'])) {
                        // dd($pancard['statusCode']);
                        $statusCode = $pancard['statusCode'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.searchkyclite', compact('statusCode', 'errorMessage'));
                }
            } else {

                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // dd($hit_count_remaining);
                if ($hit_count_remaining > 0) {

                    try {
                        // dd('$hit_count_remaining try21');
                        $res = $client->post('http://regtechapi.in/api/search', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        // dd($pancard);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.searchkyclite', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.searchkyclite', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.searchkyclite', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function ckycsearchdata(Request $request)
    {
        // return 'test';

        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.ckycsearchdata', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }


        if ($request->isMethod('POST')) {
            // return $request->dob;
            $client = new Client();

            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->pan_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pano' => $request->pan_number,
                'dob' => $request->dob
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'ckycsearch')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/ckycSearch', ['headers' => $headers, 'json' => $body]);

                    $pancard = json_decode($res->getBody(), true);
                    // return $pancard;
                    // dd($pancard['response']['kycDetails']['personalIdentifiableData']);
                    if (isset($pancard['statusCode'])) {
                        // dd($pancard['statusCode']);
                        $statusCode = $pancard['statusCode'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.ckycsearchdata', compact('statusCode', 'errorMessage'));
                }
            } else {

                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // dd($hit_count_remaining);
                if ($hit_count_remaining > 0) {

                    try {
                        // dd('$hit_count_remaining try21');
                        $res = $client->post('http://regtechapi.in/api/ckycSearch', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        // dd($pancard);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.ckycsearchdata', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.ckycsearchdata', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.ckycsearchdata', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function ckycdownload(Request $request)
    {
        // return 'download test';

        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.ckycdownload', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }


        if ($request->isMethod('POST')) {
            // return $request->dob;
            $client = new Client();

            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->pan_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pano' => $request->pan_number,
                'dob' => $request->dob,
                'ckycid' => $request->ckycid
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'ckycdownload')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/ckycDownload', ['headers' => $headers, 'json' => $body]);

                    $pancard = json_decode($res->getBody(), true);
                    // return $pancard;
                    // dd($pancard['response']['kycDetails']['personalIdentifiableData']);
                    if (isset($pancard['statusCode'])) {
                        // dd($pancard['statusCode']);
                        $statusCode = $pancard['statusCode'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.ckycdownload', compact('statusCode', 'errorMessage'));
                }
            } else {

                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // dd($hit_count_remaining);
                if ($hit_count_remaining > 0) {

                    try {
                        // dd('$hit_count_remaining try21');
                        $res = $client->post('http://regtechapi.in/api/ckycDownload', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        // dd($pancard);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.ckycdownload', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.ckycdownload', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.ckycdownload', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }


    public function aadhaar_validation(Request $request)
    {
        $statusCode = null;
        $aadhaar_validation = null;
        $hit_limits_exceeded = 0;
        $api_id = '';

        if ($request->isMethod('GET')) {

            return view('kyc.aadhaar_validation', compact('aadhaar_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'aadhaar_number' => $request->aadhaar_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'aadhaar')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }


                try {
                    $res = $client->post('http://regtechapi.in/api/aadhaar_validation', ['headers' => $headers, 'json' => $body]);
                    //$this->base_url.'/aadhaar-validation/aadhaar-validation'
                    $aadhaar_validation = json_decode($res->getBody(), true);
                    if (isset($aadhaar_validation[0]['aadhaar_validation']['status']['statusCode'])) {
                        $statusCode = $aadhaar_validation[0]['aadhaar_validation']['status']['statusCode'];
                    }

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.aadhaar_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/aadhaar_validation', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/aadhaar-validation/aadhaar-validation', ['headers' => $headers, 'json' => $body]);
                        $aadhaar_validation = json_decode($res->getBody(), true);

                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.aadhaar_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.aadhaar_validation', compact('aadhaar_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        return view('kyc.aadhaar_validation', compact('aadhaar_validation', 'statusCode', 'hit_limits_exceeded'));
    }


    public function passportverify(Request $request)
    {
        // return 'true';
        $statusCode = null;
        $passportverify = null;
        $hit_limits_exceeded = null;
        if ($request->isMethod('GET'))
            return view('kyc.passportverify', compact('passportverify', 'statusCode', 'hit_limits_exceeded'));

        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $json = [
                'id_number' => $request->id_number,
                'dob' => $request->dob
            ];

            $client = new Client();

            if (Auth::user()->scheme_type != "demo") {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'passportverify')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }


                try {
                    $res = $client->post('http://regtechapi.in/api/passport_verification', ['headers' => $headers, 'json' => $json, 'verify' => false]);
                    $passportverify = json_decode($res->getBody(), true);
                    $statusCode = 200;
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.passportverify', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/passport_verification', ['headers' => $headers, 'json' => $json, 'verify' => false]);
                        $passportverify = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.passportverify', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.passportverify', compact('passportverify', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
    //    return $passportverify;
         if($passportverify['statusCode'] == 200){
              $pdf = Pdf::loadView('kyc.passport_details_pdf', [
                'passportverify' => $passportverify
            ]);
          return $pdf->download('passportverify.pdf');
          return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        return view('kyc.passportverify', compact('passportverify', 'statusCode', 'hit_limits_exceeded'));
    }


    //aadhaar upload api implementation
    public function aadhaar_upload(Request $request)
    {
        $statusCode = null;
        $aadhaar = null;
        $hit_limits_exceeded = 0;
        $aadhaarOCR = null;

        if ($request->isMethod('GET')) {
            return view('kyc.aadhaar_upload', compact('aadhaar', 'aadhaarOCR', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // dd($request->all());
            //checking if file exists or not
            if (!$request->hasFile('file')) {
                return json_encode(['message' => "file not found"], true);
            }


            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                // CURLOPT_URL => "https://kyc-api.flowboard.in/api/v1/aadhaar/upload/eaadhaar",
                CURLOPT_URL => "http://regtechapi.in/api/aadhaar_upload", //"https://sandbox.flowboard.in/api/v1/ocr/aadhaar",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                    // "base64" => "",
                    // "yob" => "",
                    // "full_name" => ""
                ),
                CURLOPT_HTTPHEADER => array(
                    "Authorization: " . $this->sandbox_token,
                ),
            ));
            // $get_data1 = curl_exec($curl1);
            $result = curl_exec($curl1);
            $aadhaarOCR = json_decode($result, true);
            //dd($aadhaarOCR);
            $statusCode = isset($aadhaarOCR['status_code']) ? $aadhaarOCR['status_code'] : null;
            $aadhaar_number = null;
            if ($aadhaarOCR['data']['ocr_fields']) {
                $aadhaar_number = $aadhaarOCR['data']['ocr_fields'][0]['aadhaar_number']['value'];
            }

            if ($aadhaar_number) {
                $client = new Client();
                // $headers = [
                //     'Authorization' => $this->token,        
                //     'Accept'        => 'application/json',
                // ];
                // $body =  [
                //     'id_number' => $aadhaar_number
                // ];
                $accessToken = Auth::user()->access_token;

                $headers = [
                    'AccessToken' => $accessToken,
                ];
                $body = [
                    'aadhaar_number' => $aadhaar_number
                ];
                try {
                    $res = $client->post('http://regtechapi.in/api/aadhaar_validation', ['headers' => $headers, 'json' => $body]);
                    //$res = $client->post($this->base_url.'/aadhaar-validation/aadhaar-validation', ['headers' => $headers, 'json' => $body]);
                    $aadhaar = json_decode($res->getBody(), true);
                    //dd($aadhaar);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.aadhaar_upload', compact('statusCode', 'errorMessage'));
                }
            }
            return view('kyc.aadhaar_upload', compact('aadhaar', 'aadhaarOCR', 'statusCode', 'hit_limits_exceeded'));
        }
    }



    // Aadhar OTP Genrate

    public function aadhaar_otp_genrate(Request $request)
    {
        $statusCode = null;
        $aadhaar_otp_genrate = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.aadhaar_otp_genrate', compact('aadhaar_otp_genrate', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'aadhar_number' => $request->aadhaar_number
            // ];

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'aadhaar_number' => $request->aadhaar_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'aadhaar')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    $res = $client->post('http://regtechapi.in/api/aadhaar_otp_genrate', ['headers' => $headers, 'json' => $body]);
                    //$res = $client->post($this->base_url.'/aadhaar-v2/generate-otp', ['headers' => $headers, 'json' => $body]);
                    $aadhaar_otp_genrate = json_decode($res->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.aadhaar_otp_genrate', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/aadhaar_otp_genrate', ['headers' => $headers, 'json' => $body]);
                        // $res = $client->post($this->base_url.'/aadhaar-v2/generate-otp', ['headers' => $headers, 'json' => $body]);
                        $aadhaar_otp_genrate = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.aadhaar_otp_genrate', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.aadhaar_otp_genrate', compact('aadhaar_otp_genrate', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // return $aadhaar_otp_genrate['data']['request_id'];
        return view('kyc.aadhaar_otp_genrate', compact('aadhaar_otp_genrate', 'statusCode', 'hit_limits_exceeded'));
    }


    // aadhar OTP Submit


    public function aadhaar_otp_submit(Request $request)
    {
        $statusCode = null;
        $aadhaar_otp_submit = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.aadhaar_otp_submit', compact('aadhaar_otp_submit', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'client_id' => $request->client_id,
            //     'otp' => $request->otp
            // ];

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'client_id' => $request->client_id,
                'otp' => $request->otp
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'aadhaar')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    $res = $client->post('http://regtechapi.in/api/aadhaar_otp_submit', ['headers' => $headers, 'json' => $body]);
                    // $res = $client->post($this->base_url.'/aadhaar-v2/submit-otp', ['headers' => $headers, 'json' => $body]);
                    $aadhaar_validation = json_decode($res->getBody(), true);
                    //dd($aadhaar_validation);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.aadhaar_otp_submit', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/aadhaar_otp_submit', ['headers' => $headers, 'json' => $body]);
                        // $res = $client->post($this->base_url.'/aadhaar-v2/submit-otp', ['headers' => $headers, 'json' => $body]);
                        $aadhaar_validation = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.aadhaar_otp_submit', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.aadhaar_otp_submit', compact('aadhaar_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // dd($aadhaar_validation);

        // 
        //    $pdf = Pdf::loadView('kyc.aadhaar_pdf', compact('aadhaar_validation'));
        // return  $aadhaar_validation;
        if($aadhaar_validation['status'] == 200){
                    $pdf = Pdf::loadView('kyc.aadhaar_pdf', [
                        'aadhaar_validation' => $aadhaar_validation
                    ]);
                return $pdf->download('  -.pdf');
                // return view('kyc.aadhaar_otp_submit', compact('aadhaar_validation', 'statusCode', 'hit_limits_exceeded'));
        }
         return view('kyc.aadhaar_otp_submit', compact('aadhaar_validation', 'statusCode', 'hit_limits_exceeded'));
    }
          

    // aadhar masking python intigration needed

    public function aadhaar_masking(Request $request)
    {
        $statusCode = null;
        $aadhaar_masking = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.aadhaar_masking', compact('aadhaar_masking', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            if (!$request->hasFile('file')) {
                return json_encode(['message' => "file not found"], true);
            }

            $accessToken = Auth::user()->access_token;

            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                CURLOPT_URL => "http://regtechapi.in/api/aadhaar_masking",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                    // "file_back" => new \CURLFILE($_FILES['file_back']['tmp_name'], $_FILES['file_back']['type'], $_FILES['file_back']['name']),
                ),
                CURLOPT_HTTPHEADER => array(
                    "AccessToken: " . $accessToken,
                ),
            ));

            $result = curl_exec($curl1);
            $aadhaar_masking = json_decode($result, true);

            
            
            // if($aadhaar_masking){
            //     $pdf = Pdf::loadView('kyc.aadhaar_masking_pdf', [
            //         'aadhaar_masking' => $aadhaar_masking
            //     ]);
            // }
            // else{
            // return 'Service Down';
            // }
            // return $aadhaar_masking[0]['aadhaar_masked_details']['files'][0]['masked_image_base64'];
            // return $aadhaar_masking[0]['aadhaar_masked_details']['masked_image_base64'];

        }
        return view('kyc.aadhaar_masking', compact('aadhaar_masking', 'statusCode', 'hit_limits_exceeded'));
    }

    // Voter id  Validation 

        public function voter_validation(Request $request)
    {
        $statusCode = null;
        $voter_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.voter_validation', compact('voter_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            $body = [
                'voter_number' => $request->voter_number
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'voter_id')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/voter_validation', ['headers' => $headers, 'json' => $body]);
                    $voter_validation = json_decode($res->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.voter_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/voter_validation', ['headers' => $headers, 'json' => $body]);
                        $voter_validation = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.voter_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.voter_validation', compact('voter_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        if(isset($voter_validation[0]['statusCode'])){
                $pdf = Pdf::loadView('kyc.voter_validation_pdf', [
                'voter_validation' => $voter_validation
            ]);
           return $pdf->download('voter_validation.pdf');
        }
        // dd($voter_validation[0]['statusCode']);
        return view('kyc.voter_validation', compact('voter_validation', 'statusCode', 'hit_limits_exceeded'));
    }

    
    public function voter_validation18agust2025(Request $request)
    {
        $statusCode = null;
        $voter_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.voter_validation', compact('voter_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            $body = [
                'voter_number' => $request->voter_number
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'voter_id')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/voter_validation', ['headers' => $headers, 'json' => $body]);
                    $voter_validation = json_decode($res->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.voter_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/voter_validation', ['headers' => $headers, 'json' => $body]);
                        $voter_validation = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.voter_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.voter_validation', compact('voter_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // dd($voter_validation[0]['statusCode']);
        return view('kyc.voter_validation', compact('voter_validation', 'statusCode', 'hit_limits_exceeded'));
    }

    //voter upload api implementation
    public function voter_upload(Request $request)
    {
        $statusCode = null;
        $voter = null;
        $voterocr = null;
        $hit_limits_exceeded = 0;
        $voter_detailed_info = null;
        $isValid = 0;


        if ($request->isMethod('GET')) {
            return view('kyc.voter_upload', compact('voter', 'voter_detailed_info', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            //checking if file exists or not
            if (!$request->hasFile('file')) {
                return json_encode(['message' => "file not found"], true);
            }

            $accessToken = Auth::user()->access_token;

            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                CURLOPT_URL => "http://regtechapi.in/api/voter_upload",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])
                ),
                CURLOPT_HTTPHEADER => array(
                    "AccessToken: " . $accessToken,
                ),
            ));
            // $get_data1 = curl_exec($curl1);
            $result = curl_exec($curl1);
            $voterocr = json_decode($result, true);
            $voter = isset($voterocr[0]['ocr_fields']) ? $voterocr[0]['ocr_fields'] : null;
            $voter_detailed_info = isset($voterocr[0]['voter_validation']) ? $voterocr[0]['voter_validation'] : null;
            $statusCode = isset($voterocr[0]['statusCode']) ? $voterocr[0]['statusCode'] : null;

            if (isset($voter_detailed_info['status_code']) && $voter_detailed_info['status_code'] == 200) {
                $is_valid = 1;
            }

            // // $statusCode = $voter['status_code'];
            // // if($statusCode == 200){
            //     $voter_detailed_info = null;
            //     $id_number = $voter['data']['ocr_fields'][0]['epic_number']['value'];
            //     $client = new Client();
            //     $accessToken = Auth::user()->access_token;

            //     $headers = [
            //     'AccessToken' => $accessToken,
            //     ];
            //     $json = [
            //                 'file' => $request->file
            //             ];

            //     try{
            //         $response = $client -> post('http://regtechapi.in/api/voter_upload',['headers' => $headers, 'json' => $json]);
            //         $voter_detailed_info = json_decode($response -> getBody(),true);
            //         $statusCode = 200;

            //         if(isset($voter_detailed_info['status_code']) && $voter_detailed_info['status_code'] == 200){
            //             $is_valid = 1;
            //         }
            //     }catch(BadResponseException $e){
            //         $statusCode = $e->getResponse()->getStatusCode();
            //         $is_valid = 0;
            //         $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
            //         return view('kyc.voter_upload', compact('statusCode','errorMessage'));
            //     }
            $is_valid = 1;
            return view('kyc.voter_upload', compact('voter', 'voter_detailed_info', 'is_valid', 'statusCode', 'hit_limits_exceeded'));
            // }         
            // return view('kyc.voter_upload', compact('voter','voter_detailed_info','statusCode','hit_limits_exceeded'));

        }
    }

    public function license_validation(Request $request)
    {
        $statusCode = null;
        $license_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.license_validation', compact('license_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->license_number
            // ];
            $accessToken = Auth::user()->access_token;
            // $date = Carbon::parse($request->dob)->format('Y-m-d');
            $date = $request->dob;
            // dd($request->dob);

            $headers = [
                'AccessToken' => $accessToken,
                'accept' => 'application/json'
            ];
            $body = [
                'license_number' => $request->license_number,
                "dob" => $date
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'test';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'license')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    // $res = $client->post($this->base_url.'/driving-license/driving-license', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/license_validation', ['headers' => $headers, 'json' => $body]);
                    $license_validation = json_decode($res->getBody(), true);

                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.license_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/license_validation', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/driving-license/driving-license', ['headers' => $headers, 'json' => $body]);
                        $license_validation = json_decode($res->getBody(), true);

                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                        $statusCode = 200;
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.license_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.license_validation', compact('license_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        if(isset($license_validation[0]['statusCode'])){
              $pdf = Pdf::loadView('kyc.license_validation_pdf', [
                'license_validation' => $license_validation
            ]);
          return $pdf->download('license_validation.pdf');
          return view('kyc.license_validation', compact('license_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }

        // dd($license_validation[0]['license_validation']['code']);
        // dd($license_validation);
        return view('kyc.license_validation', compact('license_validation', 'statusCode', 'hit_limits_exceeded'));
    }


    public function license_validation18agust2025(Request $request)
    {
        $statusCode = null;
        $license_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.license_validation', compact('license_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->license_number
            // ];
            $accessToken = Auth::user()->access_token;
            // $date = Carbon::parse($request->dob)->format('Y-m-d');
            $date = $request->dob;
            // dd($request->dob);

            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json'
            ];
            $body = [
                'license_number' => $request->license_number,
                "dob" => $date
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'license')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    // $res = $client->post($this->base_url.'/driving-license/driving-license', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/license_validation', ['headers' => $headers, 'json' => $body]);
                    $license_validation = json_decode($res->getBody(), true);

                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.license_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/license_validation', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/driving-license/driving-license', ['headers' => $headers, 'json' => $body]);
                        $license_validation = json_decode($res->getBody(), true);

                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                        $statusCode = 200;
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.license_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.license_validation', compact('license_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // dd($license_validation[0]['license_validation']['code']);
        // dd($license_validation);
        return view('kyc.license_validation', compact('license_validation', 'statusCode', 'hit_limits_exceeded'));
    }
    public function rc_validationmp(Request $request)
    {
        $statusCode = null;
        $rc_validation = null;
        $checkWeight = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.rc_validationmp', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->rc_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'rc_number' => $request->rc_number
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'rc')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    //$res = $client->post($this->base_url.'/rc/rc-full', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/rc_validationmp', ['headers' => $headers, 'json' => $body]);
                    $rc_validation = json_decode($res->getBody(), true);
                    // dd($rc_validation);
                    if (isset($rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'])) {
                        $grossWeight = $rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'];
                        if ($grossWeight == null) {
                            $grossWeight = 0;
                        }
                        $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                    }
                    if (isset($rc_validation[0]['statusCode'])) {
                        $statusCode = $rc_validation[0]['statusCode'];
                    } else {
                        $statusCode = $rc_validation['statusCode'];
                    }

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.rc_validationmp', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/rc_validationmp', ['headers' => $headers, 'json' => $body]);
                        $rc_validation = json_decode($res->getBody(), true);
                        //dd($rc_validation);
                        if (isset($rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'])) {
                            $grossWeight = $rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'];
                            if ($grossWeight == null) {
                                $grossWeight = 0;
                            }
                            $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                        }
                        if (isset($rc_validation[0]['statusCode']) && $rc_validation[0]['statusCode'] != 500) {
                            $user = User::where('id', Auth::user()->id)->first();
                            $user->scheme_hit_count = $user->scheme_hit_count + 1;
                            $user->save();
                        }
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.rc_validationmp', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.rc_validationmp', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        return view('kyc.rc_validationmp', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
    }


    public function rc_validation(Request $request)
    {
        // return 'test';
        $statusCode = null;
        $rc_validation = null;
        $checkWeight = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->rc_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'rc_number' => $request->rc_number
            ];

            if (Auth::user()->scheme_type != 'demo') {
                // return 'notok';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'rc')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    //$res = $client->post($this->base_url.'/rc/rc-full', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/rc_validation', ['headers' => $headers, 'json' => $body]);
                    $rc_validation = json_decode($res->getBody(), true);
                    // dd($rc_validation['rc_validation']['data']->vehicle_gross_weight);
                    if (isset($rc_validation['rc_validation']['data']['vehicle_gross_weight'])) {
                        $grossWeight = $rc_validation['rc_validation']['data']['vehicle_gross_weight'];
                        if ($grossWeight == null) {
                            $grossWeight = 0;
                        }
                        $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                    }
                    if (isset($rc_validation['status_code'])) {
                        $statusCode = $rc_validation['status_code'];
                    } else {
                        $statusCode = $rc_validation['status_code'];
                    }

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.rc_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                // return 'ok';
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();

                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/rc_validation', ['headers' => $headers, 'json' => $body]);
                        $rc_validation = json_decode($res->getBody(), true);
                        // dd($rc_validation['rc_validation']['data']['vehicle_gross_weight']);
                        if (isset($rc_validation['rc_validation']['data']['vehicle_gross_weight'])) {
                            $grossWeight = $rc_validation['rc_validation']['data']['vehicle_gross_weight'];
                            if ($grossWeight == null) {
                                $grossWeight = 0;
                            }
                            $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                        }
                        if (isset($rc_validation['status_code']) && $rc_validation['status_code'] != 500) {
                            $user = User::where('id', Auth::user()->id)->first();
                            $user->scheme_hit_count = $user->scheme_hit_count + 1;
                            $user->save();
                        }
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.rc_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // return $rc_validation['status_code'];
        if($rc_validation['status_code'] == 200){
              $pdf = Pdf::loadView('kyc.rcvalidation_pdf', [
                'rc_validation' => $rc_validation
            ]);
          return $pdf->download('rc_details.pdf');
          return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        // $pdf = Pdf::loadView('kyc.rcvalidation_pdf', [
        //         'rc_validation' => $rc_validation
        //     ]);
        // return $pdf->download('rc_details.pdf');

        return view('kyc.rc_validation', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
    }
    public function rc_validationlite(Request $request)
    {
        $statusCode = null;
        $rc_validation = null;
        $checkWeight = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.rc_validationlite', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->rc_number
            // ];
            $accessToken = Auth::user()->access_token;
            // dd( $accessToken);

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'rc_number' => $request->rc_number
            ];

            if (Auth::user()->scheme_type != 'demo') {

                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'rcvallite')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    // dd('testeroneasassssone');
                    //$res = $client->post($this->base_url.'/rc/rc-full', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/rc_validationlite', ['headers' => $headers, 'json' => $body]);
                    $rc_validation = json_decode($res->getBody(), true);
                    // return $rc_validation;

                    // if(isset($rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'])){
                    //     $grossWeight = $rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'];
                    //     if($grossWeight == null){
                    //         $grossWeight = 0;
                    //     }
                    //     $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                    // }
                    if (isset($rc_validation[0]['statusCode'])) {
                        $statusCode = $rc_validation[0]['statusCode'];
                    } else {
                        $statusCode = $rc_validation['statusCode'];
                    }

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.rc_validationlite', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

                if ($hit_count_remaining > 0) {
                    // dd('$hit_count_remaining');
                    try {
                        $res = $client->post('http://regtechapi.in/api/rc_validationlite', ['headers' => $headers, 'json' => $body]);
                        $rc_validation = json_decode($res->getBody(), true);
                        // dd($rc_validation);
                        // if(isset($rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'])){
                        //     $grossWeight = $rc_validation[0]['rc_validation']['data']['vehicle_gross_weight'];
                        //     if($grossWeight == null){
                        //         $grossWeight = 0;
                        //     }
                        //     $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                        // }
                        if (isset($rc_validation[0]['statusCode']) && $rc_validation[0]['statusCode'] != 500) {
                            $user = User::where('id', Auth::user()->id)->first();
                            $user->scheme_hit_count = $user->scheme_hit_count + 1;
                            $user->save();
                        }
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.rc_validationlite', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.rc_validationlite', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.rc_validationlite', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
    }


    public function rc_full_validation(Request $request)
    {
        $statusCode = null;
        $rc_validation = null;
        $rc_challan = null;
        $checkWeight = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.rc_full_validation', compact('rc_challan', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'rc_number' => $request->rc_number
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'rcfull')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    //$res = $client->post($this->base_url.'/rc/rc-full', ['headers' => $headers, 'json' => $body]);
                    $res = $client->post('http://regtechapi.in/api/rc_validation', ['headers' => $headers, 'json' => $body]);
                    $rc_challan = json_decode($res->getBody(), true);
                    // dd($rc_challan[0]['statusCode']);

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.rc_full_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        //$res = $client->post($this->base_url.'/rc/rc-full', ['headers' => $headers, 'json' => $body]);
                        $res = $client->post('http://regtechapi.in/api/rc_validation', ['headers' => $headers, 'json' => $body]);
                        $rc_challan = json_decode($res->getBody(), true);

                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.rc_full_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.rc_full_validation', compact('rc_challan', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        return view('kyc.rc_full_validation', compact('rc_challan', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
    }

    public function pull_kra(Request $request)
    {
        $statusCode = null;
        $pull_kra = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.pull_kra', compact('pull_kra', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'id_number' => $request->pan_number,
                'dob' => $request->dob
            ];

            try {
                $res = $client->post($this->base_url . '/pull-kra/pull-kra', ['headers' => $headers, 'json' => $body]);
                $pull_kra = json_decode($res->getBody(), true);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }

        }

        return view('kyc.pull_kra', compact('pull_kra', 'statusCode', 'hit_limits_exceeded'));
    }

    // bank_verification
    public function bank_verification(Request $request)
    {
        $statusCode = null;
        $bank_verification = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.bank_verification', compact('bank_verification', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->account_number,
            //     'ifsc' => $request->ifsc
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'name' => 'Test No',
                'accno' => $request->account_number,
                'ifsc' => $request->ifsc
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    $res = $client->post('http://regtechapi.in/api/bank_verification', ['headers' => $headers, 'json' => $body]);
                    //$res = $client->post($this->base_url.'/bank-verification', ['headers' => $headers, 'json' => $body]);
                    $bank_verification = json_decode($res->getBody(), true);

                    // return $bank_verification[0];
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.bank_verification', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/bank_verification', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/bank-verification', ['headers' => $headers, 'json' => $body]);
                        $bank_verification = json_decode($res->getBody(), true);
                        // return $bank_verification[0];
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.bank_verification', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.bank_verification', compact('bank_verification', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // return $bank_verification;

        return view('kyc.bank_verification', compact('bank_verification', 'statusCode', 'hit_limits_exceeded'));
    }

    public function bank_statement(Request $request)
    {
        $statusCode = null;
        $bank_verification = null;
        $hit_limits_exceeded = 0;
        $bank_upload = null;

        if ($request->isMethod('GET')) {
            return view('kyc.bank_upload', compact('bank_upload', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, array(
                    CURLOPT_URL => "http://regtechapi.in/api/bank_details",
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "POST",
                    CURLOPT_POSTFIELDS => array(
                        "bank_Statement" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                        "password" => $request->password,
                        "bank" => $request->bank,
                        'accountType' => $request->accounttype,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        "AccessToken: " . $accessToken,
                    ),
                ));
                // $get_data1 = curl_exec($curl1);
                $result = curl_exec($curl1);
                $bankstatement = json_decode($result, true);
                if (isset($bankstatement['statusCode']) && $bankstatement['statusCode'] == '200') {
                    $statmendata = $bankstatement['response'];

                    $pdf = PDF::loadView('kyc.statementpdf', compact('statmendata'))->setPaper('A4');
                    return $pdf->stream('invoice.pdf');

                } else {
                    return view('kyc.bank_upload', compact('bankstatement', 'statusCode', 'hit_limits_exceeded'));
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $curl1 = curl_init();
                    curl_setopt_array($curl1, array(
                        CURLOPT_URL => "http://regtechapi.in/api/bank_details",
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => "",
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => "POST",
                        CURLOPT_POSTFIELDS => array(
                            "bank_Statement" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                            "password" => $request->password,
                            "bank" => $request->bank,
                            'accountType' => $request->accounttype,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            "AccessToken: " . $accessToken,
                        ),
                    ));
                    // $get_data1 = curl_exec($curl1);
                    $result = curl_exec($curl1);
                    $bankstatement = json_decode($result, true);
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    if (isset($bankstatement['statusCode']) && $bankstatement['statusCode'] == '200') {
                        $statmendata = $bankstatement['response'];

                        $pdf = PDF::loadView('kyc.statementpdf', compact('statmendata'))->setPaper('A4');
                        return $pdf->stream('invoice.pdf');

                    } else {
                        return view('kyc.bank_upload', compact('bankstatement', 'statusCode', 'hit_limits_exceeded'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.bank_upload', compact('bankstatement', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        return view('kyc.bank_upload', compact('bankstatement', 'statusCode', 'hit_limits_exceeded'));
    }
    public function bankStatementNew(Request $request)
    {
        if ($request->isMethod('GET')) {
            return view('kyc.bank_statementExtract');
        }
        if ($request->isMethod('POST')) {
            $curl = curl_init();
            curl_setopt_array($curl, [
                CURLOPT_URL => 'http://13.200.221.11:5000/extract-bank-statement',
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => '',
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => 'POST',
                CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
            ]);

            $response = curl_exec($curl);
            curl_close($curl);
            $bankstatment = json_decode($response, true);
            if (isset($bankstatment[0]['extracted_info'])) {

                $bankStatement = $bankstatment[0]['extracted_info']['tabular_data'][0];
                $customPdfSize = [0, 0, 967.0, 967.8];
                $pdf = PDF::loadView('kyc.bankstatementpdf', compact('bankStatement'))->setPaper($customPdfSize, 'A4');
                return $pdf->stream('invoice.pdf');
                //  return $bankstatement_pdf_content;
                // return view('kyc.bankstatementpdf', compact('bankStatement'));
                // $bankstatement_pdf_content = $pdf->output();
                // $bankstatement_pdf_content_base64 = base64_encode($bankstatement_pdf_content);
                // return response()->json(['status_code' => 200, 'bank_statement' => $bankstatment, 'bank_details' => $bankstatement_pdf_content_base64]);
            }
        }
    }

//     public function bank_analyser(Request $request)
//     {
//         Log::info('Starting bank_analyser function', ['method' => $request->method(), 'user' => Auth::check() ? Auth::id() : 'Guest', 'query' => $request->query()]);

//         // Handle streaming request
//         if ($request->query('stream') && session('pdf_data')) {
//             Log::info('Handling PDF stream request');
//             $data = session('pdf_data');
//             Log::info('Generating PDF for streaming from session data');
//             $pdf = Pdf::loadView('kyc.analyserpdf', [
//                 'metadata' => $data['metadata'] ?? [],
//                 'summary' => $data['summary'] ?? [],
//                 'transactions' => $data['transactions'] ?? [],
//                 'high_value_txns' => $data['summary']['high_value_txns'] ?? [],
//                 'insights' => $data['insights'] ?? []
//             ])->setPaper('A4');

//             // Clear session data
//             session()->forget('pdf_data');
//             Log::info('Session data cleared');

//             Log::info('Streaming PDF to browser');
//             return $pdf->stream('bank-statement-' . Str::uuid() . '.pdf', ['Attachment' => false]);
//         }

//         // Handle GET request for form
//         if ($request->isMethod('GET')) {
//             return view('kyc.bankanalyser');
//         }

//         // Check authentication
//         if (!Auth::check()) {
//             return redirect()->route('login')->with('error', 'Please log in to continue.');
//         }

//         $user = Auth::user();
//         Log::info('User authenticated', ['user_id' => $user->id, 'email' => $user->email]);

//         // return $user;
//         // Fetch API ID for bank analyzer
//         $apiMaster = ApiMaster::where('api_slug', 'bank_anlyser')->first();
//         $api_id = $apiMaster ? $apiMaster->id : null;

//         // Check if user is registered for the service
//         $updateHitCount = UserSchemeMaster::where('user_id', $user->id)->where('api_id', $api_id)->latest()->first();
//         if (!$updateHitCount && $user->role_id == 1) {
//             Log::warning('User not registered for bank analyser service', ['user_id' => $user->id]);
//             return redirect()->back()->with('error', 'You are not registered to use this service. Please update your plan.');
//         }

//         // Check wallet balance for non-admin and non-postpaid users
//         if ($user->role_id == 1 && $user->type !== 'role_postpaid' && $user->wallet_amount <= 0) {
//             Log::warning('Insufficient wallet balance', ['user_id' => $user->id, 'wallet_amount' => $user->wallet_amount]);
//             return redirect()->back()->with('error', 'Please recharge your wallet.');
//         }

//         // Validate input
//         $request->validate([
//             'file' => 'required|file|mimes:pdf|max:10240',
//             'country' => 'required|string'
//         ], [], ['file' => 'PDF file']);

//         Log::info('Input validation passed', ['file' => $request->file('file')?->getClientOriginalName(), 'country' => $request->country]);

//         if (strtoupper($request->country) !== 'INDIA') {
//             Log::warning('Invalid country code provided', ['country' => $request->country]);
//             return redirect()->back()->with('error', 'Please enter correct country code (INDIA).');
//         }

//         $accessToken = $user->access_token;
//         $file = $request->file('file');

//         Log::info('Preparing to upload file', [
//             'file_name' => $file->getClientOriginalName(),
//             'file_size' => $file->getSize(),
//             'access_token' => $accessToken
//         ]);

//         try {
//             $uploadResponse = Http::attach(
//                 'file',
//                 file_get_contents($file->getRealPath()),
//                 $file->getClientOriginalName()
//             )->post('http://13.232.247.95:8082/api/v1/analysis/analyze', [
//                 'hint' => ''
//             ]);

//             if (!$uploadResponse->successful()) {
//                 Log::error('File upload to analysis API failed', ['status' => $uploadResponse->status(), 'response' => $uploadResponse->body()]);
//                 if ($user->role_id == 1 && $apiMaster) {
//                     $this->saveHitCount($user->id, $api_id, 'File upload failed: ' . $uploadResponse->body(), 102);

//                 }

//                 return redirect()->back()->with('error', 'File upload failed: ' . $uploadResponse->body());
//             }

//             $uploadData = $uploadResponse->json();
//             $jobId = $uploadData['job_id'] ?? null;

//             if (!$jobId) {
//                 Log::error('No job_id returned from analysis API', ['response' => $uploadData]);
//                 if ($user->role_id == 1 && $apiMaster) {
//                     $this->saveHitCount($user->id, $api_id, 'No job ID returned', 102);
//                 }
//                 return redirect()->back()->with('error', 'Analysis failed: No job ID returned.');
//             }

//             Log::info('File uploaded successfully', [
//                 'job_id' => $jobId,
//                 'status' => $uploadData['status'] ?? 'Unknown',
//                 'status_url' => $uploadData['status_url'] ?? 'N/A'
//             ]);

//             $maxAttempts = 10;
//             $attempt = 0;
//             $delay = 3;

//             do {
//                 Log::info('Polling for analysis result', ['attempt' => $attempt + 1, 'job_id' => $jobId]);
//                 sleep($delay);
//                 $resultResponse = Http::get("http://13.232.247.95:8082/api/v1/analysis/result/{$jobId}");
//                 $attempt++;

//                 if ($resultResponse->successful()) {
//                     $data = $resultResponse->json();
//                     Log::info('Analysis result received', ['job_id' => $jobId]);

//                     // Store analysis result in session for streaming
//                     session(['pdf_data' => $data]);

//                     // Save hit count for successful transaction
//                     if ($user->role_id == 1 && $apiMaster) {
//                         // dd('till')
//                         $this->saveHitCount($user->id, $api_id, 'Transaction Successful', 200);
//                     }

//                     Log::info('Redirecting to form with stream URL');
//                     return redirect()
//                         ->route('kyc.bank_analyser')
//                         ->with('stream_pdf', true)
//                         ->with('statusCode', 200)
//                         ->with('message', 'Bank statement analyzed successfully.')
//                         ->with('stream_url', route('kyc.bank_analyser') . '?stream=1');
//                 }

//                 if ($attempt >= $maxAttempts) {
//                     Log::error('Result polling timed out', ['job_id' => $jobId, 'attempts' => $attempt]);
//                     if ($user->role_id == 1 && $apiMaster) {
//                         $this->saveHitCount($user->id, $api_id, 'Analysis timed out', 102);
//                     }
//                     return redirect()->back()->with('error', 'Analysis timed out. Please try again later.');
//                 }
//             } while (!$resultResponse->successful());

//         } catch (\Exception $e) {
//             Log::error('Exception in bank_analyser', [
//                 'message' => $e->getMessage(),
//                 'file' => $e->getFile(),
//                 'line' => $e->getLine()
//             ]);
//             if ($user->role_id == 1 && $apiMaster) {
//                 $this->saveHitCount($user->id, $api_id, 'Server error: ' . $e->getMessage(), 102);
//         }
//         return redirect()->back()->with('error', 'Server error: ' . $e->getMessage());
//     }
// }

 public function bank_analyser(Request $request)
    {
        $hit_limits_exceeded = 0;
        $statusCode = null;

        Log::info('Starting bank_analyser function', [
            'method' => $request->method(),
            'user' => Auth::check() ? Auth::id() : 'Guest',
            'query' => $request->query()
        ]);

        // Handle GET request for form
        if ($request->isMethod('GET')) {
            return view('kyc.bankanalyser');
        }

        // Check authentication
        if (!Auth::check()) {
            Log::warning('Unauthenticated access attempt');
            return redirect()->route('login')->with('error', 'Please log in to continue.');
        }

        $user = Auth::user();
        Log::info('User authenticated', ['user_id' => $user->id, 'email' => $user->email]);




        // Fetch API ID for bank analyzer
        $apiMaster = ApiMaster::where('api_slug', 'bank_anlyser')->first();
        $api_id = $apiMaster ? $apiMaster->id : null;

        // Check if user is registered for the service
        $updateHitCount = UserSchemeMaster::where('user_id', $user->id)->where('api_id', $api_id)->latest()->first();
        if (!$updateHitCount && $user->role_id != 0) {
            Log::warning('User not registered for bank analyser service', ['user_id' => $user->id]);
            return redirect()->back()->with('error', 'You are not registered to use this service. Please update your plan.');
        }

        // Check wallet balance for non-admin and non-postpaid users
        if ($user->role_id == 1 && $user->type !== 'role_postpaid' && $user->wallet_amount <= 0) {
            Log::warning('Insufficient wallet balance', ['user_id' => $user->id, 'wallet_amount' => $user->wallet_amount]);
            return redirect()->back()->with('error', 'Please recharge your wallet.');
        }

        // Validate input
        $request->validate([
            'file' => 'required|file|mimes:pdf|max:10240',
            'country' => 'required|string',
        ], [], ['file' => 'PDF file']);

        Log::info('Input validation passed', [
            'file' => $request->file('file')?->getClientOriginalName(),
            'country' => $request->country
        ]);

        if (strtoupper($request->country) !== 'INDIA') {
            Log::warning('Invalid country code provided', ['country' => $request->country]);
            return redirect()->back()->with('error', 'Please enter correct country code (INDIA).');
        }

        $accessToken = $user->access_token;
        $file = $request->file('file');

        Log::info('Preparing to upload file', [
            'file_name' => $file->getClientOriginalName(),
            'file_size' => $file->getSize(),
            'access_token' => $accessToken
        ]);

$password = trim($request->input('password', ''));
       $hints = $password !== ''
    ? json_encode(['password' => $password])
    : '';
        // Upload file to analysis API
        $uploadResponse = Http::attach(
            'file',
            file_get_contents($file->getRealPath()),
            $file->getClientOriginalName()
        )->post('http://13.204.214.95:8082/api/v1/analysis/analyze', [
            'hints' => $hints
        ]);

        if (!$uploadResponse->successful()) {
            Log::error('File upload to analysis API failed', [
                'status' => $uploadResponse->status(),
                'response' => $uploadResponse->body()
            ]);
            if ($user->role_id == 1 && $apiMaster) {
                $this->saveHitCount($user->id, $api_id, 'File upload failed: ' . $uploadResponse->body(), 102);
            }
            return redirect()->back()->with('error', 'File upload failed: ' . $uploadResponse->body());
        }

        $uploadData = $uploadResponse->json();
        $jobId = $uploadData['job_id'] ?? null;

        if (!$jobId) {
            Log::error('No job_id returned from analysis API', ['response' => $uploadData]);
            if ($user->role_id == 1 && $apiMaster) {
                $this->saveHitCount($user->id, $api_id, 'No job ID returned', 102);
            }
            return redirect()->back()->with('error', 'Analysis failed: No job ID returned.');
        }

        Log::info('File uploaded successfully', [
            'job_id' => $jobId,
            'status' => $uploadData['status'] ?? 'Unknown',
            'status_url' => $uploadData['status_url'] ?? 'N/A'
        ]);

        // Poll for analysis result
        $maxAttempts = 20;
        $attempt = 0;
        $delay = 3;

     do {
    Log::info('Polling for analysis result', ['attempt' => $attempt + 1, 'job_id' => $jobId]);
    sleep($delay);
    $resultResponse = Http::timeout(120)->get("http://13.204.214.95:8082/api/v1/analysis/result/{$jobId}");
    $attempt++;

    // If API responded
    if ($resultResponse->ok()) {
        $bankstatement = $resultResponse->json();

        //  Check if API returned "detail" key (like incorrect password)
        if (isset($bankstatement['detail'])) {
            $errorMsg = $bankstatement['detail'];

            Log::warning('Bank analysis error', [
                'job_id' => $jobId,
                'error' => $errorMsg
            ]);

            if ($user->role_id == 1 && $apiMaster) {
                $this->saveHitCount($user->id, $api_id, $errorMsg, 102);
            }

            return redirect()->back()->with('error', $errorMsg);
        }

        //  Normal successful processing
        if (isset($bankstatement['response'])) {
            Log::info('Analysis result received', ['job_id' => $jobId]);

            if ($user->role_id == 1 && $apiMaster) {
                $this->saveHitCount($user->id, $api_id, 'Transaction Successful', 200);
            }

            $statmendata = $bankstatement['response'];
            $statusCode = $bankstatement['status_code'];
            $atm_withdrawl = $statmendata['atm_withdrawls'];
            $averageMonthlyBalance = $statmendata['averageMonthlyBalance'];
            $expenses = $statmendata['expenses'];
            $high_value_transactions = $statmendata['high_value_transactions'];
            $incomes = $statmendata['incomes'];
            $minimum_balances = $statmendata['minimum_balances'];
            $money_received_transactions = $statmendata['money_received_transactions'];

            try {
                $pdf = Pdf::loadView('kyc.analyserpdf', compact(
                    'atm_withdrawl',
                    'averageMonthlyBalance',
                    'expenses',
                    'high_value_transactions',
                    'incomes',
                    'minimum_balances',
                    'money_received_transactions'
                ))->setPaper('A4');

                return $pdf->download('bank_statement_analysis.pdf');

            } catch (\Exception $e) {
                if ($user->role_id == 1 && $apiMaster) {
                    $this->saveHitCount($user->id, $api_id, 'PDF generation failed: ' . $e->getMessage(), 102);
                }
                return redirect()->back()->with('error', 'Failed to generate PDF: ' . $e->getMessage());
            }
        }
    }
        // If API returned a non-success status
        elseif ($resultResponse->status() >= 400) {
            $errorMsg = $resultResponse->json()['detail'] ?? 'Unexpected error occurred.';
            Log::error('Bank analysis API error', ['status' => $resultResponse->status(), 'error' => $errorMsg]);
            return redirect()->back()->with('error', $errorMsg);
        }

        if ($attempt >= $maxAttempts) {
            if ($user->role_id == 1 && $apiMaster) {
                $this->saveHitCount($user->id, $api_id, 'Analysis timed out', 102);
            }
            return redirect()->back()->with('error', 'Analysis timed out. Please try again later.');
        }

    } while (true);

        // Fallback in case of unexpected loop exit
        Log::error('Unexpected loop exit in polling', ['job_id' => $jobId]);
        return redirect()->back()->with('error', 'Analysis failed due to unexpected error.');
    }


    



    public function bank_analyser08_08_2025(Request $request)
    {
        $statusCode = null;
        $bank_verification = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $bank_upload = null;
        if ($request->isMethod('GET')) {
            return view('kyc.bankanalyser', compact('bank_upload', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // return $request->password;
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->account_number,
            //     'ifsc' => $request->ifsc
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            // $body =  [
            // 'name' => 'Test No',
            // 'accno' => $request->account_number,
            // 'ifsc' => $request->ifsc
            // ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                // try{
                // return 'ok test';
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, array(
                    CURLOPT_URL => "http://regtechapi.in/api/bank_anlyser", //"https://kyc-api.flowboard.in/api/v1/pan/pan-upload",
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "POST",
                    CURLOPT_POSTFIELDS => array(
                        "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                        "password" => $request->password,
                        "bank" => $request->bank,
                        'accountType' => $request->accounttype,
                        "country" => "INDIA"
                    ),
                    CURLOPT_HTTPHEADER => array(
                        "AccessToken: " . $accessToken,
                    ),
                ));
                // $get_data1 = curl_exec($curl1);
                $result = curl_exec($curl1);
                
                $bankstatement = json_decode($result, true);
                // return $bankstatement;
                if (isset($bankstatement['statusCode']) && $bankstatement['statusCode'] == '200') {
                    $statmendata = $bankstatement['response'];
                    $statusCode = $bankstatement['statusCode'];
                    $atm_withdrawl = $bankstatement['response']['atm_withdrawls'];
                    $averageMonthlyBalance = $bankstatement['response']['averageMonthlyBalance'];
                    $averageQuarterlyBalance = $bankstatement['response']['averageQuarterlyBalance'];
                    $expenses = $bankstatement['response']['expenses'];
                    $high_value_transactions = $bankstatement['response']['high_value_transactions'];
                    $incomes = $bankstatement['response']['incomes'];
                    $minimum_balances = $bankstatement['response']['minimum_balances'];
                    $money_received_transactions = $bankstatement['response']['money_received_transactions'];
                    // return $atm_withdrawl;
                    $customPaper = [0, 0, 967.0, 967.8];
                    $pdf = PDF::loadView('kyc.analyserpdf', compact('atm_withdrawl', 'averageMonthlyBalance', 'averageQuarterlyBalance', 'expenses', 'high_value_transactions', 'incomes', 'minimum_balances', 'money_received_transactions'))->setPaper($customPaper, 'A4');
                    // $pdf = PDF::loadView('kyc.analyserpdf',compact('statmendata'))->setPaper('A4');
                    return $pdf->stream('invoice.pdf');
                    // $hit_limits_exceeded = 1;
                    // return view('kyc.bankanalyser', compact('statmendata', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));

                } else {
                    return view('kyc.bankanalyser', compact('bank_upload', 'statusCode', 'hit_limits_exceeded'));
                }

                // } catch(BadResponseException $e) {
                //     $statusCode = $e->getResponse()->getStatusCode();
                //     $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                //     return view('kyc.bank_verification', compact('statusCode','errorMessage'));
                // }
            } else {
                // $scheme_type = SchemeTypeMaster::where('id',Auth::user()->scheme_type_id)->first();
                // $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // if($hit_count_remaining>0)
                // {
                //     try{
                //         $res = $client->post('http://regtechapi.in/api/bank_verification',['headers' => $headers, 'json' => $body]);
                //         //$res = $client->post($this->base_url.'/bank-verification', ['headers' => $headers, 'json' => $body]);
                //         $bank_verification = json_decode($res->getBody(), true);
                //         // return $bank_verification[0];
                //         $user = User::where('id',Auth::user()->id)->first();
                //         $user->scheme_hit_count = $user->scheme_hit_count+1;
                //         $user->save();
                //     } catch(BadResponseException $e) {
                //         $statusCode = $e->getResponse()->getStatusCode();
                //         $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                //         return view('kyc.bank_verification', compact('statusCode','errorMessage'));
                //     }
                // } else {
                //     $hit_limits_exceeded = 1;
                //     return view('kyc.bank_verification', compact('bank_verification', 'statusCode','hit_limits_exceeded'));
                // }

                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                // try{
                // return 'ok test';
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, array(
                    CURLOPT_URL => "http://regtechapi.in/api/bank_anlyser", //"https://kyc-api.flowboard.in/api/v1/pan/pan-upload",
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "POST",
                    CURLOPT_POSTFIELDS => array(
                        "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                        "password" => $request->password,
                        "bank" => $request->bank,
                        "country" => "INDIA",
                        'accountType' => $request->accounttype
                    ),
                    CURLOPT_HTTPHEADER => array(
                        "AccessToken: " . $accessToken,
                    ),
                ));
                // $get_data1 = curl_exec($curl1);
                $result = curl_exec($curl1);
                
                $bankstatement = json_decode($result, true);
                // dd($bankstatement);
                // return $bankstatement;
                if ($bankstatement['statusCode'] == '200') {
                    $statmendata = $bankstatement['response'];
                    $statusCode = $bankstatement['statusCode'];
                    $atm_withdrawl = $bankstatement['response']['atm_withdrawls'];
                    $averageMonthlyBalance = $bankstatement['response']['averageMonthlyBalance'];
                    $averageQuarterlyBalance = $bankstatement['response']['averageQuarterlyBalance'];
                    $expenses = $bankstatement['response']['expenses'];
                    $high_value_transactions = $bankstatement['response']['high_value_transactions'];
                    $incomes = $bankstatement['response']['incomes'];
                    $minimum_balances = $bankstatement['response']['minimum_balances'];
                    $money_received_transactions = $bankstatement['response']['money_received_transactions'];
                    // return $atm_withdrawl;
                    $customPaper = [0, 0, 967.0, 967.8];
                    $pdf = PDF::loadView('kyc.analyserpdf', compact('atm_withdrawl', 'averageMonthlyBalance', 'averageQuarterlyBalance', 'expenses', 'high_value_transactions', 'incomes', 'minimum_balances', 'money_received_transactions'))->setPaper($customPaper, 'A4');
                    // $atm_withdrawl =  $bankstatement['response']['atm_withdrawls'];
                    // $averageMonthlyBalance =  $bankstatement['response']['averageMonthlyBalance'];
                    // $averageQuarterlyBalance =  $bankstatement['response']['averageQuarterlyBalance'];
                    // $expenses =  $bankstatement['response']['expenses'];
                    // $high_value_transactions =  $bankstatement['response']['high_value_transactions'];
                    // $incomes =  $bankstatement['response']['incomes'];
                    // $minimum_balances =  $bankstatement['response']['minimum_balances'];
                    // $money_received_transactions =  $bankstatement['response']['money_received_transactions'];
                    // return $atm_withdrawl;
                    // $pdf = PDF::loadView('kyc.analyserpdf',compact('atm_withdrawl','averageMonthlyBalance','averageQuarterlyBalance','expenses','high_value_transactions','incomes','minimum_balances','money_received_transactions'))->setPaper('A4');
                    // return $pdf->stream('invoice.pdf');
                    // $pdf = PDF::loadView('kyc.analyserpdf',compact('statmendata'))->setPaper('A4');
                    return $pdf->stream('invoice.pdf');
                    // $hit_limits_exceeded = 1;
                    // return view('kyc.bankanalyser', compact('statmendata', 'statusCode','hit_limits_exceeded', 'low_wallet_balance'));

                } else {
                    return view('kyc.bankanalyser', compact('bank_upload', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // return $bank_verification;

        return view('kyc.bankanalyser', compact('bank_verification', 'statusCode', 'hit_limits_exceeded'));
    }

    // corporate_cin
    public function corporate_cin(Request $request)
    {
        $statusCode = null;
        $corporate_cin = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.corporate_cin', compact('corporate_cin', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->id_number
            // ];

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'corporate_cin' => $request->id_number
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'cin')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }


                try {
                    $res = $client->post('http://regtechapi.in/api/corporate_cin', ['headers' => $headers, 'json' => $body]);
                    //$res = $client->post($this->base_url.'/corporate/cin', ['headers' => $headers, 'json' => $body]);
                    $corporate_cin = json_decode($res->getBody(), true);
                    //dd($corporate_cin);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.corporate_cin', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/corporate_cin', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/corporate/cin', ['headers' => $headers, 'json' => $body]);
                        $corporate_cin = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.corporate_cin', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.corporate_cin', compact('corporate_cin', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.corporate_cin', compact('corporate_cin', 'statusCode', 'hit_limits_exceeded'));
    }

    // corporate_din
    public function corporate_din(Request $request)
    {
        $statusCode = null;
        $corporate_din = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.corporate_din', compact('corporate_din', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            $body = [
                'id_number' => $request->corporate_din
            ];

            // $accessToken = Auth::user()->access_token;

            // $headers = [
            // 'AccessToken' => $accessToken,
            // ];
            // $body =  [
            // 'corporate_cin' => $request->id_number
            // ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'din')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }



                try {
                    $res = $client->post('http://regtechapi.in/api/corporate_din', ['headers' => $headers, 'json' => $body]);
                    // $res = $client->post('https://kyc-api.flowboard.in/api/v1/corporate/din', ['headers' => $headers, 'json' => $body]);
                    $corporate_din = json_decode($res->getBody(), true);
                    // dd($request->corporate_din);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.corporate_din', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/corporate_din', ['headers' => $headers, 'json' => $body]);
                        // $res = $client->post($this->base_url.'/corporate/din', ['headers' => $headers, 'json' => $body]);
                        $corporate_din = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.corporate_din', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.corporate_din', compact('corporate_din', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        // dd($corporate_din);
        return view('kyc.corporate_din', compact('corporate_din', 'statusCode', 'hit_limits_exceeded'));
    }

    // Credit_monitor
    public function Credit_monitor(Request $request)
    {
        $statusCode = null;
        $Credit_monitor = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.Credit_monitor', compact('Credit_monitor', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'id_number' => $request->Credit_monitor,
                'companies_associated' => $request->companies_associated
            ];

            try {
                $res = $client->post($this->base_url . '/corporate/din', ['headers' => $headers, 'json' => $body]);
                $Credit_monitor = json_decode($res->getBody(), true);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }

        }

        return view('kyc.Credit_monitor', compact('Credit_monitor', 'statusCode', 'hit_limits_exceeded'));
    }

    // corporate_gstin
    public function corporate_gstin(Request $request)
    {
        $statusCode = null;
        $corporate_gstin = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.corporate_gstin', compact('corporate_gstin', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->corporate_gstin

            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'gstin' => $request->corporate_gstin
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'gstin')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }



                try {
                    $res = $client->post('http://regtechapi.in/api/corporate_gstin', ['headers' => $headers, 'json' => $body]);
                    //$res = $client->post($this->base_url.'/corporate/gstin', ['headers' => $headers, 'json' => $body]);
                    $corporate_gstin = json_decode($res->getBody(), true);
                    //dd($corporate_gstin);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.corporate_gstin', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/corporate_gstin', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/corporate/gstin', ['headers' => $headers, 'json' => $body]);
                        $corporate_gstin = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.corporate_gstin', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.corporate_gstin', compact('corporate_gstin', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

            if($corporate_gstin[0]['corporate_gstin']['code'] == 200){
                $pdf = Pdf::loadView('kyc.corporategstin_pdf', [
                'corporate_gstin' => $corporate_gstin
                ]);
                return $pdf->download('corporategstin_pdf.pdf');

            }
            

        return view('kyc.corporate_gstin', compact('corporate_gstin', 'statusCode', 'hit_limits_exceeded'));
    }

    public function corporate_gstin_confidence(Request $request)
    {
        $statusCode = null;
        $corporate_gstin = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.corporate_gstin_confidence', compact('corporate_gstin', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'gstin' => $request->corporate_gstin,
                'name' => $request->name,
                'mobile_number' => $request->mobile_number,
                'address' => $request->address,
                'state' => $request->state,
                'city' => $request->city,
                'pincode' => $request->pincode
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'gstinconfidence')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/gstin_pan_confidence', ['headers' => $headers, 'json' => $body]);
                    //$res = $client->post($this->base_url.'/corporate/gstin', ['headers' => $headers, 'json' => $body]);
                    $corporate_gstin = json_decode($res->getBody(), true);
                    //dd($corporate_gstin);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.corporate_gstin_confidence', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/gstin_pan_confidence', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/corporate/gstin', ['headers' => $headers, 'json' => $body]);
                        $corporate_gstin = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.corporate_gstin_confidence', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.corporate_gstin_confidence', compact('corporate_gstin', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        return view('kyc.corporate_gstin_confidence', compact('corporate_gstin', 'statusCode', 'hit_limits_exceeded'));
    }

    // electricity
    public function electricity(Request $request)
    {
        $statusCode = null;
        $electricity = null;
        $states = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.electricity', compact('electricity', 'statusCode', 'states', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            if (Auth::user()->scheme_type != 'demo') {
                $client = new Client();
                $accessToken = Auth::user()->access_token;

                $headers = [
                    'AccessToken' => $accessToken,
                ];

                $body = [
                    'id_number' => $request->id_number
                ];

                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'electricity')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    $res = $client->post('http://regtechapi.in/api/electricity', ['headers' => $headers, 'json' => $body]);
                    $electricity = json_decode($res->getBody(), true);

                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.electricity', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/electricity', ['headers' => $headers, 'json' => $body]);
                        $electricity = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.electricity', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                }
            }
            return view('kyc.electricity', compact('electricity', 'statusCode', 'states', 'hit_limits_exceeded'));
        }
    }

    //eSign  
    public function esign(Request $request)
    {
        $statusCode = null;
        $esign = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.esign', compact('esign', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'id_number' => $request->account_number,
                'ifsc' => $request->ifsc
            ];

            try {
                $res = $client->post($this->base_url . '/corporate/gstin', ['headers' => $headers, 'json' => $body]);
                $esign = json_decode($res->getBody(), true);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }

        }

        return view('kyc.esign', compact('esign', 'statusCode', 'hit_limits_exceeded'));
    }


    // Docboyz Esign

    public function esign_docboyz(Request $request)
    {
        $statusCode = null;
        $license_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('esign.esign_docboyz', compact('esign_docboyz', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'id_number' => $request->license_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'license')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }



                try {
                    $res = $client->post($this->base_url . '/driving-license/driving-license', ['headers' => $headers, 'json' => $body]);
                    $esign_docboyz = json_decode($res->getBody(), true);

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.esign_docboyz', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post($this->base_url . '/driving-license/driving-license', ['headers' => $headers, 'json' => $body]);
                        $esign_docboyz = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.esign_docboyz', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.esign_docboyz', compact('esign_docboyz', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('esign.esign_docboyz', compact('esign_docboyz', 'statusCode', 'hit_limits_exceeded'));
    }

    // shopestablishment 
    public function shopestablishment(Request $request)
    {
        $statusCode = null;
        $shopestablishment = null;
        $hit_limits_exceeded = 0;

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        try {
            $res = $client->get('http://regtechapi.in/api/shopestablishment', ['headers' => $headers]);
            $states = json_decode($res->getBody(), true);
            $statusCode = 200;
        } catch (BadResponseException $e) {
            $statusCode = $e->getResponse()->getStatusCode();
        }

        if ($request->isMethod('GET')) {
            return view('kyc.shopestablishment', compact('shopestablishment', 'statusCode', 'states', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'shop_establishment')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                $client = new Client();
                $accessToken = Auth::user()->access_token;

                $headers = [
                    'AccessToken' => $accessToken,
                ];

                $body = [
                    'id_number' => $request->id_number,
                    'state_code' => $request->state_code
                ];

                try {
                    $res = $client->post('http://regtechapi.in/api/shopestablishment', ['headers' => $headers, 'json' => $body]);
                    $shopestablishment = json_decode($res->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.shopestablishment', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/shopestablishment', ['headers' => $headers, 'json' => $body]);
                        $shopestablishment = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.shopestablishment', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.shopestablishment', compact('shopestablishment', 'statusCode', 'states', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.shopestablishment', compact('shopestablishment', 'statusCode', 'states', 'hit_limits_exceeded'));
    }

    // telecom
    public function telecom(Request $request)
    {
        $statusCode = null;
        $telecom = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.telecom', compact('telecom', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            $json = [
                'id_number' => $request->mobile_number
            ];



            $client = new CLient();


            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $api_master = ApiMaster::where('api_slug', 'telecom_generate_otp')->first();
                    if ($api_master)
                        $api_id = $api_master->id;
                }

                try {
                    $response = $client->post('http://regtechapi.in/api/telecom/generate-otp', [
                        'headers' => $headers,
                        'json' => $json
                    ]);

                    $telecom = json_decode($response->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.telecom', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $response = $client->post('http://regtechapi.in/api/telecom/generate-otp', [
                            'headers' => $headers,
                            'json' => $json
                        ]);

                        $telecom = json_decode($response->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.telecom', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.telecom', compact('telecom', 'statusCode', 'hit_limits_exceeded'));
                }

            }
            return view('kyc.telecom', compact('telecom', 'statusCode', 'hit_limits_exceeded'));
        }
    }


    public function telecom_submit_otp(Request $request)
    {
        $statusCode = null;
        $telecom_submit_otp = null;
        $hit_limits_exceeded = null;

        if ($request->isMethod('GET'))
            return view('kyc.telecom_submit_otp', compact('telecom_submit_otp', 'statusCode', 'hit_limits_exceeded'));

        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $json = [
                'client_id' => $request->client_id,
                'otp' => $request->otp
            ];
            $client = new Client();
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $api_master = ApiMaster::where('api_slug', 'telecom_submit_otp')->first();
                    if ($api_master)
                        $api_id = $api_master->id;

                }
                try {
                    $response = $client->post('http://regtechapi.in/api/telecom/submit-otp', [
                        'headers' => $headers,
                        'json' => $json
                    ]);

                    $telecom_submit_otp = json_decode($response->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.telecom_submit_otp', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $response = $client->post('http://regtechapi.in/api/telecom/submit-otp', [
                            'headers' => $headers,
                            'json' => $json
                        ]);

                        $telecom_submit_otp = json_decode($response->getBody(), true);
                        dd($telecom_submit_otp);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.telecom_submit_otp', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.telecom_submit_otp', compact('telecom_submit_otp', 'statusCode', 'hit_limits_exceeded'));
                }
            }
            return view('kyc.telecom_submit_otp', compact('telecom_submit_otp', 'statusCode', 'hit_limits_exceeded'));
        }
    }

    public function telecom_apis()
    {
        return view('kyc.telecom_api');
    }


    public function face_match_api()
    {
        return view('kyc.face_match_api');
    }

    //license upload api implementation
    public function license_upload(Request $request)
    {
        $statusCode = null;
        $license = null;
        $hit_limits_exceeded = 0;
        $license_validation = null;

        if ($request->isMethod('GET')) {
            return view('kyc.license_upload', compact('license', 'license_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            //checking if file exists or not
            if (!$request->hasFile('front')) {
                return json_encode(['message' => "front file not found"], true);
            }
            if (!$request->hasFile('back')) {
                return json_encode(['message' => "back file not found"], true);
            }

            $accessToken = Auth::user()->access_token;

            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                CURLOPT_URL => "http://regtechapi.in/api/driving_upload", //"https://sandbox.flowboard.in/api/v1/ocr/license",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "front" => new \CURLFILE($_FILES['front']['tmp_name'], $_FILES['front']['type'], $_FILES['front']['name']),
                    "back" => new \CURLFILE($_FILES['back']['tmp_name'], $_FILES['back']['type'], $_FILES['back']['name'])
                ),
                CURLOPT_HTTPHEADER => array(
                    "AccessToken: " . $accessToken,
                ),
            ));
            // $get_data1 = curl_exec($curl1);
            $result = curl_exec($curl1);
            //dd($curl1);
            $licenseocr = json_decode($result, true);
            if (isset($licenseocr[0]['$ocr_fields'])) {
                $license = $licenseocr[0]['$ocr_fields'];
                $license_validation = $licenseocr[0]['license_validation'];
                $statusCode = $licenseocr[0]['statusCode'];
            }

            if (isset($license_validation['status_code']) && $license_validation['status_code'] == 200) {
                $is_valid = 1;
            }
            return view('kyc.license_upload', compact('license', 'statusCode', 'hit_limits_exceeded', 'is_valid', 'license_validation'));
        }
    }

    // Passport
    public function passport(Request $request)
    {
        return view('kyc.passport');
    }

    // Passport create client
    public function passport_create_client_ajax(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_create_client', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'id_number' => 'asd'
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_name', 'passport')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                $client = new Client();
                $headers = [
                    'Authorization' => $this->token,
                    'Accept' => 'application/json',
                ];

                $body = [
                    'id_number' => 'asd'
                ];

                try {
                    $res = $client->post($this->base_url . '/passport/passport/create', ['headers' => $headers, 'json' => $body]);
                    $passport = json_decode($res->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.passport_create_client', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post($this->base_url . '/passport/passport/create', ['headers' => $headers, 'json' => $body]);
                        $passport = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                        $statusCode = 200;

                        $remark = 'Passport validation Debited ' . $updateHitCount->scheme_price . ' Sucessfull';
                        $this->update_transaction($api_id, $updateHitCount->scheme_price, $remark, $statusCode);
                        $this->update_wallet_balance($updateHitCount->scheme_price);
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.passport_create_client', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.passport_create_client', compact('passport', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        // return view('kyc.passport_create_client', compact('passport', 'statusCode','hit_limits_exceeded'));
        return response()->json(array(['passport' => $passport, 'hit_limits_exceeded' => $hit_limits_exceeded, 'statusCode' => $statusCode]));
    }

    // Passport upload
    public function passport_upload_ajax(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_upload', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            if ($request->hasFile('file')) {
                $file = $request->file('file');
                dd($file);
            }
            //checking if file exists or not
            // if(isset($_FILES['file']) && $_FILES['file']['error'] == 0){
            // if(!isset($_FILES['file'])){
            //     return json_encode(['message'=>"file not found"], true);
            // }


            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                CURLOPT_URL => "https://kyc-api.flowboard.in/api/v1/passport/passport/" . $request->client_id . "/upload",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                ),
                CURLOPT_HTTPHEADER => array(
                    "Authorization: " . $this->token,
                ),
            ));
            // $get_data1 = curl_exec($curl1);
            $result = curl_exec($curl1);
            $passport = json_decode($result, true);
            $statusCode = 200;

            // dd($passport);

            // return $get_data1;
            // return view('kyc.passport_upload', compact('passport', 'statusCode','hit_limits_exceeded'));
            return response()->json(array(['passport' => $passport, 'hit_limits_exceeded' => $hit_limits_exceeded, 'statusCode' => $statusCode]));
        }
    }

    // Passport verify
    public function passport_verify_ajax(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_verify', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // if(Auth::user()->role_id==1) {
            //     $apiamster = ApiMaster::where('api_name','PAN CARD - FBORD')->first();
            //     if($apiamster)
            //         $api_id = $apiamster->id;
            // }

            //$client = new Client();
            $client = new Client(['verify' => false]);

            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'client_id' => $request->client_id
            ];

            try {
                // dd($body);
                $res = $client->post($this->base_url . '/passport/passport/verify', ['headers' => $headers, 'json' => $body]);
                $passport = json_decode($res->getBody(), true);
                // if(Auth::user()->role_id==1) {
                //     if($apiamster) {
                //         $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();
                //         // $updateHitCount->hit_count = $updateHitCount->hit_count+1;
                //         // $updateHitCount->save();

                //         $addHitCount = new HitCountMaster;
                //         $addHitCount->user_id = Auth()->user()->id;
                //         $addHitCount->api_id = $api_id;
                //         $addHitCount->scheme_price = $updateHitCount->scheme_price;
                //         $addHitCount->hit_year_month = date('Y-m');
                //         $addHitCount->hit_count = 1;
                //         $addHitCount->save();
                //     }
                // }
                // dd($passport);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }
        }

        return view('kyc.passport_verify', compact('passport', 'statusCode', 'hit_limits_exceeded'));
    }

    // Passport get client details
    public function passport_get_client_details_ajax(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_get_client_details', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // if(Auth::user()->role_id==1) {
            //     $apiamster = ApiMaster::where('api_name','PAN CARD - FBORD')->first();
            //     if($apiamster)
            //         $api_id = $apiamster->id;
            // }

            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'client_id' => $request->client_id
            ];

            try {
                $res = $client->get($this->base_url . '/passport/passport/' . $request->client_id, ['headers' => $headers, 'json' => $body]);
                $passport = json_decode($res->getBody(), true);
                // if(Auth::user()->role_id==1) {
                // if($apiamster) {
                //     $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();

                //     $addHitCount = new HitCountMaster;
                //     $addHitCount->user_id = Auth()->user()->id;
                //     $addHitCount->api_id = $api_id;
                //     $addHitCount->scheme_price = $updateHitCount->scheme_price;
                //     $addHitCount->hit_year_month = date('Y-m');
                //     $addHitCount->hit_count = 1;
                //     $addHitCount->save();
                // }
                // }

                // dd($passport);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }
        }

        return view('kyc.passport_get_client_details', compact('passport', 'statusCode', 'hit_limits_exceeded'));
    }

    // Passport create client
    public function passport_create_client(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_create_client', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            $body = [
                'id_number' => 'asd'
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_name', 'passport')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }


                try {
                    $res = $client->post('http://regtechapi.in/api/passport_create_client', ['headers' => $headers, 'json' => $body]);
                    $passport = json_decode($res->getBody(), true);
                    $statusCode = 200;

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.passport_create_client', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/passport_create_client', ['headers' => $headers, 'json' => $body]);
                        $passport = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.passport_create_client', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.passport_create_client', compact('passport', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.passport_create_client', compact('passport', 'statusCode', 'hit_limits_exceeded'));
    }

    // Passport upload
    public function passport_upload(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;
        $status_code = null;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_upload', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            //checking if file exists or not
            if (!$request->hasFile('file')) {
                return json_encode(['message' => "file not found"], true);
            }


            $curl1 = curl_init();
            curl_setopt_array($curl1, array(
                CURLOPT_URL => "http://regtechapi.in/api/passport_upload",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => array(
                    "file" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                    "client_id" => $request->client_id
                ),
                CURLOPT_HTTPHEADER => array(
                    "Authorization: " . $this->token,
                ),
            ));
            // $get_data1 = curl_exec($curl1);
            $result = curl_exec($curl1);
            $passport = json_decode($result, true);

            if (isset($passport['statusCode'])) {
                $statusCode = $passport['statusCode'];
            } else {
                $statusCode = 500;
            }
            // dd($passport);
            // echo 'status_code='.$status_code;
            $passport_verification = null;
            $is_verified = 0;
            if ($statusCode == 200 || $statusCode == 400) {
                $client_id = $passport['OCR_DATA']['data']['client_id'];
                // dd($client_id);
                // echo 'client_id='.$client_id;
                $client = new Client();
                $accessToken = Auth::user()->access_token;

                $headers = [
                    'AccessToken' => $accessToken,
                ];

                $body = [
                    'client_id' => $client_id
                ];

                try {
                    // dd(1);
                    $res = $client->post('http://regtechapi.in/api/passport_verify', ['headers' => $headers, 'json' => $body]);
                    $passport_verification = json_decode($res->getBody(), true);
                    // dd($passport_verification);
                    if ($passport_verification['status_code'] == 200)
                        $is_verified = 1;
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $is_verified = 0;
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.passport_upload', compact('statusCode', 'errorMessage'));
                }
            }

            // return $get_data1;
            // dd($statusCode);
            return view('kyc.passport_upload', compact('passport_verification', 'statusCode', 'hit_limits_exceeded', 'status_code', 'passport_verification'));
        }
    }



    //API LIST
    public function pancard_api()
    {
        return view('kyc.pancard_api');
    }

    public function search_api()
    {
        return view('kyc.search_api');
    }

    public function ckycsearch_api()
    {
        return view('kyc.ckycsearch_api');
    }

    public function ckycdownload_api()
    {
        return view('kyc.ckycdownload_api');
    }

    public function udyam_api()
    {
        return view('kyc.udyam_api');
    }

    public function udyamadhar_api()
    {
        return view('kyc.udyamadhar_api');
    }

    //API LIST
    public function aadhaar_api(Request $request)
    {
        return view('kyc.aadhaar_api');
    }

    //API LIST
    public function voter_api()
    {
        return view('kyc.voter_api');
    }

    //API LIST
    public function license_api()
    {
        return view('kyc.license_api');
    }

    //API LIST
    public function rc_api()
    {
        return view('kyc.rc_api');
    }

    //API LIST
    public function corporate_cin_apis()
    {
        return view('kyc.corporate_cin_apis');
    }

    //API LIST//
    public function corporate_din_apis()
    {
        return view('kyc.corporate_din_apis');
    }

    //GSTIN API
    public function corporate_gstin_api()
    {
        return view('kyc.corporate_gstin_api');
    }

    public function corporate_gstin_confidence_api()
    {
        return view('kyc.corporate_gstin_confidence_api');
    }

    // Passport verify
    public function passport_verify(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_verify', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];

            $body = [
                'client_id' => $request->client_id
            ];
            try {

                $res = $client->post('http://regtechapi.in/api/passport_verify', ['headers' => $headers, 'json' => $body]);
                $passport = json_decode($res->getBody(), true);
                // if(Auth::user()->role_id==1) {
                //     if($apiamster) {
                //         $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();
                //         // $updateHitCount->hit_count = $updateHitCount->hit_count+1;
                //         // $updateHitCount->save();

                //         $addHitCount = new HitCountMaster;
                //         $addHitCount->user_id = Auth()->user()->id;
                //         $addHitCount->api_id = $api_id;
                //         $addHitCount->scheme_price = $updateHitCount->scheme_price;
                //         $addHitCount->hit_year_month = date('Y-m');
                //         $addHitCount->hit_count = 1;
                //         $addHitCount->save();
                //     }
                // }
                // dd($passport);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }
        }

        return view('kyc.passport_verify', compact('passport', 'statusCode', 'hit_limits_exceeded'));
    }

    // Passport get client details
    public function passport_get_client_details(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.passport_get_client_details', compact('passport', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // if(Auth::user()->role_id==1) {
            //     $apiamster = ApiMaster::where('api_name','PAN CARD - FBORD')->first();
            //     if($apiamster)
            //         $api_id = $apiamster->id;
            // }

            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'client_id' => $request->client_id
            ];

            try {
                $res = $client->get($this->base_url . '/passport/passport/' . $request->client_id, ['headers' => $headers, 'json' => $body]);
                $passport = json_decode($res->getBody(), true);
                // if(Auth::user()->role_id==1) {
                // if($apiamster) {
                //     $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();

                //     $addHitCount = new HitCountMaster;
                //     $addHitCount->user_id = Auth()->user()->id;
                //     $addHitCount->api_id = $api_id;
                //     $addHitCount->scheme_price = $updateHitCount->scheme_price;
                //     $addHitCount->hit_year_month = date('Y-m');
                //     $addHitCount->hit_count = 1;
                //     $addHitCount->save();
                // }
                // }

                // dd($passport);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
            }
        }

        return view('kyc.passport_get_client_details', compact('passport', 'statusCode', 'hit_limits_exceeded'));
    }

    // eSign 
    public function esign_initialize(Request $request)
    {
        $statusCode = null;
        $esign = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.esign_initialize', compact('esign', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'esign')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                $client = new Client();
                $accessToken = Auth::user()->access_token;

                $headers = [
                    'AccessToken' => $accessToken,
                ];

                $body = [
                    "pdf_pre_uploaded" => false,
                    "config" => [
                        "auth_mode" => "1",
                        "reason" => "Contract",
                        "positions" => [
                            "1" => [
                                [
                                    "x" => 10,
                                    "y" => 20
                                ]
                            ],
                            "2" => [
                                [
                                    "x" => 0,
                                    "y" => 0
                                ]
                            ]
                        ]
                    ],
                    "prefill_options" => [
                        "full_name" => $request->full_name,
                        "mobile_number" => $request->mobile_number,
                        "user_email" => $request->user_email
                    ]
                ];

                // dd($body);
                try {
                    $res = $client->post('http://regtechapi.in/api/esign', ['headers' => $headers, 'json' => $body, 'verify' => false]);
                    //$res = $client->post($this->sandbox_url.'/esign/initialize', ['headers' => $headers, 'json' => $body,'verify' =>false]);
                    //dd($res);
                    $esign = json_decode($res->getBody(), true);
                    // dd($esign);
                    // print_r($esign);
                    // exit(1);

                    $statusCode = 200;

                    // dd($esign);
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.esign_initialize', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/esign', ['headers' => $headers, 'json' => $body]);
                        $esign = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.esign_initialize', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.esign_initialize', compact('esign', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.esign_initialize', compact('esign', 'statusCode', 'hit_limits_exceeded'));
    }


    // Usage
    public function usage(Request $request)
    {
        $statusCode = null;
        $usage = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.usage', compact('usage', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'start_date' => $request->start_date,
                'end_date' => $request->end_date,
                'type' => $request->type,
                'recipient_email' => $request->recipient_email
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'usage')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post($this->base_url . '/utils/usage/usage-report', ['headers' => $headers, 'json' => $body]);
                    $usage = json_decode($res->getBody(), true);


                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.usage', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post($this->base_url . '/utils/usage/usage-report', ['headers' => $headers, 'json' => $body]);
                        $usage = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.usage', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.usage', compact('usage', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.usage', compact('usage', 'statusCode', 'hit_limits_exceeded'));
    }

    // eSign 
    public function esign_upload_link(Request $request)
    {
        $statusCode = null;
        $esign = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.esign_upload_link', compact('esign', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // if(Auth::user()->role_id==1) {
            //     $apiamster = ApiMaster::where('api_name','PAN CARD - FBORD')->first();
            //     if($apiamster)
            //         $api_id = $apiamster->id;
            // }

            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'pdf_pre_uploaded' => false
            ];

            try {
                $res = $client->post($this->base_url . '/esign/get-upload-link', ['headers' => $headers, 'json' => $body]);
                $esign = json_decode($res->getBody(), true);
                // if(Auth::user()->role_id==1) {
                // if($apiamster) {
                //     $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();

                //     $addHitCount = new HitCountMaster;
                //     $addHitCount->user_id = Auth()->user()->id;
                //     $addHitCount->api_id = $api_id;
                //     $addHitCount->scheme_price = $updateHitCount->scheme_price;
                //     $addHitCount->hit_year_month = date('Y-m');
                //     $addHitCount->hit_count = 1;
                //     $addHitCount->save();
                // }
                // }
                dd($esign);
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.esign_upload_link', compact('statusCode', 'errorMessage'));
            }
        }

        return view('kyc.esign_upload_link', compact('esign', 'statusCode', 'hit_limits_exceeded'));
    }

    // eSign 
    public function esign_get_client_link(Request $request)
    {
        $statusCode = null;
        $esign = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.esign_get_client_link', compact('esign', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // if(Auth::user()->role_id==1) {
            //     $apiamster = ApiMaster::where('api_name','PAN CARD - FBORD')->first();
            //     if($apiamster)
            //         $api_id = $apiamster->id;
            // }

            $client = new Client();
            $headers = [
                'Authorization' => $this->token,
                'Accept' => 'application/json',
            ];

            $body = [
                'pdf_pre_uploaded' => false
            ];

            try {
                $res = $client->post($this->base_url . '/initialize', ['headers' => $headers, 'json' => $body]);
                $esign = json_decode($res->getBody(), true);
                // if(Auth::user()->role_id==1) {
                // if($apiamster) {
                //     $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();

                //     $addHitCount = new HitCountMaster;
                //     $addHitCount->user_id = Auth()->user()->id;
                //     $addHitCount->api_id = $api_id;
                //     $addHitCount->scheme_price = $updateHitCount->scheme_price;
                //     $addHitCount->hit_year_month = date('Y-m');
                //     $addHitCount->hit_count = 1;
                //     $addHitCount->save();
                // }
                // }
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.esign_get_client_link', compact('statusCode', 'errorMessage'));
            }
        }

        return view('kyc.esign_get_client_link', compact('esign', 'statusCode', 'hit_limits_exceeded'));
    }

    // ownapi
    public function ownapi(Request $request)
    {
        return Redirect::to("http://videokyc.docboyz.in/");
    }

    public function passport_api()
    {
        return view('kyc.passport_api');
    }

    public function all_apis()
    {
        return view('kyc.all_apis');
    }

    //bank verifcation ifsc

    // bank_verification
    public function bank_verification_find_ifsc(Request $request)
    {
        $statusCode = null;
        $bank_verification_ifsc = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.bank_ifsc', compact('bank_verification_ifsc', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'ifsc' => $request->ifsc
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank_ifsc')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }

                try {
                    $res = $client->post('http://regtechapi.in/api/bank_verification_find_ifsc', ['headers' => $headers, 'json' => $body]);
                    $bank_verification_ifsc = json_decode($res->getBody(), true);
                    //dd($bank_verification_ifsc);
                    if (isset($aadhaar_validation[0]['aadhaar_validation']['code'])) {
                        $statusCode = $aadhaar_validation[0]['aadhaar_validation']['code'];
                    }

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.bank_ifsc', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/bank_verification_find_ifsc', ['headers' => $headers, 'json' => $body]);
                        //$res = $client->post($this->base_url.'/bank-verification/find-ifsc', ['headers' => $headers, 'json' => $body]);
                        $bank_verification_ifsc = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.bank_ifsc', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.bank_ifsc', compact('bank_verification_ifsc', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }

        return view('kyc.bank_ifsc', compact('bank_verification_ifsc', 'statusCode', 'hit_limits_exceeded'));
    }

    public function fssi_verification(Request $request)
    {
        $statusCode = null;
        $fssi_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.fssi_validation', compact('fssi_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        // dd('dddd');

        if ($request->isMethod('POST')) {
            // $data="22819015001312";
            $client = new Client();

            $user_id = Auth()->user()->id;
            $user = User::where('id', $user_id)->first();
            $accessToken = $user->access_token;
            $headers = [
                'AccessToken' => $accessToken
            ];
        $client_ref_num = strval(rand(100, 999));
            $body = [
                'license_number' => $request->license_number,
                'client_ref_num'=> $client_ref_num
            ];
            // dd($request->fssi_number);

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'fssi')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // dd($request->fssi_number);
                try {
                    $res = $client->post('http://regtechapi.in/api/fssi', ['headers' => $headers, 'json' => $body]);
                    $fssi_validation = json_decode($res->getBody(), true);
                    // dd($fssi_validation);
                    // if(Auth::user()->role_id==1) {
                    //     if($apiamster) {
                    //         $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();
                    //         $addHitCount = new HitCountMaster;
                    //         $addHitCount->user_id = Auth()->user()->id;
                    //         $addHitCount->api_id = $api_id;
                    //         $addHitCount->scheme_price = $updateHitCount->scheme_price;
                    //         $addHitCount->hit_year_month = date('Y-m');
                    //         $addHitCount->hit_count = 1;
                    //         $addHitCount->save();


                    //         $remark = 'FSSAI validation Debited '.$updateHitCount->scheme_price.' Sucessfull';
                    //         $this->update_transaction($api_id, $updateHitCount->scheme_price, $remark);
                    //         $this->update_wallet_balance($updateHitCount->scheme_price);




                    //     }
                    // dd( $fssi_validation);
                    // }
                } catch (BadResponseException $e) {
                    // dd( $fssi_validation);
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.fssi_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/fssi', ['headers' => $headers, 'json' => $body]);
                        $fssi_validation = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.fssi_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.fssi_validation', compact('fssi_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // dd( $fssi_validation);
        return view('kyc.fssi_validation', compact('fssi_validation', 'statusCode', 'hit_limits_exceeded'));
    }
    
    public function fssi_verification22agust2025(Request $request)
    {


        $statusCode = null;
        $fssi_validation = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.fssi_validation', compact('fssi_validation', 'statusCode', 'hit_limits_exceeded'));
        }
        // dd('dddd');

        if ($request->isMethod('POST')) {
            // $data="22819015001312";
            $client = new Client();

            $user_id = Auth()->user()->id;
            $user = User::where('id', $user_id)->first();
            $accessToken = $user->access_token;
            $headers = [
                'AccessToken' => $accessToken
            ];

            $body = [
                'id_number' => $request->fssi_number
            ];
            // dd($request->fssi_number);

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'fssi')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // dd($request->fssi_number);
                try {
                    $res = $client->post('http://regtechapi.in/api/fssi', ['headers' => $headers, 'json' => $body]);
                    $fssi_validation = json_decode($res->getBody(), true);
                    // dd($fssi_validation);
                    // if(Auth::user()->role_id==1) {
                    //     if($apiamster) {
                    //         $updateHitCount = SchemeMaster::where('user_id',Auth()->user()->id)->where('api_id',$api_id)->first();
                    //         $addHitCount = new HitCountMaster;
                    //         $addHitCount->user_id = Auth()->user()->id;
                    //         $addHitCount->api_id = $api_id;
                    //         $addHitCount->scheme_price = $updateHitCount->scheme_price;
                    //         $addHitCount->hit_year_month = date('Y-m');
                    //         $addHitCount->hit_count = 1;
                    //         $addHitCount->save();


                    //         $remark = 'FSSAI validation Debited '.$updateHitCount->scheme_price.' Sucessfull';
                    //         $this->update_transaction($api_id, $updateHitCount->scheme_price, $remark);
                    //         $this->update_wallet_balance($updateHitCount->scheme_price);




                    //     }
                    // dd( $fssi_validation);
                    // }
                } catch (BadResponseException $e) {
                    // dd( $fssi_validation);
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.fssi_validation', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/fssi', ['headers' => $headers, 'json' => $body]);
                        $fssi_validation = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.fssi_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.fssi_validation', compact('fssi_validation', 'statusCode', 'hit_limits_exceeded'));
                }
            }
        }
        // dd( $fssi_validation);
        return view('kyc.fssi_validation', compact('fssi_validation', 'statusCode', 'hit_limits_exceeded'));
    }

    public function fssai_api(Request $request)
    {
        return view('kyc.fssai_api');
    }

    //EPFO otp generate

    public function pf_generate_otp(Request $request)
    {
        $statusCode = null;
        $pf_generate_otp = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.pf_generate_otp', compact('pf_generate_otp', 'statusCode'));//,'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $client = new Client();
            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json',
            ];

            $body = [
                'id_number' => $request->epfo_number
            ];
            // if(Auth::user()->scheme_type!='demo') {
            //     if(Auth::user()->role_id==1) {
            //         $apiamster = ApiMaster::where('api_slug','aadhaar')->first();
            //         if($apiamster)
            //             $api_id = $apiamster->id;
            //     }

            try {
                // dd('hii');
                $res = $client->post('http://regtechapi.in/api/pf_generate_otp', ['headers' => $headers, 'json' => $body]);
                // $res = $client->post($this->base_url.'/income/epfo/passbook/generate-otp', ['headers' => $headers, 'json' => $body]);
                $pf_generate_otp = json_decode($res->getBody(), true);
                //  dd($pf_generate_otp);
                //  dd('hiii');
                $statusCode = 200;

            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.pf_generate_otp', compact('statusCode', 'errorMessage'));
            }
            // } else {
            //     $scheme_type = SchemeTypeMaster::where('id',Auth::user()->scheme_type_id)->first();
            //     $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
            //     if($hit_count_remaining>0)
            //     {
            //         try{
            //             $res = $client->post($this->base_url.'/aadhaar-v2/generate-otp', ['headers' => $headers, 'json' => $body]);
            //             $aadhaar_otp_genrate = json_decode($res->getBody(), true);
            //             $user = User::where('id',Auth::user()->id)->first();
            //             $user->scheme_hit_count = $user->scheme_hit_count+1;
            //             $user->save();
            //         } catch(BadResponseException $e) {
            //             $statusCode = $e->getResponse()->getStatusCode();
            //         }
            //     } 
            // else {
            //         $hit_limits_exceeded = 1;
            //         return view('kyc.aadhaar_otp_genrate', compact('aadhaar_otp_genrate', 'statusCode','hit_limits_exceeded'));
            //     }
            //}
        }

        return view('kyc.pf_generate_otp', compact('pf_generate_otp', 'statusCode'));//,'hit_limits_exceeded'));
    }

    // EPFO OTP Submit


    public function pf_submit_otp(Request $request)
    {
        // dd('sasas');
        $statusCode = null;
        $pf_submit_otp = null;
        $hit_limits_exceeded = 0;

        if ($request->isMethod('GET')) {

            return view('kyc.pf_submit_otp', compact('pf_submit_otp', 'statusCode'));//,'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $client = new Client();
            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json',
            ];

            $body = [
                'client_id' => $request->client_id,
                'otp' => $request->otp
            ];

            // if(Auth::user()->scheme_type!='demo') {
            //     if(Auth::user()->role_id==1) {
            //         $apiamster = ApiMaster::where('api_slug','aadhaar')->first();
            //         if($apiamster)
            //             $api_id = $apiamster->id;
            //     }

            try {
                // dd('hii');
                $res = $client->post('http://regtechapi.in/api/pf_submit_otp', ['headers' => $headers, 'json' => $body]);
                // $res = $client->post($this->base_url.'/income/epfo/passbook/submit-otp', ['headers' => $headers, 'json' => $body]);
                //dd($res);
                $pf_submit_otp = json_decode($res->getBody(), true);

                $statusCode = 200;

            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.pf_submit_otp', compact('statusCode', 'errorMessage'));
            }
            // } else {
            //     $scheme_type = SchemeTypeMaster::where('id',Auth::user()->scheme_type_id)->first();
            //     $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
            //     if($hit_count_remaining>0)
            //     {
            //         try{
            //             $res = $client->post($this->base_url.'/aadhaar-v2/submit-otp', ['headers' => $headers, 'json' => $body]);
            //             $aadhaar_validation = json_decode($res->getBody(), true);
            //             $user = User::where('id',Auth::user()->id)->first();
            //             $user->scheme_hit_count = $user->scheme_hit_count+1;
            //             $user->save();
            //         } catch(BadResponseException $e) {
            //             $statusCode = $e->getResponse()->getStatusCode();
            //         }
            // } else {
            //     $hit_limits_exceeded = 1;
            //     return view('kyc.aadhaar_otp_submit', compact('aadhaar_validation', 'statusCode','hit_limits_exceeded'));
            // }
            //}
        }
        // dd($aadhaar_validation);
        return view('kyc.pf_submit_otp', compact('pf_submit_otp', 'statusCode'));//,'hit_limits_exceeded'));
    }

    public function pf_without_otp(Request $request)
    {
        $statusCode = null;
        $epfo_details = null;
        if ($request->isMethod('GET')) {

            return view('kyc.pf_without_otp');//,'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {
            // if(empty($request->name))
            //     return response()->json(array(['message'=>'name is required','statusCode'=>'404']));

            // if(empty($request->name))
            //     return response()->json(array(['message'=>'comapany is required','statusCode'=>'404']));

            // if(!$request->headers->has('AccessToken'))
            //     return response()->json(array(['message'=>'Header Access Token is required','statusCode'=>'404']));

            // $verifyAccessToken = $this->verifyAccessToken($request->header('AccessToken'));
            // if ($verifyAccessToken==false)
            //     return response()->json(array(['message'=>'Wrong Access Token','statusCode'=>'403']));
            $accessToken = Auth::user()->access_token;
            $user = User::where('access_token', $accessToken)->first();
            // if($user->role_id==1) {
            //     $apiamster = ApiMaster::where('api_slug','epfowithoutotp')->first();
            //     if($apiamster)
            //         $api_id = $apiamster->id;
            // }

            $client = new Client();
            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json'
            ];
            $json = [
                'name' => $request->name,
                'company' => $request->company_name
            ];
            try {
                $response = $client->post("http://regtechapi.in/api/epfo", ['headers' => $headers, 'json' => $json]);
                // return $response;
                $epfo_details = json_decode($response->getBody(), true);

            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.pf_without_otp', compact('statusCode', 'errorMessage'));
                // return response()->json(['statusCode'=>$statusCode,'message' => 'Unprocessable Entity']);
            }
        }
        return view('kyc.pf_without_otp', compact('epfo_details'));
    }

    public function uan_details(Request $request)
    {
        $statusCode = null;
        $uan_details = null;
        if ($request->isMethod('GET')) {

            return view('kyc.uan_details');//,'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;
            $user = User::where('access_token', $accessToken)->first();

            $client = new Client();
            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json'
            ];
            $json = [
                'mobile_number' => $request->mobile_number
            ];
            try {
                $response = $client->post("http://regtechapi.in/api/uan", ['headers' => $headers, 'json' => $json]);
                // return $response;
                $uan_details = json_decode($response->getBody(), true);

            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.uan_details', compact('statusCode', 'errorMessage'));
                // return response()->json(['statusCode'=>$statusCode,'message' => 'Unprocessable Entity']);
            }
        }
        return view('kyc.uan_details', compact('uan_details'));
    }

    public function company_search(Request $request)
    {
        $statusCode = null;
        $company_search = null;
        if ($request->isMethod('GET')) {

            return view('kyc.company_search');//,'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;
            $user = User::where('access_token', $accessToken)->first();

            $client = new Client();
            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json'
            ];
            $json = [
                'company' => $request->company,
                'search_size' => $request->search_size
            ];
            try {
                $response = $client->post("http://regtechapi.in/api/company_search", ['headers' => $headers, 'json' => $json]);
                // return $response;
                $company_search = json_decode($response->getBody(), true);


                $statusCode = $company_search['statusCode'];
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.company_search', compact('statusCode', 'errorMessage'));
                // return response()->json(['statusCode'=>$statusCode,'message' => 'Unprocessable Entity']);
            }
        }
        return view('kyc.company_search', compact('company_search', 'statusCode'));
    }

    public function company_details(Request $request)
    {
        $statusCode = null;
        $company_details = null;
        if ($request->isMethod('GET')) {

            return view('kyc.company_details');//,'hit_limits_exceeded'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;
            $user = User::where('access_token', $accessToken)->first();

            $client = new Client();
            $headers = [
                'AccessToken' => $accessToken,
                'Accept' => 'application/json'
            ];
            $json = [
                'company_code' => $request->company_code,
                'filing_data_size' => $request->filing_data_size
            ];
            try {
                $response = $client->post("http://regtechapi.in/api/company_details", ['headers' => $headers, 'json' => $json]);
                // return $response;
                $company_details = json_decode($response->getBody(), true);

                $statusCode = $company_details['statusCode'];
            } catch (BadResponseException $e) {
                $statusCode = $e->getResponse()->getStatusCode();
                $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                return view('kyc.company_details', compact('statusCode', 'errorMessage'));
                // return response()->json(['statusCode'=>$statusCode,'message' => 'Unprocessable Entity']);
            }
        }
        return view('kyc.company_details', compact('company_details', 'statusCode'));
    }

    public function getPlanValues(Request $request)
    {
        $plan_details = '';
        if ($request->plan == 'basic') {
            $plan_details = DB::table('api_master')->select('id', 'basic_price as price', 'api_group_id')->get();
        } else if ($request->plan == 'starter') {
            $plan_details = DB::table('api_master')->select('id', 'starter_price as price', 'api_group_id')->get();
        } else if ($request->plan == 'standard') {
            $plan_details = DB::table('api_master')->select('id', 'standard_price as price', 'api_group_id')->get();
        } else if ($request->plan == 'advance') {
            $plan_details = DB::table('api_master')->select('id', 'advance_price as price', 'api_group_id')->get();
        } else if ($request->plan == 'growth') {
            $plan_details = DB::table('api_master')->select('id', 'growth_price as price', 'api_group_id')->get();
        } else if ($request->plan == 'unicorn') {
            $plan_details = DB::table('api_master')->select('id', 'unicorn_price as price', 'api_group_id')->get();
        }
        return response()->json($plan_details);
    }


    public function fasttag_information(Request $request)
    {
        $fasttag_information = '';
        $statusCode = '';
        return view('kyc.fasttag_information', compact('fasttag_information', 'statusCode'));
    }

    
     public function upi_validation(Request $request)
    {
        $statusCode = null;
        $upidetails = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.upi_validation', compact('upidetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'name' => $request->name,
                'upi_id' => $request->upi_id,
                'order_id' => $request->order_id,
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'upi')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/upi_validation', ['headers' => $headers, 'json' => $body]);

                    $upidetails = json_decode($res->getBody(), true);
                    if (isset($upidetails[0]['upidetails']['code'])) {
                        $statusCode = $upidetails[0]['upidetails']['code'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct UPI Id.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.pancard', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/upi_validation', ['headers' => $headers, 'json' => $body]);
                        $upidetails = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.upi_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.upi_validation', compact('upidetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.upi_validation', compact('upidetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    
    public function upi_validation18agust2025(Request $request)
    {
        $statusCode = null;
        $upidetails = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.upi_validation', compact('upidetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'name' => $request->name,
                'upi_id' => $request->upi_id,
                'order_id' => $request->order_id,
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'upi')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/upi_validation', ['headers' => $headers, 'json' => $body]);

                    $upidetails = json_decode($res->getBody(), true);
                    if (isset($upidetails[0]['upidetails']['code'])) {
                        $statusCode = $upidetails[0]['upidetails']['code'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.pancard', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/upi_validation', ['headers' => $headers, 'json' => $body]);
                        $upidetails = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.upi_validation', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.upi_validation', compact('upidetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.upi_validation', compact('upidetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function face_match(Request $request)
    {
        $statusCode = null;
        $face_match = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.face_match', compact('face_match', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();

            $doc_img = base64_encode(file_get_contents($request->file('doc_img')->path()));
            $selfie = base64_encode(file_get_contents($request->file('selfie')->path()));

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'doc_img' => $doc_img,
                'selfie' => $selfie,
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'facematch')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/face_match1', ['headers' => $headers, 'json' => $body]);

                    $face_match = json_decode($res->getBody(), true);
                    if (isset($face_match[0]['face_match']['code'])) {
                        $statusCode = $face_match[0]['face_match']['code'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Document Image and Selfie Image is required in base64 format';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.face_match', compact('statusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/face_match1', ['headers' => $headers, 'json' => $body]);
                        $face_match = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Document Image and Selfie Image is required in base64 format';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.face_match', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.face_match', compact('face_match', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.face_match', compact('face_match', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function rc_count(Request $request)
    {
        $count = 0;
        $startDate = '2022-12-06 17:38:52';
        $endDate = '2022-12-12 24:00:00';
        $startDate1 = '2022-05-30 00:00:00';
        $endDate1 = '2022-12-04 23:59:00';
        $rccount = DB::table('rcvalidation')->whereBetween(('created_at'), [$startDate, $endDate])->where('status_code', 200)->groupBy('rc_number')->pluck('rc_number');
        $test = $rccount;
        return $test;
        // for($i=0;$i<$rccount->count();$i++){
        $rccheckcount = DB::table('rcvalidation')->whereBetween(('created_at'), [$startDate1, $endDate1])->whereIn('rc_number', $test)->count();
        // if($rccheckcount > 0){
        //     $count++;

        // }
        return $rccheckcount;

        // }
        // return $count;
    }

    public function udyam_details(Request $request)
    {
        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.udyamdetails', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }

        if ($request->isMethod('POST')) {
            $client = new Client();

            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->pan_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'udyamNumber' => $request->udyam_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'udyamsearch')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/udyamsearch', ['headers' => $headers, 'json' => $body]);

                    $udyamcard = json_decode($res->getBody(), true);
                    // return $udyamcard['response'];
                    // $pdfurl = $udyamcard['response']['result']['pdfUrl'];
                    // return Redirect::away($pdfurl);
                    // dd($pancard);
                    if (isset($udyamcard['statusCode'])) {
                        $statusCode = $udyamcard['statusCode'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.udyamdetails', compact('statusCode', 'errorMessage'));
                }
            } else {

                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // dd($hit_count_remaining);
                if ($hit_count_remaining > 0) {

                    try {//dd($body);
                        $res = $client->post('http://regtechapi.in/api/udyamsearch', ['headers' => $headers, 'json' => $body]);

                        $udyamcard = json_decode($res->getBody(), true);
                        // return $udyamcard['response'];
                        // $pdfurl = $udyamcard['response']['result']['pdfUrl'];
                        // return Redirect::away($pdfurl);
                        // dd($pancard);
                        // if(isset($pancard[0]['pancard']['code'])){
                        //     $statusCode = $pancard[0]['pancard']['code'];
                        // }
                        if (isset($udyamcard['statusCode'])) {
                            $statusCode = $udyamcard['statusCode'];
                        }
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.udyamdetails', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    return 'ok';
                    $hit_limits_exceeded = 1;
                    


                    return view('kyc.udyamdetails', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        //  return ' not ok';
        if($udyamcard['status_code'] == 200){
              $pdf = Pdf::loadView('kyc.udyamdetails_pdf', [
                'udyamcard' => $udyamcard
            ]);
          return $pdf->download('udyamdetails.pdf');
        }
          
        return view('kyc.udyamdetails', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function udyogadhar_details(Request $request)
    {
        // return 'test1';
        $statusCode = null;
        $pancard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.udyogadhardetails', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }

        if ($request->isMethod('POST')) {
            $client = new Client();

            // $headers = [
            //     'Authorization' => $this->token,        
            //     'Accept'        => 'application/json',
            // ];

            // $body =  [
            //     'id_number' => $request->pan_number
            // ];
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'uamnumber' => $request->udyogadhar_number
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'udyamsearch')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                // if(Auth()->user()->wallet_amount >= $updateHitCount->scheme_price){
                try {//dd($body);
                    $res = $client->post('http://regtechapi.in/api/udyogaadhaars', ['headers' => $headers, 'json' => $body]);

                    $udyamcard = json_decode($res->getBody(), true);

                    // return $udyamcard;
                    // dd($pancard);
                    if (isset($udyamcard['statusCode'])) {
                        // return $udyamcard['statusCode'];
                        $statusCode = $udyamcard['statusCode'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.udyogadhardetails', compact('statusCode', 'errorMessage'));
                }
            } else {

                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                // dd($hit_count_remaining);
                if ($hit_count_remaining > 0) {

                    try {//dd($body);
                        $res = $client->post('http://regtechapi.in/api/udyogaadhaars', ['headers' => $headers, 'json' => $body]);

                        $udyamcard = json_decode($res->getBody(), true);
                        $pdfurl = $udyamcard['response']['result']['pdfUrl'];
                        // return Redirect::away($pdfurl);
                        // dd($pancard);
                        // if(isset($pancard[0]['pancard']['code'])){
                        //     $statusCode = $pancard[0]['pancard']['code'];
                        // }
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.udyogadhardetails', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.udyogadhardetails', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.udyogadhardetails', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function pancard_new_info(Request $request)
    {
        // return 'ok1';
        $statusCode = null;
        $pancard = null;
        $pandetailsinfo = null;
        $pancardError = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pan_no' => $request->pan_number,
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'yusys';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pandetails1')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                try {
                    $response = $client->post('http://regtechapi.in/api/pan_details_check', ['headers' => $headers, 'json' => $body]);
                    $pancard = json_decode($response->getBody(), true);
                    $api_master = ApiMaster::where('api_slug', 'pandetails1')->first();
                    $pancard_details = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_master->id)
                        ->pluck('permission');
                    // return $pancard_details;
                    // $pandetails_data = explode(',', $pancard_details[0]);
                    if (count($pancard_details) > 0) {
                        $pandetails_data = explode(',', $pancard_details[0]);
                    }
                    //  dd($pandetails_data);
                    if (isset($pancard['status_code']) && $pancard['status_code'] == 200) {
                        if (isset($pandetails_data) && $pancard_details != null) {
                            $pancard['pancard']['data']['pandetails1'] = null;
                            $statusCode = $pancard['status_code'];
                            $errorMessage = 'Success';
                            foreach ($pandetails_data as $pan_data) {
                                $pandetailsinfo['data'][$pan_data] = $pancard['pancard']['data'][$pan_data];
                            }
                            return view('kyc.pandetails_info_new', compact('pandetailsinfo', 'statusCode', 'errorMessage'));
                        } else {
                            $statusCode = $pancard['status_code'];
                            $errorMessage = 'Success';
                            return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'errorMessage'));
                        }
                    } elseif ($pancard['statusCode'] == 102 && $pancard['message'] == 'No Records found!.') {
                        $statusCode = $pancard['statusCode'];
                        $errorMessage = 'No Records Found !';
                        return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'errorMessage'));
                    } elseif ($pancard['statusCode'] == 102 && $pancard['message'] == 'PAN Number InValid Please Enter Correct PanNumber.') {
                        $statusCode = $pancard['statusCode'];
                        $errorMessage = 'PAN Number InValid Please Enter Correct PanNumber.';
                        return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'errorMessage'));
                    } else {
                        $statusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.pandetails_info_new', compact('statusCode', 'errorMessage'));
                    }
                } catch (BadResponseException $e) {
                    $response = $e->getResponse();
                    $pancardError = json_decode($response->getBody(), true);
                    $statusCode = $e->getResponse()->getStatusCode();
                    if (isset($pancardError['statusCode']) && $pancardError['statusCode'] == 102) {
                        $statusCode = 102;
                        $errorMessage = 'PAN Number InValid Please Enter Correct PanNumber.';
                        return view('kyc.pandetails_info_new', compact('pancardError', 'statusCode', 'errorMessage'));
                    } else {
                        $statusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.pandetails_info_new', compact('pancardError', 'statusCode', 'errorMessage'));
                    }
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {

                    try {
                        $response = $client->post('http://regtechapi.in/api/pan_details_check', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($response->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                        $api_master = ApiMaster::where('api_slug', 'pandetails1')->first();
                        $pancard_details = UserSchemeMaster::where('user_id', Auth::user()->id)
                            ->where('api_id', $api_master->id)
                            ->pluck('permission');
                        if (count($pancard_details) > 0) {
                            $pandetails_data = explode(',', $pancard_details[0]);
                        }
                        if (isset($pancard['status_code']) && $pancard['status_code'] == 200) {
                            if (isset($pandetails_data) && $pancard_details != null) {

                                $pancard['pancard']['data']['pandetails1'] = null;
                                $statusCode = $pancard['status_code'];
                                $errorMessage = 'Success';

                                foreach ($pandetails_data as $pan_data) {
                                    $pandetailsinfo['data'][$pan_data] = $pancard['pancard']['data'][$pan_data];
                                }
                                return view('kyc.pandetails_info_new', compact('pandetailsinfo', 'statusCode', 'errorMessage'));
                            } else {
                                $statusCode = $pancard['status_code'];
                                $errorMessage = 'Success';
                                return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'errorMessage'));
                            }
                        } elseif ($pancard['statusCode'] == 102 && $pancard['message'] == 'No Records found!.') {
                            $statusCode = $pancard['statusCode'];
                            $errorMessage = 'No Records Found !';
                            return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'errorMessage'));
                        } elseif ($pancard['statusCode'] == 102 && $pancard['message'] == 'PAN Number InValid Please Enter Correct PanNumber.') {
                            $statusCode = $pancard['statusCode'];
                            $errorMessage = 'PAN Number InValid Please Enter Correct PanNumber.';
                            return view('kyc.pandetails_info_new', compact('pancard', 'statusCode', 'errorMessage'));
                        } else {
                            $statusCode = 500;
                            $errorMessage = 'Internal Server Error.';
                            return view('kyc.pandetails_info_new', compact('statusCode', 'errorMessage'));
                        }
                    } catch (BadResponseException $e) {
                        $response = $e->getResponse();
                        $pancardError = json_decode($response->getBody(), true);
                        $statusCode = $e->getResponse()->getStatusCode();
                        if (isset($pancardError['statusCode']) && $pancardError['statusCode'] == 102) {
                            $statusCode = 102;
                            $errorMessage = 'PAN Number InValid Please Enter Correct PanNumber.';
                            return view('kyc.pandetails_info_new', compact('pancardError', 'statusCode', 'errorMessage'));
                        } else {
                            $statusCode = 500;
                            $errorMessage = 'Internal Server Error.';
                            return view('kyc.pandetails_info_new', compact('pancardError', 'statusCode', 'errorMessage'));
                        }
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.pandetails_info_new', compact('pancardError', 'pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function script_tracing(Request $request)
    {
        // return 'ok1';
        $statusCode = null;
        $pancard = null;
        $pandetailsinfo = null;
        $pancardError = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.script_tracing', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'fname' => $request->fname,
                'lname' => $request->lname,
                'dob' => $request->dob,
                'pan_num' => $request->pan_num,
                'phone_number' => $request->phone_number,
            ];
        
                // return 'yusys';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pandetails1')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                // try {
                    $response = $client->post('http://regtechapi.in/api/script_tracing', ['headers' => $headers, 'json' => $body]);
                    $pancard = json_decode($response->getBody(), true);
                    // return $pancard['statusCode'];
                    // $api_master = ApiMaster::where('api_slug', 'pandetails1')->first();
                    // $pancard_details = UserSchemeMaster::where('user_id', Auth::user()->id)
                    //     ->where('api_id', $api_master->id)
                    //     ->pluck('permission');
                    // return $pancard_details;
                    // $pandetails_data = explode(',', $pancard_details[0]);
                    // if (count($pancard_details) > 0) {
                    //     $pandetails_data = explode(',', $pancard_details[0]);
                    // }
                    //  dd($pandetails_data);
                    if ($pancard['statusCode'] == 200 || $pancard['statusCode'] == 2000) {
                    //    return 'test';
                            $pancard['data'] = null;
                            $statusCode = $pancard['statusCode'];
                            $errorMessage = 'Success';
                            $pandetailsinfo['data'] = $pancard['script_tracing'];
                            return view('kyc.script_tracing', compact('pandetailsinfo', 'statusCode', 'errorMessage'));
                      
                    } elseif ($pancard['statusCode'] == 102 && $pancard['message'] == 'No Records found!.') {
                            // return 'test2';
                        $statusCode = $pancard['statusCode'];
                        $errorMessage = 'No Records Found !';
                        return view('kyc.script_tracing', compact('pancard', 'statusCode', 'errorMessage'));

                    } elseif ($pancard['statusCode'] == 102 && $pancard['message'] == 'PAN Number InValid Please Enter Correct PanNumber.') {
                            // return 'test3';
                        $statusCode = $pancard['statusCode'];
                        $errorMessage = 'PAN Number InValid Please Enter Correct PanNumber.';
                        return view('kyc.script_tracing', compact('pancard', 'statusCode', 'errorMessage'));
                    } else {
                            // return 'test4';
                        $statusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.script_tracing', compact('statusCode', 'errorMessage'));
                    }
                // } catch (BadResponseException $e) {
                //     $response = $e->getResponse();
                //     $pancardError = json_decode($response->getBody(), true);
                //     $statusCode = $e->getResponse()->getStatusCode();
                //     if (isset($pancardError['statusCode']) && $pancardError['statusCode'] == 102) {
                //         $statusCode = 102;
                //         $errorMessage = 'PAN Number InValid Please Enter Correct PanNumber.';
                //         return view('kyc.pandetails_info_new', compact('pancardError', 'statusCode', 'errorMessage'));
                //     } else {
                //         $statusCode = 500;
                //         $errorMessage = 'Internal Server Error.';
                //         return view('kyc.pandetails_info_new', compact('pancardError', 'statusCode', 'errorMessage'));
                //     }
                // }
            
        }
    }

    public function searchkyclite1(Request $request)
    {
        $statusCode = null;
        $pancard = null;
        $pandetailspermission = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $api_slug = 'searchkyclite';

        if ($request->isMethod('GET')) {
            $api_masterInfo = ApiMaster::where('api_slug', 'searchkyclite')->first();
            $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                ->where('api_id', $api_masterInfo->id)
                ->pluck('request_permission')
                ->first();
            if (!empty($searchkyclite)) {
                $searchkyclite_request = explode(',', $searchkyclite);

                return view('kyc.searchkyclite1', compact('pancard', 'searchkyclite_request', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
            }
            return view('kyc.searchkyclite1', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }

        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'pano' => $request->pan_number,
                'dob' => '1990-08-12',
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pancard')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }

                $res = $client->post('http://regtechapi.in/api/search_v2', ['headers' => $headers, 'json' => $body]);
                $pancard = json_decode($res->getBody(), true);
                $api_masterInfo = ApiMaster::where('api_slug', 'searchkyclite')->first();
                $statusCode = $pancard['statusCode'];
                // dd($pancard);
                if (isset($pancard['response']['kycDetails']) && $pancard['response']['statusCode'] == 200) {
                    $pancard_info = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_masterInfo->id)
                        ->pluck('permission');
                    if (isset($pancard_info) && count($pancard_info) > 0) {
                        $pandetails_data = explode(',', $pancard_info[0]);
                        $pancard['response']['kycDetails']['personalIdentifiableData']['personalDetails']['searchkyclite'] = null;
                        $status_code = $pancard['response']['statusCode'];
                        $errorMessage = 'Success';
                        foreach ($pandetails_data as $pan_data) {
                            $pandetailspermission['response']['kycDetails']['personalIdentifiableData']['personalDetails'][$pan_data] = $pancard['response']['kycDetails']['personalIdentifiableData']['personalDetails'][$pan_data];
                        }
                        $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                            ->where('api_id', $api_masterInfo->id)
                            ->pluck('request_permission')
                            ->first();
                        if (!empty($searchkyclite)) {
                            $searchkyclite_request = explode(',', $searchkyclite);
                        }
                        return view('kyc.searchkyclite1', compact('pandetailspermission', 'status_code', 'searchkyclite_request', 'errorMessage'));
                    } else {
                        $status_code = $pancard['response']['statusCode'];
                        $errorMessage = 'Success';
                        return view('kyc.searchkyclite1', compact('status_code', 'errorMessage', 'pancard'));
                    }
                }
                if ($statusCode == 500) {
                    $errorMessage = 'Internal Server Error.';
                    $statusCode = 500;
                    $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_masterInfo->id)
                        ->pluck('request_permission')
                        ->first();
                    if (!empty($searchkyclite)) {
                        $searchkyclite_request = explode(',', $searchkyclite);
                        return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                    } else {
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                    }
                } elseif ($statusCode == 102) {
                    $statusCode = 102;
                    $errorMessage = 'In Correct PAN Number. Please enter correct PAN Number';
                    $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_masterInfo->id)
                        ->pluck('request_permission')
                        ->first();
                    if (!empty($searchkyclite)) {
                        $searchkyclite_request = explode(',', $searchkyclite);
                        return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                    } else {
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                    }
                } elseif ($statusCode == 422) {
                    $statusCode = 422;
                    $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_masterInfo->id)
                        ->pluck('request_permission')
                        ->first();
                    if (!empty($searchkyclite)) {
                        $searchkyclite_request = explode(',', $searchkyclite);
                        return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                    } else {
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                    }
                } elseif ($statusCode == 401) {
                    //  dd('PAN Number is invalid! Please enter a valid PAN Number.');
                    $statusCode = 401;
                    $errorMessage = 'PAN Number is invalid! Please enter a valid PAN Number.';
                    $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_masterInfo->id)
                        ->pluck('request_permission')
                        ->first();
                    if (!empty($searchkyclite)) {
                        $searchkyclite_request = explode(',', $searchkyclite);
                        return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                    } else {
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                    }
                } elseif ($statusCode == 103) {
                    $statusCode = 103;
                    $errorMessage = 'You are not registered to use this service. Please update your plan.';
                    $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                        ->where('api_id', $api_masterInfo->id)
                        ->pluck('request_permission')
                        ->first();
                    if (!empty($searchkyclite)) {
                        $searchkyclite_request = explode(',', $searchkyclite);
                        return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                    } else {
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $statusCode = 500;
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                }
                return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage', 'pancard'));
            } else {
                // return 'type';
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                //    dd($scheme_type);
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        // dd('$hit_count_remaining try21');
                        $res = $client->post('http://regtechapi.in/api/search_v2', ['headers' => $headers, 'json' => $body]);
                        $pancard = json_decode($res->getBody(), true);
                        // return $pancard;
                        //dd($pancard);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                        $api_masterInfo = ApiMaster::where('api_slug', 'searchkyclite')->first();
                        $statusCode = $pancard['statusCode'];
                        if (isset($pancard['response']['kycDetails']) && $pancard['response']['statusCode'] == 200) {
                            $pancard_info = UserSchemeMaster::where('user_id', Auth::user()->id)
                                ->where('api_id', $api_masterInfo->id)
                                ->pluck('permission');
                            if (isset($pancard_info) && count($pancard_info) > 0) {
                                $pandetails_data = explode(',', $pancard_info[0]);
                                $pancard['response']['kycDetails']['personalIdentifiableData']['personalDetails']['searchkyclite'] = null;
                                $status_code = $pancard['response']['statusCode'];
                                $errorMessage = 'Success';
                                // return $pandetails_data;
                                foreach ($pandetails_data as $pan_data) {
                                    $pandetailspermission['response']['kycDetails']['personalIdentifiableData']['personalDetails'][$pan_data] = $pancard['response']['kycDetails']['personalIdentifiableData']['personalDetails'][$pan_data];
                                }
                                $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                                    ->where('api_id', $api_masterInfo->id)
                                    ->pluck('request_permission')
                                    ->first();
                                if (!empty($searchkyclite)) {
                                    $searchkyclite_request = explode(',', $searchkyclite);
                                }
                                return view('kyc.searchkyclite1', compact('pandetailspermission', 'status_code', 'searchkyclite_request', 'errorMessage'));
                            } else {

                                $status_code = $pancard['response']['statusCode'];
                                $errorMessage = 'Success';
                                return view('kyc.searchkyclite1', compact('status_code', 'errorMessage', 'pancard'));
                            }
                        }
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal Server Error.';
                            $statusCode = 500;
                            $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                                ->where('api_id', $api_masterInfo->id)
                                ->pluck('request_permission')
                                ->first();
                            if (!empty($searchkyclite)) {
                                $searchkyclite_request = explode(',', $searchkyclite);
                                return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                            } else {
                                return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                            }
                        } elseif ($statusCode == 102) {
                            $statusCode = 102;
                            $errorMessage = 'In Correct PAN Number. Please enter correct PAN Number';
                            $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                                ->where('api_id', $api_masterInfo->id)
                                ->pluck('request_permission')
                                ->first();
                            if (!empty($searchkyclite)) {
                                $searchkyclite_request = explode(',', $searchkyclite);
                                return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                            } else {
                                return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                            }
                        } elseif ($statusCode == 422) {
                            $statusCode = 422;
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                            $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                                ->where('api_id', $api_masterInfo->id)
                                ->pluck('request_permission')
                                ->first();
                            if (!empty($searchkyclite)) {
                                $searchkyclite_request = explode(',', $searchkyclite);
                                return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                            } else {
                                return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                            }
                        } elseif ($statusCode == 401) {
                            //  dd('PAN Number is invalid! Please enter a valid PAN Number.');
                            $statusCode = 401;
                            $errorMessage = 'PAN Number is invalid! Please enter a valid PAN Number.';
                            $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                                ->where('api_id', $api_masterInfo->id)
                                ->pluck('request_permission')
                                ->first();
                            if (!empty($searchkyclite)) {
                                $searchkyclite_request = explode(',', $searchkyclite);
                                return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                            } else {
                                return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                            }
                        } elseif ($statusCode == 103) {
                            $statusCode = 103;
                            $errorMessage = 'You are not registered to use this service. Please update your plan.';
                            $searchkyclite = UserSchemeMaster::where('user_id', Auth::user()->id)
                                ->where('api_id', $api_masterInfo->id)
                                ->pluck('request_permission')
                                ->first();
                            if (!empty($searchkyclite)) {
                                $searchkyclite_request = explode(',', $searchkyclite);
                                return view('kyc.searchkyclite1', compact('searchkyclite_request', 'statusCode', 'errorMessage'));
                            } else {
                                return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                            }
                        } else {
                            $statusCode = 500;
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage', 'pancard'));
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } elseif ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.searchkyclite1', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.searchkyclite1', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.searchkyclite1', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function ckysearch_advance_api()
    {
        return view('kyc.ckycsearch_advance_api');
    }
    public function ckycSearchAdvance11agust2025(Request $request)
    {
        $statusCode = null;
        $searchkyc = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('GET')) {
            return view('kyc.ckycsearch_advance', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
            ];
            $pano = $request->pan_number;
            $dob = $request->dob;
            $client_ref_num = rand(10000, 99999);
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'searchkycdigitap')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, [
                    CURLOPT_URL => 'http://regtechapi.in/api/ckyc_searchadvance',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => [
                        'pano' => $pano,
                        'client_ref_num' => $client_ref_num,
                        'dob' => $dob,
                        'identifier_type' => 'PAN'
                    ],
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                // $get_data1 = curl_exec($curl1);
                $result = curl_exec($curl1);
                $searchkyc = json_decode($result, true);

                if (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 200 && $searchkyc['response']['status'] == "VALID") {
                    $statusCode = 200;
                    return view('kyc.ckycsearch_advance', compact('statusCode', 'searchkyc'));
                } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 102) {
                    $statusCode = 102;
                    return view('kyc.ckycsearch_advance', compact('statusCode'));
                } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 103) {
                    $statusCode = 103;
                    return view('kyc.ckycsearch_advance', compact('statusCode'));
                } else {
                    $statusCode = 500;
                    return view('kyc.ckycsearch_advance', compact('statusCode'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $curl1 = curl_init();
                    curl_setopt_array($curl1, [
                        CURLOPT_URL => 'http://regtechapi.in/api/ckyc_searchadvance',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => [
                            'pano' => $pano,
                            'client_ref_num' => $client_ref_num,
                            'dob' => $dob,
                            'identifier_type' => 'PAN'
                        ],
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    // $get_data1 = curl_exec($curl1);
                    $result = curl_exec($curl1);
                    $searchkyc = json_decode($result, true);

                    if (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 200 && $searchkyc['response']['status'] == "VALID") {
                        $statusCode = 200;
                        return view('kyc.ckycsearch_advance', compact('statusCode', 'searchkyc', 'hit_limits_exceeded', 'low_wallet_balance'));
                    } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 102) {
                        $statusCode = 102;
                        return view('kyc.ckycsearch_advance', compact('statusCode'));
                    } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 103) {
                        $statusCode = 103;
                        return view('kyc.ckycsearch_advance', compact('statusCode'));
                    } else {
                        $statusCode = 500;
                        return view('kyc.ckycsearch_advance', compact('statusCode'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.ckycsearch_advance', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

        return view('kyc.ckycsearch_advance', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
    //jharkhand
    public function getJharkhandDistract($jhar_district)
    {
        $circles = DB::table('jharkhand')->select('Circle')->where('District', $jhar_district)->groupBy('Circle')->get();
        return response()->json($circles);
    }
    public function getJharkhandCircles($jhar_circle)
    {

        $halkas = DB::table('jharkhand')->select('Halka')->where('Circle', $jhar_circle)->groupBy('Halka')->get();
        return response()->json($halkas);
    }
    public function getJharkhandHalkas($jhar_halka)
    {
        $mauza = DB::table('jharkhand')->select('Mauza')->where('Halka', $jhar_halka)->groupBy('Mauza')->get();
        return response()->json($mauza);
    }
    public function getJharkhandMauza($jhar_mauza)
    {
        $sheet = DB::table('jharkhand')->select('Sheet')->where('Mauza', $jhar_mauza)->groupBy('Sheet')->get();
        return response()->json($sheet);
    }
    //GOA
    public function getGoaDistract($goa_district)
    {
        $taluka = DB::table('goa')->select('Taluka')->where('District', $goa_district)->groupBy('Taluka')->get();
        return response()->json($taluka);
    }
    public function getGoaTaluka($goa_taluk)
    {
        $village = DB::table('goa')->select('Village')->where('Taluka', $goa_taluk)->groupBy('Village')->get();
        return response()->json($village);
    }
    public function getGoaVillage($goa_village)
    {
        $sheetno = DB::table('goa')->select('Sheet')->where('Village', $goa_village)->groupBy('Sheet')->get();
        return response()->json($sheetno);
    }
    //Lakshdaweep
    public function getLakshdaweepDistrict($laksh_district)
    {
        $taluka = DB::table('lakshadweep')->select('Taluk')->where('District', $laksh_district)->groupBy('Taluk')->get();
        return response()->json($taluka);
    }
    public function getLakshdaweepTaluka($laksh_taluka)
    {
        $village = DB::table('lakshadweep')->select('Village')->where('Taluk', $laksh_taluka)->groupBy('Village')->get();
        return response()->json($village);
    }
    public function getLakshdaweepVillage($lakshadweep_village)
    {
        $survey = DB::table('lakshadweep')->select('Survey')->where('Village', $lakshadweep_village)->groupBy('Survey')->get();
        return response()->json($survey);
    }
    //chhatisgarh
    public function getChhatisgarhDistrict(Request $request)
    {

        $distract = DB::table('chhattisgarh')->select('Tehsil')->where('District', $request->distract)->groupBy('Tehsil')->get();
        return response()->json($distract);
    }
    public function getChhatisgarhTehsil($chhatisgarh_tehsil)
    {
        $tehsil = DB::table('chhattisgarh')->select('Ri')->where('Tehsil', $chhatisgarh_tehsil)->groupBy('Ri')->get();
        return response()->json($tehsil);
    }
    public function getChhatisgarhRiCircle($chhatisgarh_ri_circle)
    {
        $village = DB::table('chhattisgarh')->select('Village')->where('Ri', $chhatisgarh_ri_circle)->groupBy('Village')->get();
        return response()->json($village);
    }
    //rajashthan
    public function getRajasthanDistrict(Request $request)
    {
        $distract = DB::table('rajasthan')->select('Tehsil')->where('District', $request->distract)->groupBy('Tehsil')->get();
        return response()->json($distract);
    }
    public function getRajasthanTehsil($rajsthan_tehsil)
    {
        $ricircles = DB::table('rajasthan')->select('Ri')->where('Tehsil', $rajsthan_tehsil)->groupBy('Ri')->get();
        return response()->json($ricircles);
    }
    public function getRajasthanRi($rajsthan_ri)
    {
        $halkas = DB::table('rajasthan')->select('Halkas')->where('Ri', $rajsthan_ri)->groupBy('Halkas')->get();
        return response()->json($halkas);
    }
    public function getRajasthanHalkas($rajsthan_halkas)
    {
        $village = DB::table('rajasthan')->select('Village')->where('Halkas', $rajsthan_halkas)->groupBy('Village')->get();
        return response()->json($village);
    }
    public function getRajasthanVillage($rajsthan_village)
    {
        $sheetNo = DB::table('rajasthan')->select('SheetNo')->where('Village', $rajsthan_village)->groupBy('SheetNo')->get();
        return response()->json($sheetNo);
    }
    //Odisha
    public function getOdishaDistrict(Request $request)
    {
        $tehsil = DB::table('odisha')->select('Tehsil')->where('District', $request->distract)->groupBy('Tehsil')->get();
        return response()->json($tehsil);
    }
    public function getOdishaTehsil($odi_tehsil)
    {

        $ri_circle = DB::table('odisha')->select('Ri')->where('Tehsil', $odi_tehsil)->groupBy('Ri')->get();
        return response()->json($ri_circle);
    }
    public function getOdishaRi($odi_ri)
    {
        $village = DB::table('odisha')->select('Village')->where('Ri', $odi_ri)->groupBy('Village')->get();
        return response()->json($village);
    }
    public function getOdishaVillage($odi_village)
    {
        $sheetNumber = DB::table('odisha')->select('Sheetno')->where('Village', $odi_village)->groupBy('Sheetno')->get();
        return response()->json($sheetNumber);
    }
    //Kerala
    public function getKeralaDistrict(Request $request)
    {
        $taluk = DB::table('kerala')->select('Taluk')->where('District', $request->district)->groupBy('Taluk')->get();
        return response()->json($taluk);
    }
    public function getKeralaTaluk($ker_taluk)
    {
        $village = DB::table('kerala')->select('Village')->where('Taluk', $ker_taluk)->groupBy('Village')->get();
        return response()->json($village);
    }
    public function getKeralaVillage($ker_village)
    {
        $blockno = DB::table('kerala')->select('Blockno')->where('Village', $ker_village)->groupBy('Blockno')->get();
        return response()->json($blockno);
    }
    public function getKeralaBlockNumber($ker_blockNo)
    {
        $surveyNo = DB::table('kerala')->select('Surveyno')->where('Blockno', $ker_blockNo)->groupBy('Surveyno')->get();
        return response()->json($surveyNo);
    }
    public function getKeralaSurveyNumber($ker_surveyNo)
    {
        $subdivno = DB::table('kerala')->select('Subdivno')->where('Surveyno', $ker_surveyNo)->groupBy('Subdivno')->get();
        return response()->json($subdivno);
    }
    public function bhunakasha_dropdown(Request $request)
    {
        $statusCode = null;
        $bhunakasha = null;
        $error_message = null;
        $jharkhand_district = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (!empty($request->states) && $request->get('states') == "bihar") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'state' => $request->states,
                            "District" => $request->br_district,
                            "Subdiv" => $request->br_subdiv,
                            "Circle" => $request->br_circle,
                            "Mauza" => $request->br_mauza,
                            "Surveytype" => $request->br_surveytype,
                            "Mapinstance" => $request->br_mapinstance,
                            "sheetno" => $request->br_sheet_number,
                            "Plotno" => $request->br_plot_number
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('', 'statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                'state' => $request->states,
                                "District" => $request->br_district,
                                "Subdiv" => $request->br_subdiv,
                                "Circle" => $request->br_circle,
                                "Mauza" => $request->br_mauza,
                                "Surveytype" => $request->br_surveytype,
                                "Mapinstance" => $request->br_mapinstance,
                                "sheetno" => $request->br_sheet_number,
                                "Plotno" => $request->br_plot_number
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "jharkhand") {

                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'state' => $request->states,
                            "District" => $request->jhar_district,
                            "Circle" => $request->jhar_circle,
                            "Halka" => $request->jhar_halka,
                            "Mauza" => $request->jhar_mauza,
                            "Sheetno" => $request->jhar_sheetno,
                            "Plotno" => $request->jhar_ploat_number
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'jharkhand_district', 'statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                'state' => $request->states,
                                "District" => $request->jhar_district,
                                "Circle" => $request->jhar_circle,
                                "Halka" => $request->jhar_halka,
                                "Mauza" => $request->jhar_mauza,
                                "Sheetno" => $request->jhar_sheetno,
                                "Plotno" => $request->jhar_ploat_number
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "up") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->up_district,
                            "Tehsil" => $request->up_tehsil,
                            "Village" => $request->up_village,
                            "Plotno" => $request->up_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->up_district,
                                "Tehsil" => $request->up_tehsil,
                                "Village" => $request->up_village,
                                "Plotno" => $request->up_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "chhattisgarh") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->chha_distract,
                            "Tehsil" => $request->chha_tehsil,
                            "Ri" => $request->chha_ri_circle,
                            "Village" => $request->chha_village,
                            "Plotno" => $request->chha_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->chha_distract,
                                "Tehsil" => $request->chha_tehsil,
                                "Ri" => $request->chha_ri_circle,
                                "Village" => $request->chha_village,
                                "Plotno" => $request->chha_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "rajasthan") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->ra_district,
                            "Tehsil" => $request->ra_tehsil,
                            "Ri" => $request->ra_ri_circle,
                            "Halkas" => $request->ra_ri_halkas,
                            "Village" => $request->ra_village,
                            "Sheetno" => $request->ra_sheet_number,
                            "Plotno" => $request->ra_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->ra_district,
                                "Tehsil" => $request->ra_tehsil,
                                "Ri" => $request->ra_ri_circle,
                                "Halkas" => $request->ra_ri_halkas,
                                "Village" => $request->ra_village,
                                "Sheetno" => $request->ra_sheet_number,
                                "Plotno" => $request->ra_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "lakshadweep") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->laksh_district,
                            "Taluk" => $request->laksh_taluk,
                            "Village" => $request->laksh_village,
                            "Survey" => $request->laksh_survey,
                            "Plotno" => $request->laksh_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken]
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->laksh_district,
                                "Taluk" => $request->laksh_taluk,
                                "Village" => $request->laksh_village,
                                "Survey" => $request->laksh_survey,
                                "Plotno" => $request->laksh_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken]
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "kerala") {
                if (Auth::user()->scheme_type != 'demo') {
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->ker_district,
                            "Taluk" => $request->ker_taluk,
                            "Village" => $request->ker_village,
                            "Blockno" => $request->ker_blockno,
                            "Surveyno" => $request->ker_survey_number,
                            "Subdivno" => $request->ker_subdivno,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->ker_district,
                                "Taluk" => $request->ker_taluk,
                                "Village" => $request->ker_village,
                                "Blockno" => $request->ker_blockno,
                                "Surveyno" => $request->ker_survey_number,
                                "Subdivno" => $request->ker_subdivno,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "goa") {
                if (Auth::user()->scheme_type != 'demo') {
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->goa_district,
                            "Taluka" => $request->goa_taluka,
                            "Village" => $request->goa_village,
                            "Sheetno" => $request->goa_sheet_number,
                            "Plotno" => $request->goa_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->goa_district,
                                "Taluka" => $request->goa_taluka,
                                "Village" => $request->goa_village,
                                "Sheetno" => $request->goa_sheet_number,
                                "Plotno" => $request->goa_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "odisha") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->odi_district,
                            "Tehsil" => $request->odi_tehsil,
                            "Ri" => $request->odi_ri_circle,
                            "Village" => $request->odi_village,
                            "Sheetno" => $request->odi_sheetnumber,
                            "Plotno" => $request->odi_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->odi_district,
                                "Tehsil" => $request->odi_tehsil,
                                "Ri" => $request->odi_ri_circle,
                                "Village" => $request->odi_village,
                                "Sheetno" => $request->odi_sheetnumber,
                                "Plotno" => $request->odi_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha[0]['statusCode']) && $bhunakasha[0]['statusCode'] == 403) {
                            $statusCode = 403;
                            $error_message = $bhunakasha[0]['message'];
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha_dropdown', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } else {
                return view('kyc.bhunakasha_dropdown', compact('bhunakasha', 'statusCode'));
            }
        }
    }

    public function bhunakasha_api()
    {
        return view('kyc.bhunaksha_api');
    }
    public function bhunakasha(Request $request)
    {
        $statusCode = null;
        $bhunakasha = null;
        $error_message = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (!empty($request->states) && $request->get('states') == "bihar") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'state' => $request->states,
                            "District" => $request->br_district,
                            "Subdiv" => $request->br_subdiv,
                            "Circle" => $request->br_circle,
                            "Mauza" => $request->br_mauza,
                            "Surveytype" => $request->br_surveytype,
                            "Mapinstance" => $request->br_mapinstance,
                            "sheetno" => $request->br_sheet_number,
                            "Plotno" => $request->br_plot_number
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                'state' => $request->states,
                                "District" => $request->br_district,
                                "Subdiv" => $request->br_subdiv,
                                "Circle" => $request->br_circle,
                                "Mauza" => $request->br_mauza,
                                "Surveytype" => $request->br_surveytype,
                                "Mapinstance" => $request->br_mapinstance,
                                "sheetno" => $request->br_sheet_number,
                                "Plotno" => $request->br_plot_number
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "jharkhand") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'state' => $request->states,
                            "District" => $request->jhar_district,
                            "Circle" => $request->jhar_circle,
                            "Halka" => $request->jhar_halka,
                            "Mauza" => $request->jhar_mauza,
                            "Sheetno" => $request->jhar_sheetno,
                            "Plotno" => $request->jhar_ploat_number
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {

                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                'state' => $request->states,
                                "District" => $request->jhar_district,
                                "Circle" => $request->jhar_circle,
                                "Halka" => $request->jhar_halka,
                                "Mauza" => $request->jhar_mauza,
                                "Sheetno" => $request->jhar_sheetno,
                                "Plotno" => $request->jhar_ploat_number
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "up") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->up_district,
                            "Tehsil" => $request->up_tehsil,
                            "Village" => $request->up_village,
                            "Plotno" => $request->up_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->up_district,
                                "Tehsil" => $request->up_tehsil,
                                "Village" => $request->up_village,
                                "Plotno" => $request->up_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "chhattisgarh") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->chha_distract,
                            "Tehsil" => $request->chha_tehsil,
                            "Ri" => $request->chha_ri_circle,
                            "Village" => $request->chha_village,
                            "Plotno" => $request->chha_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->chha_distract,
                                "Tehsil" => $request->chha_tehsil,
                                "Ri" => $request->chha_ri_circle,
                                "Village" => $request->chha_village,
                                "Plotno" => $request->chha_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "rajasthan") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->ra_district,
                            "Tehsil" => $request->ra_tehsil,
                            "Ri" => $request->ra_ri_circle,
                            "Halkas" => $request->ra_ri_halkas,
                            "Village" => $request->ra_village,
                            "Sheetno" => $request->ra_sheet_number,
                            "Plotno" => $request->ra_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->ra_district,
                                "Tehsil" => $request->ra_tehsil,
                                "Ri" => $request->ra_ri_circle,
                                "Halkas" => $request->ra_ri_halkas,
                                "Village" => $request->ra_village,
                                "Sheetno" => $request->ra_sheet_number,
                                "Plotno" => $request->ra_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "lakshadweep") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->laksh_district,
                            "Taluk" => $request->laksh_taluk,
                            "Village" => $request->laksh_village,
                            "Survey" => $request->laksh_survey,
                            "Plotno" => $request->laksh_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken]
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->laksh_district,
                                "Taluk" => $request->laksh_taluk,
                                "Village" => $request->laksh_village,
                                "Survey" => $request->laksh_survey,
                                "Plotno" => $request->laksh_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken]
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "kerala") {
                if (Auth::user()->scheme_type != 'demo') {
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->ker_district,
                            "Taluk" => $request->ker_taluk,
                            "Village" => $request->ker_village,
                            "Blockno" => $request->ker_blockno,
                            "Surveyno" => $request->ker_survey_number,
                            "Subdivno" => $request->ker_subdivno,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->ker_district,
                                "Taluk" => $request->ker_taluk,
                                "Village" => $request->ker_village,
                                "Blockno" => $request->ker_blockno,
                                "Surveyno" => $request->ker_survey_number,
                                "Subdivno" => $request->ker_subdivno,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "goa") {
                if (Auth::user()->scheme_type != 'demo') {
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->goa_district,
                            "Taluka" => $request->goa_taluka,
                            "Village" => $request->goa_village,
                            "Sheetno" => $request->goa_sheet_number,
                            "Plotno" => $request->goa_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->goa_district,
                                "Taluka" => $request->goa_taluka,
                                "Village" => $request->goa_village,
                                "Sheetno" => $request->goa_sheet_number,
                                "Plotno" => $request->goa_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "odisha") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->odi_district,
                            "Tehsil" => $request->odi_tehsil,
                            "Ri" => $request->odi_ri_circle,
                            "Village" => $request->odi_village,
                            "Sheetno" => $request->odi_sheetnumber,
                            "Plotno" => $request->odi_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->odi_district,
                                "Tehsil" => $request->odi_tehsil,
                                "Ri" => $request->odi_ri_circle,
                                "Village" => $request->odi_village,
                                "Sheetno" => $request->odi_sheetnumber,
                                "Plotno" => $request->odi_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 202) {
                            $statusCode = 202;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } else {
                return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
            }
        }
    }
    public function bhunakashaold(Request $request)
    {
        $statusCode = null;
        $bhunakasha = null;
        $error_message = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (!empty($request->states) && $request->get('states') == "bihar") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'state' => $request->states,
                            "District" => $request->br_district,
                            "Subdiv" => $request->br_subdiv,
                            "Circle" => $request->br_circle,
                            "Mauza" => $request->br_mauza,
                            "Surveytype" => $request->br_surveytype,
                            "Mapinstance" => $request->br_mapinstance,
                            "sheetno" => $request->br_sheet_number,
                            "Plotno" => $request->br_plot_number
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                'state' => $request->states,
                                "District" => $request->br_district,
                                "Subdiv" => $request->br_subdiv,
                                "Circle" => $request->br_circle,
                                "Mauza" => $request->br_mauza,
                                "Surveytype" => $request->br_surveytype,
                                "Mapinstance" => $request->br_mapinstance,
                                "sheetno" => $request->br_sheet_number,
                                "Plotno" => $request->br_plot_number
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "jharkhand") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'state' => $request->states,
                            "District" => $request->jhar_district,
                            "Circle" => $request->jhar_circle,
                            "Halka" => $request->jhar_halka,
                            "Mauza" => $request->jhar_mauza,
                            "Sheetno" => $request->jhar_sheetno,
                            "Plotno" => $request->jhar_ploat_number
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {

                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                'state' => $request->states,
                                "District" => $request->jhar_district,
                                "Circle" => $request->jhar_circle,
                                "Halka" => $request->jhar_halka,
                                "Mauza" => $request->jhar_mauza,
                                "Sheetno" => $request->jhar_sheetno,
                                "Plotno" => $request->jhar_ploat_number
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "up") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->up_district,
                            "Tehsil" => $request->up_tehsil,
                            "Village" => $request->up_village,
                            "Plotno" => $request->up_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->up_district,
                                "Tehsil" => $request->up_tehsil,
                                "Village" => $request->up_village,
                                "Plotno" => $request->up_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "chhattisgarh") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->chha_distract,
                            "Tehsil" => $request->chha_tehsil,
                            "Ri" => $request->chha_ri_circle,
                            "Village" => $request->chha_village,
                            "Plotno" => $request->chha_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->chha_distract,
                                "Tehsil" => $request->chha_tehsil,
                                "Ri" => $request->chha_ri_circle,
                                "Village" => $request->chha_village,
                                "Plotno" => $request->chha_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "rajasthan") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->ra_district,
                            "Tehsil" => $request->ra_tehsil,
                            "Ri" => $request->ra_ri_circle,
                            "Halkas" => $request->ra_ri_halkas,
                            "Village" => $request->ra_village,
                            "Sheetno" => $request->ra_sheet_number,
                            "Plotno" => $request->ra_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->ra_district,
                                "Tehsil" => $request->ra_tehsil,
                                "Ri" => $request->ra_ri_circle,
                                "Halkas" => $request->ra_ri_halkas,
                                "Village" => $request->ra_village,
                                "Sheetno" => $request->ra_sheet_number,
                                "Plotno" => $request->ra_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "lakshadweep") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->laksh_district,
                            "Taluk" => $request->laksh_taluk,
                            "Village" => $request->laksh_village,
                            "Survey" => $request->laksh_survey,
                            "Plotno" => $request->laksh_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken]
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->laksh_district,
                                "Taluk" => $request->laksh_taluk,
                                "Village" => $request->laksh_village,
                                "Survey" => $request->laksh_survey,
                                "Plotno" => $request->laksh_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken]
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "kerala") {
                if (Auth::user()->scheme_type != 'demo') {
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->ker_district,
                            "Taluk" => $request->ker_taluk,
                            "Village" => $request->ker_village,
                            "Blockno" => $request->ker_blockno,
                            "Surveyno" => $request->ker_survey_number,
                            "Subdivno" => $request->ker_subdivno,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->ker_district,
                                "Taluk" => $request->ker_taluk,
                                "Village" => $request->ker_village,
                                "Blockno" => $request->ker_blockno,
                                "Surveyno" => $request->ker_survey_number,
                                "Subdivno" => $request->ker_subdivno,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "goa") {
                if (Auth::user()->scheme_type != 'demo') {
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->goa_district,
                            "Taluka" => $request->goa_taluka,
                            "Village" => $request->goa_village,
                            "Sheetno" => $request->goa_sheet_number,
                            "Plotno" => $request->goa_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->goa_district,
                                "Taluka" => $request->goa_taluka,
                                "Village" => $request->goa_village,
                                "Sheetno" => $request->goa_sheet_number,
                                "Plotno" => $request->goa_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }
                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } elseif (!empty($request->states) && $request->get('states') == "odisha") {
                if (Auth::user()->scheme_type != 'demo') {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "state" => $request->states,
                            "District" => $request->odi_district,
                            "Tehsil" => $request->odi_tehsil,
                            "Ri" => $request->odi_ri_circle,
                            "Village" => $request->odi_village,
                            "Sheetno" => $request->odi_sheetnumber,
                            "Plotno" => $request->odi_plot_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $bhunakasha = json_decode($result, true);
                    if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                        $statusCode = 102;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $bhunakasha['message'];
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                    }
                } else {
                    $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                    $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                    if ($hit_count_remaining > 0) {
                        $curl = curl_init();
                        curl_setopt_array($curl, [
                            CURLOPT_URL => 'http://regtechapi.in/api/bhunaksha',
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_ENCODING => '',
                            CURLOPT_MAXREDIRS => 10,
                            CURLOPT_TIMEOUT => 0,
                            CURLOPT_FOLLOWLOCATION => true,
                            CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                            CURLOPT_CUSTOMREQUEST => 'POST',
                            CURLOPT_POSTFIELDS => array(
                                "state" => $request->states,
                                "District" => $request->odi_district,
                                "Tehsil" => $request->odi_tehsil,
                                "Ri" => $request->odi_ri_circle,
                                "Village" => $request->odi_village,
                                "Sheetno" => $request->odi_sheetnumber,
                                "Plotno" => $request->odi_plot_number,
                            ),
                            CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                        ]);
                        $result = curl_exec($curl);
                        $bhunakasha = json_decode($result, true);
                        if (isset($bhunakasha['data']) && $bhunakasha['status_code'] == 200) {
                            $statusCode = 200;
                            return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 102) {
                            $statusCode = 102;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } elseif (isset($bhunakasha['status_code']) && $bhunakasha['status_code'] == 103) {
                            $statusCode = 103;
                            $error_message = $bhunakasha['message'];
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        } else {
                            $statusCode = 500;
                            $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                            return view('kyc.bhunakasha', compact('statusCode', 'error_message'));
                        }

                    } else {
                        $hit_limits_exceeded = 1;
                        return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                    }
                }
            } else {
                return view('kyc.bhunakasha', compact('bhunakasha', 'statusCode'));
            }
        }
    }


    public function udyam_newapi()
    {
        return view('kyc.udyam_new_api');
    }

    public function udyam_newdetails(Request $request)
    {
        $statusCode = null;
        $udyamcard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('GET')) {

            return view('kyc.udyamdetailsv2', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'udyamsearch')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/udyamdetails',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "UdyamRegNumber" => $request->udyam_number,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $udyamcard = json_decode($result, true);

                if (isset($udyamcard['response']) && $udyamcard['status_code'] == 200) {
                    $statusCode = 200;
                    return view('kyc.udyamdetailsv2', compact('udyamcard', 'statusCode'));
                } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 202) {
                    $statusCode = 202;
                    $error_message = $udyamcard['message'];
                    return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 103) {
                    $statusCode = 103;
                    $error_message = $udyamcard['message'];
                    return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                } elseif (isset($udyamcard[0]['statusCode']) && $udyamcard[0]['statusCode'] == 403) {
                    $statusCode = 403;
                    $error_message = $udyamcard[0]['message'];
                    return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                } else {
                    $statusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/udyamdetails',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "UdyamRegNumber" => $request->udyam_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $udyamcard = json_decode($result, true);
                    if (isset($udyamcard['response']) && $udyamcard['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.udyamdetailsv2', compact('udyamcard', 'statusCode'));
                    } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $udyamcard['message'];
                        return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                    } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $udyamcard['message'];
                        return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                    } elseif (isset($udyamcard[0]['statusCode']) && $udyamcard[0]['statusCode'] == 403) {
                        $statusCode = 403;
                        $error_message = $udyamcard[0]['message'];
                        return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.udyamdetailsv2', compact('statusCode', 'error_message'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.udyamdetailsv2', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.udyamdetailsv2', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }


    public function udyam_newdetails_api_search()
    {
        return view('kyc.udyam_search_new_api');
    }
    public function udyam_newdetails_search(Request $request)
    {
        $statusCode = null;
        $udyamcard = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('GET')) {
            return view('kyc.udyamdetails_search_v2', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'udyamsearch')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/seachv4',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "UdyamRegNumber" => $request->udyam_number,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $udyamcard = json_decode($result, true);
                if (isset($udyamcard['response']) && $udyamcard['status_code'] == 200) {
                    $statusCode = 200;
                    return view('kyc.udyamdetails_search_v2', compact('udyamcard', 'statusCode'));
                } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 202) {
                    $statusCode = 202;
                    $error_message = $udyamcard['message'];
                    return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 103) {
                    $statusCode = 103;
                    $error_message = $udyamcard['message'];
                    return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                } elseif (isset($udyamcard[0]['statusCode']) && $udyamcard[0]['statusCode'] == 403) {
                    $statusCode = 403;
                    $error_message = $udyamcard[0]['message'];
                    return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                } else {
                    $statusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/seachv4',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "UdyamRegNumber" => $request->udyam_number,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $udyamcard = json_decode($result, true);
                    if (isset($udyamcard['response']) && $udyamcard['status_code'] == 200) {
                        $statusCode = 200;
                        return view('kyc.udyamdetails_search_v2', compact('udyamcard', 'statusCode'));
                    } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 202) {
                        $statusCode = 202;
                        $error_message = $udyamcard['message'];
                        return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                    } elseif (isset($udyamcard['status_code']) && $udyamcard['status_code'] == 103) {
                        $statusCode = 103;
                        $error_message = $udyamcard['message'];
                        return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                    } elseif (isset($udyamcard[0]['statusCode']) && $udyamcard[0]['statusCode'] == 403) {
                        $statusCode = 403;
                        $error_message = $udyamcard[0]['message'];
                        return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.udyamdetails_search_v2', compact('statusCode', 'error_message'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.udyamdetails_search_v2', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.udyamdetails_search_v2', compact('udyamcard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function aadhar_ocr_masking(Request $request)
    {
        $statusCode = null;
        $aadhaar_masking = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'aadharmasking')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/aadharcard_mask',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);

                $result = curl_exec($curl);
                $aadhaar_masking = json_decode($result, true);
                if (isset($aadhaar_masking['status_code']) && $aadhaar_masking['status_code'] == 200) {
                    return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'statusCode'));
                } elseif (isset($aadhaar_masking['status_code']) && $aadhaar_masking['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an image.";
                    return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'errorMessage'));
                } elseif (isset($aadhaar_masking['status_code']) && $aadhaar_masking['status_code'] == 404) {

                    $errorMessage = "No image file provided";
                    return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'errorMessage'));
                } else {
                    $amstatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.aadhaar_ocr_masking', compact('amstatusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/aadharcard_mask',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $aadhaar_masking = json_decode($result, true);
                    if (isset($aadhaar_masking['status_code']) && $aadhaar_masking['status_code'] == 200) {

                        return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'statusCode'));
                    } elseif (isset($aadhaar_masking['status_code']) && $aadhaar_masking['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an image.";
                        return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'errorMessage'));
                    } elseif (isset($aadhaar_masking['status_code']) && $aadhaar_masking['status_code'] == 404) {

                        $errorMessage = "No image file provided";
                        return view('kyc.aadhaar_ocr_masking', compact('aadhaar_masking', 'errorMessage'));
                    } else {
                        $amstatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.aadhaar_ocr_masking', compact('amstatusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.aadhaar_ocr_masking', compact('statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function aadharcard_ocr(Request $request)
    {
        $statusCode = null;
        $aadharcardocr = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'aadhaar')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }

                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/aadharcard_ocr',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $aadharcardocr = json_decode($result, true);

                if (isset($aadharcardocr['status_code']) && $aadharcardocr['status_code'] == 200) {

                    return view('kyc.aadharcard_ocr_one', compact('aadharcardocr'));
                } elseif (isset($aadharcardocr['status_code']) && $aadharcardocr['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an aadhar card image.";
                    return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'errorMessage'));
                } elseif (isset($aadharcardocr['status_code']) && $aadharcardocr['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'errorMessage'));
                } else {
                    $astatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'astatusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/aadharcard_ocr',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $aadharcardocr = json_decode($result, true);
                    if (isset($aadharcardocr['status_code']) && $aadharcardocr['status_code'] == 200) {

                        return view('kyc.aadharcard_ocr_one', compact('aadharcardocr'));
                    } elseif (isset($aadharcardocr['status_code']) && $aadharcardocr['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an aadhar card image.";
                        return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'errorMessage'));
                    } elseif (isset($aadharcardocr['status_code']) && $aadharcardocr['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'errorMessage'));
                    } else {
                        $astatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'astatusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.aadharcard_ocr_one', compact('aadharcardocr', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function drivinglicense_ocr(Request $request)
    {
        $statusCode = null;
        $lincensedocr = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {

            return view('kyc.lincense_ocr_one', compact('lincensedocr', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'license')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/drivingLicense_ocr',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $lincensedocr = json_decode($result, true);
                if (isset($lincensedocr['status_code']) && $lincensedocr['status_code'] == 200) {

                    return view('kyc.lincense_ocr_one', compact('lincensedocr'));
                } elseif (isset($lincensedocr['status_code']) && $lincensedocr['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an driving license image.";
                    return view('kyc.lincense_ocr_one', compact('lincensedocr', 'errorMessage'));
                } elseif (isset($lincensedocr['status_code']) && $lincensedocr['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.lincense_ocr_one', compact('lincensedocr', 'errorMessage'));
                } else {
                    $listatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.lincense_ocr_one', compact('lincensedocr', 'listatusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/drivingLicense_ocr',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $lincensedocr = json_decode($result, true);
                    if (isset($lincensedocr['status_code']) && $lincensedocr['status_code'] == 200) {

                        return view('kyc.lincense_ocr_one', compact('lincensedocr'));
                    } elseif (isset($lincensedocr['status_code']) && $lincensedocr['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an driving license image.";
                        return view('kyc.lincense_ocr_one', compact('lincensedocr', 'errorMessage'));
                    } elseif (isset($lincensedocr['status_code']) && $lincensedocr['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.lincense_ocr_one', compact('lincensedocr', 'errorMessage'));
                    } else {
                        $listatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.lincense_ocr_one', compact('lincensedocr', 'listatusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.lincense_ocr_one', compact('lincensedocr', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function pancard_ocr(Request $request)
    {

        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $pancard = null;

        if ($request->isMethod('get')) {
            return view('kyc.pancard_ocr', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pancard')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/pancard_ocr',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                ]);
                $response = curl_exec($curl);
                curl_close($curl);
                $pancard = json_decode($response, true);
                if (isset($pancard['status_code']) && $pancard['status_code'] == 200) {
                    return view('kyc.pancard_ocr', compact('pancard'));
                } elseif (isset($pancard['status_code']) && $pancard['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an  pancard image.";
                    return view('kyc.pancard_ocr', compact('pancard', 'errorMessage'));
                } elseif (isset($pancard['status_code']) && $pancard['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.pancard_ocr', compact('pancard', 'errorMessage'));
                } else {
                    $vostatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.pancard_ocr', compact('pancard', 'vostatusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/pancard_ocr',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                    ]);
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $pancard = json_decode($response, true);
                    if (isset($pancard['status_code']) && $pancard['status_code'] == 200) {
                        return view('kyc.pancard_ocr', compact('pancard'));
                    } elseif (isset($pancard['status_code']) && $pancard['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an  pancard image.";
                        return view('kyc.pancard_ocr', compact('pancard', 'errorMessage'));
                    } elseif (isset($pancard['status_code']) && $pancard['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.pancard_ocr', compact('pancard', 'errorMessage'));
                    } else {
                        $vostatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.pancard_ocr', compact('pancard', 'vostatusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.pancard_ocr', compact('pancard', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function passport_ocr(Request $request)
    {
        $statusCode = null;
        $passport = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.passport_ocr_one', compact('passport', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'passportupload')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }

                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/passport_ocr',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $passport = json_decode($result, true);
                if (isset($passport['status_code']) && $passport['status_code'] == 200) {

                    return view('kyc.passport_ocr_one', compact('passport'));
                } elseif (isset($passport['status_code']) && $passport['status_code'] == 102) {
                    $errorMessage = "Failed to extract MRZ information.";
                    return view('kyc.passport_ocr_one', compact('passport', 'errorMessage'));
                } elseif (isset($passport['status_code']) && $passport['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.passport_ocr_one', compact('passport', 'errorMessage'));
                } else {
                    $pstatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.passport_ocr_one', compact('passport', 'pstatusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/passport_ocr',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $passport = json_decode($result, true);
                    if (isset($passport['status_code']) && $passport['status_code'] == 200) {

                        return view('kyc.passport_ocr_one', compact('passport'));
                    } elseif (isset($passport['status_code']) && $passport['status_code'] == 102) {
                        $errorMessage = "Failed to extract MRZ information.";
                        return view('kyc.passport_ocr_one', compact('passport', 'errorMessage'));
                    } elseif (isset($passport['status_code']) && $passport['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.passport_ocr_one', compact('passport', 'errorMessage'));
                    } else {
                        $pstatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.passport_ocr_one', compact('passport', 'pstatusCode', 'errorMessage'));
                    }

                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.passport_ocr_one', compact('passport', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function voterId_ocr(Request $request)
    {

        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $voterid = null;

        if ($request->isMethod('get')) {
            return view('kyc.voterId_ocr', compact('voterid', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'voter_id')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/voter_ocr',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                ]);
                $response = curl_exec($curl);
                curl_close($curl);
                $voterid = json_decode($response, true);
                if (isset($voterid['status_code']) && $voterid['status_code'] == 200) {

                    return view('kyc.voterId_ocr', compact('voterid'));
                } elseif (isset($voterid['status_code']) && $voterid['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an  voter id image.";
                    return view('kyc.voterId_ocr', compact('voterid', 'errorMessage'));
                } elseif (isset($voterid['status_code']) && $voterid['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.voterId_ocr', compact('voterid', 'errorMessage'));
                } else {
                    $vostatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.voterId_ocr', compact('voterid', 'vostatusCode', 'errorMessage'));
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/voter_ocr',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                    ]);
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $voterid = json_decode($response, true);
                    if (isset($voterid['status_code']) && $voterid['status_code'] == 200) {

                        return view('kyc.voterId_ocr', compact('voterid'));
                    } elseif (isset($voterid['status_code']) && $voterid['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an  voter id image.";
                        return view('kyc.voterId_ocr', compact('voterid', 'errorMessage'));
                    } elseif (isset($voterid['status_code']) && $voterid['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.voterId_ocr', compact('voterid', 'errorMessage'));
                    } else {
                        $vostatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.voterId_ocr', compact('voterid', 'vostatusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.voterId_ocr', compact('voterid', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }

    public function createGeofence(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $create_geofence = null;
        if ($request->isMethod('GET')) {
            return view('kyc.create_geofence', compact('create_geofence', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'creategeofence')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/create_geofence',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'latitude' => $request->latitude,
                        'longitude' => $request->longitude,
                        'radius' => $request->radius
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $create_geofence = json_decode($result, true);
                if (isset($create_geofence['status_code']) && $create_geofence['status_code'] == 200) {
                    return view('kyc.create_geofence', compact('create_geofence'));
                } elseif (isset($create_geofence['status_code']) && $create_geofence['status_code'] == 102) {
                    $error_message = $create_geofence['message'];
                    return view('kyc.create_geofence', compact('create_geofence', 'error_message'));
                } elseif (isset($create_geofence['statusCode']) && $create_geofence['statusCode'] == 103) {
                    $error_message = $create_geofence['message'];
                    return view('kyc.create_geofence', compact('create_geofence', 'error_message'));
                } elseif (isset($create_geofence[0]['statusCode']) && $create_geofence[0]['statusCode'] == 403) {
                    $error_message = $create_geofence[0]['message'];
                    return view('kyc.create_geofence', compact('create_geofence', 'error_message'));
                } else {
                    $geostatusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.create_geofence', compact('geostatusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/create_geofence',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'latitude' => $request->latitude,
                            'longitude' => $request->longitude,
                            'radius' => $request->radius
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $create_geofence = json_decode($result, true);
                    if (isset($create_geofence['status_code']) && $create_geofence['status_code'] == 200) {
                        return view('kyc.create_geofence', compact('create_geofence'));
                    } elseif (isset($create_geofence['status_code']) && $create_geofence['status_code'] == 102) {
                        $error_message = $create_geofence['message'];
                        return view('kyc.create_geofence', compact('create_geofence', 'error_message'));
                    } elseif (isset($create_geofence['statusCode']) && $create_geofence['statusCode'] == 103) {
                        $error_message = $create_geofence['message'];
                        return view('kyc.create_geofence', compact('create_geofence', 'error_message'));
                    } elseif (isset($create_geofence[0]['statusCode']) && $create_geofence[0]['statusCode'] == 403) {
                        $error_message = $create_geofence[0]['message'];
                        return view('kyc.create_geofence', compact('create_geofence', 'error_message'));
                    } else {
                        $geostatusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.create_geofence', compact('geostatusCode', 'error_message'));
                    }

                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.create_geofence', compact('create_geofence', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.create_geofence', compact('create_geofence', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function getPlace(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $get_place = null;
        if ($request->isMethod('GET')) {
            return view('kyc.getplace', compact('get_place', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'getplace')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/get_place',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'longitude' => $request->longitude,
                        'latitude' => $request->latitude
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $get_place = json_decode($result, true);
                if (isset($get_place['status_code']) && $get_place['status_code'] == 200) {
                    return view('kyc.getplace', compact('get_place'));
                } elseif (isset($get_place['status_code']) && $get_place['status_code'] == 102) {
                    $error_message = $get_place['message'];
                    return view('kyc.getplace', compact('get_place', 'error_message'));
                } elseif (isset($get_place['statusCode']) && $get_place['statusCode'] == 103) {
                    $error_message = $get_place['message'];
                    return view('kyc.getplace', compact('get_place', 'error_message'));
                } elseif (isset($get_place[0]['statusCode']) && $get_place[0]['statusCode'] == 403) {
                    $error_message = $get_place[0]['message'];
                    return view('kyc.getplace', compact('get_place', 'error_message'));
                } else {
                    $getplace_statusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.getplace', compact('getplace_statusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/get_place',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'longitude' => $request->longitude,
                            'latitude' => $request->latitude
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $get_place = json_decode($result, true);
                    if (isset($get_place['status_code']) && $get_place['status_code'] == 200) {
                        return view('kyc.getplace', compact('get_place'));
                    } elseif (isset($get_place['status_code']) && $get_place['status_code'] == 102) {
                        $error_message = $get_place['message'];
                        return view('kyc.getplace', compact('get_place', 'error_message'));
                    } elseif (isset($get_place['statusCode']) && $get_place['statusCode'] == 103) {
                        $error_message = $get_place['message'];
                        return view('kyc.getplace', compact('get_place', 'error_message'));
                    } elseif (isset($get_place[0]['statusCode']) && $get_place[0]['statusCode'] == 403) {
                        $error_message = $get_place[0]['message'];
                        return view('kyc.getplace', compact('get_place', 'error_message'));
                    } else {
                        $getplace_statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.getplace', compact('getplace_statusCode', 'error_message'));
                    }

                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.getplace', compact('get_place', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.getplace', compact('get_place', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function getCoordinate(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $get_coordinate = null;
        if ($request->isMethod('GET')) {
            return view('kyc.get_coordinate', compact('get_coordinate', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            $addressText = $request->input('address');
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'getcoordinate')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/get_coordinate',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'address' => $request->input('address'),
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $get_coordinate = json_decode($result, true);
                if (isset($get_coordinate['status_code']) && $get_coordinate['status_code'] == 200) {
                    return view('kyc.get_coordinate', compact('get_coordinate'));
                } elseif (isset($get_coordinate['status_code']) && $get_coordinate['status_code'] == 102) {
                    $error_message = $get_coordinate['message'];
                    return view('kyc.get_coordinate', compact('get_coordinate', 'error_message'));
                } elseif (isset($get_coordinate['statusCode']) && $get_coordinate['statusCode'] == 103) {
                    $error_message = $get_coordinate['message'];
                    return view('kyc.get_coordinate', compact('get_coordinate', 'error_message'));
                } elseif (isset($get_coordinate[0]['statusCode']) && $get_coordinate[0]['statusCode'] == 403) {
                    $error_message = $get_coordinate[0]['message'];
                    return view('kyc.get_coordinate', compact('get_coordinate', 'error_message'));
                } else {
                    $getcostatusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.get_coordinate', compact('getcostatusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/get_coordinate',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'address' => $request->input('address'),
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $get_coordinate = json_decode($result, true);
                    if (isset($get_coordinate['status_code']) && $get_coordinate['status_code'] == 200) {
                        return view('kyc.get_coordinate', compact('get_coordinate'));
                    } elseif (isset($get_coordinate['status_code']) && $get_coordinate['status_code'] == 102) {
                        $error_message = $get_coordinate['message'];
                        return view('kyc.get_coordinate', compact('get_coordinate', 'error_message'));
                    } elseif (isset($get_coordinate['statusCode']) && $get_coordinate['statusCode'] == 103) {
                        $error_message = $get_coordinate['message'];
                        return view('kyc.get_coordinate', compact('get_coordinate', 'error_message'));
                    } elseif (isset($get_coordinate[0]['statusCode']) && $get_coordinate[0]['statusCode'] == 403) {
                        $error_message = $get_coordinate[0]['message'];
                        return view('kyc.get_coordinate', compact('get_coordinate', 'error_message'));
                    } else {
                        $getcostatusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.get_coordinate', compact('getcostatusCode', 'error_message'));
                    }

                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.get_coordinate', compact('get_coordinate', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.get_coordinate', compact('get_coordinate', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function verifyAddress(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $verify_address = null;
        if ($request->isMethod('GET')) {

            return view('kyc.verify_address', compact('verify_address', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'verifyaddress')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/verify_address',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['address' => $request->address],
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $verify_address = json_decode($result, true);
                if (isset($verify_address['status_code']) && $verify_address['status_code'] == 200) {
                    return view('kyc.verify_address', compact('verify_address'));
                } elseif (isset($verify_address['status_code']) && $verify_address['status_code'] == 102) {
                    $error_message = $verify_address['message'];
                    return view('kyc.verify_address', compact('verify_address', 'error_message'));
                } elseif (isset($verify_address['status_code']) && $verify_address['status_code'] == 202) {
                    $error_message = $verify_address['message'];
                    return view('kyc.verify_address', compact('verify_address', 'error_message'));
                } elseif (isset($verify_address['statusCode']) && $verify_address['statusCode'] == 103) {
                    $error_message = $verify_address['message'];
                    return view('kyc.verify_address', compact('verify_address', 'error_message'));
                } elseif (isset($verify_address[0]['statusCode']) && $verify_address[0]['statusCode'] == 403) {
                    $error_message = $verify_address[0]['message'];
                    return view('kyc.verify_address', compact('verify_address', 'error_message'));
                } else {
                    $statusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.verify_address', compact('statusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/verify_address',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['address' => $request->address],
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $verify_address = json_decode($result, true);
                    if (isset($verify_address['status_code']) && $verify_address['status_code'] == 200) {
                        return view('kyc.verify_address', compact('verify_address'));
                    } elseif (isset($verify_address['status_code']) && $verify_address['status_code'] == 102) {
                        $error_message = $verify_address['message'];
                        return view('kyc.verify_address', compact('verify_address', 'error_message'));
                    } elseif (isset($verify_address['status_code']) && $verify_address['status_code'] == 202) {
                        $error_message = $verify_address['message'];
                        return view('kyc.verify_address', compact('verify_address', 'error_message'));
                    } elseif (isset($verify_address['statusCode']) && $verify_address['statusCode'] == 103) {
                        $error_message = $verify_address['message'];
                        return view('kyc.verify_address', compact('verify_address', 'error_message'));
                    } elseif (isset($verify_address[0]['statusCode']) && $verify_address[0]['statusCode'] == 403) {
                        $error_message = $verify_address[0]['message'];
                        return view('kyc.verify_address', compact('verify_address', 'error_message'));
                    } else {
                        $statusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.verify_address', compact('statusCode', 'error_message'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.verify_address', compact('verify_address', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.verify_address', compact('verify_address', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function autopopulateAddressSearch(Request $request)
    {

        $accessToken = Auth::user()->access_token;
        $addressText = $request->input('text');
        $maxResult = intval($request->input('max_result'));
        if (Auth::user()->scheme_type != 'demo') {
            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'autocomplate')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
            $curl = curl_init();
            curl_setopt_array($curl, [
                CURLOPT_URL => 'http://regtechapi.in/api/seachv4',
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => '',
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => 'POST',
                CURLOPT_POSTFIELDS => array(
                    'address_type' => 'auto_complate',
                    'text' => $addressText,
                    'maxResult' => $maxResult,
                ),
                CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
            ]);
            $result = curl_exec($curl);
            $auto_complate = json_decode($result, true);

            if (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 200) {

                return response()->json(['data' => $auto_complate]);
            } elseif (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 102) {
                $error_message = $auto_complate['message'];
                return response()->json(['data' => $auto_complate]);

            } elseif (isset($auto_complate['statusCode']) && $auto_complate['statusCode'] == 103) {
                $error_message = $auto_complate['message'];
                return response()->json(['data' => $auto_complate]);
            } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 404) {
                $error_message = $auto_complate[0]['message'];
                return response()->json(['data' => $auto_complate]);
            } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 403) {
                $error_message = $auto_complate[0]['message'];
                return response()->json(['data' => $auto_complate]);
            } else {
                $autostatusCode = 500;
                $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                return response()->json(['data' => $autostatusCode, 'message' => $error_message]);
            }
        } else {
            $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
            $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
            if ($hit_count_remaining > 0) {
                $user = User::where('id', Auth::user()->id)->first();
                $user->scheme_hit_count = $user->scheme_hit_count + 1;
                $user->save();
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/seachv4',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'address_type' => 'auto_complate',
                        'text' => $addressText,
                        'maxResult' => $maxResult,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $auto_complate = json_decode($result, true);
                if (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 200) {

                    return response()->json(['data' => $auto_complate]);
                } elseif (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 102) {
                    $error_message = $auto_complate['message'];
                    return response()->json(['data' => $auto_complate]);

                } elseif (isset($auto_complate['statusCode']) && $auto_complate['statusCode'] == 103) {
                    $error_message = $auto_complate['message'];
                    return response()->json(['data' => $auto_complate]);
                } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 404) {
                    $error_message = $auto_complate[0]['message'];
                    return response()->json(['data' => $auto_complate]);
                } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 403) {
                    $error_message = $auto_complate[0]['message'];
                    return response()->json(['data' => $auto_complate]);
                } else {
                    $autostatusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return response()->json(['data' => $autostatusCode, 'message' => $error_message]);
                }
            } else {
                $hit_limits_exceeded = 1;
                $low_wallet_balance = 0;
                return response()->json(['hit_limits_exceeded' => $hit_limits_exceeded, 'low_wallet_balance' => $low_wallet_balance]);
            }
        }
    }

    public function autoFatchAddress(Request $request)
    {
        $accessToken = Auth::user()->access_token;
        $addressText = $request->input('text');
        $maxResult = intval($request->input('max_result'));
        if (Auth::user()->scheme_type != 'demo') {
            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'autocomplate')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
            $curl = curl_init();
            curl_setopt_array($curl, [
                CURLOPT_URL => 'http://regtechapi.in/api/autocomplete',
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => '',
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 0,
                CURLOPT_FOLLOWLOCATION => true,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => 'POST',
                CURLOPT_POSTFIELDS => array(
                    'text' => $addressText,
                    'maxResult' => $maxResult,
                ),
                CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
            ]);
            $result = curl_exec($curl);
            $auto_complate = json_decode($result, true);

            if (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 200) {

                return response()->json(['data' => $auto_complate]);
            } elseif (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 102) {
                $error_message = $auto_complate['message'];
                return response()->json(['data' => $auto_complate]);

            } elseif (isset($auto_complate['statusCode']) && $auto_complate['statusCode'] == 103) {
                $error_message = $auto_complate['message'];
                return response()->json(['data' => $auto_complate]);
            } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 404) {
                $error_message = $auto_complate[0]['message'];
                return response()->json(['data' => $auto_complate]);
            } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 403) {
                $error_message = $auto_complate[0]['message'];
                return response()->json(['data' => $auto_complate]);
            } else {
                $autostatusCode = 500;
                $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                return response()->json(['data' => $autostatusCode, 'message' => $error_message]);
            }
        } else {
            $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
            $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
            if ($hit_count_remaining > 0) {
                $user = User::where('id', Auth::user()->id)->first();
                $user->scheme_hit_count = $user->scheme_hit_count + 1;
                $user->save();
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/autocomplete',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'text' => $addressText,
                        'maxResult' => $maxResult,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $auto_complate = json_decode($result, true);
                if (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 200) {

                    return response()->json(['data' => $auto_complate]);
                } elseif (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 102) {
                    $error_message = $auto_complate['message'];
                    return response()->json(['data' => $auto_complate]);

                } elseif (isset($auto_complate['statusCode']) && $auto_complate['statusCode'] == 103) {
                    $error_message = $auto_complate['message'];
                    return response()->json(['data' => $auto_complate]);
                } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 404) {
                    $error_message = $auto_complate[0]['message'];
                    return response()->json(['data' => $auto_complate]);
                } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 403) {
                    $error_message = $auto_complate[0]['message'];
                    return response()->json(['data' => $auto_complate]);
                } else {
                    $autostatusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return response()->json(['data' => $autostatusCode, 'message' => $error_message]);
                }
            } else {
                $hit_limits_exceeded = 1;
                $low_wallet_balance = 0;
                return response()->json(['hit_limits_exceeded' => $hit_limits_exceeded, 'low_wallet_balance' => $low_wallet_balance]);
            }
        }
    }

    public function autoComplate(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $auto_complate = null;
        if ($request->isMethod('GET')) {
            return view('kyc.autocomplate', compact('auto_complate', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            $addressText = $request->input('text');
            $maxResult = intval($request->input('max_result'));
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'autocomplate')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/autocomplete',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'text' => $addressText,
                        'maxResult' => $maxResult,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $auto_complate = json_decode($result, true);

                if (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 200) {
                    return view('kyc.autocomplate', compact('auto_complate'));
                } elseif (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 102) {
                    $error_message = $auto_complate['message'];
                    return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                } elseif (isset($auto_complate['statusCode']) && $auto_complate['statusCode'] == 103) {
                    $error_message = $auto_complate['message'];
                    return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 404) {
                    $error_message = $auto_complate[0]['message'];
                    return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 403) {
                    $error_message = $auto_complate[0]['message'];
                    return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                } else {
                    $autostatusCode = 500;
                    $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                    return view('kyc.autocomplate', compact('autostatusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/autocomplete',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'text' => $addressText,
                            'maxResult' => $maxResult,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $auto_complate = json_decode($result, true);
                    if (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 200) {
                        return view('kyc.autocomplate', compact('auto_complate'));
                    } elseif (isset($auto_complate['status_code']) && $auto_complate['status_code'] == 102) {
                        $error_message = $auto_complate['message'];
                        return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                    } elseif (isset($auto_complate['statusCode']) && $auto_complate['statusCode'] == 103) {
                        $error_message = $auto_complate['message'];
                        return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                    } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 404) {
                        $error_message = $auto_complate[0]['message'];
                        return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                    } elseif (isset($auto_complate[0]['statusCode']) && $auto_complate[0]['statusCode'] == 403) {
                        $error_message = $auto_complate[0]['message'];
                        return view('kyc.autocomplate', compact('auto_complate', 'error_message'));
                    } else {
                        $autostatusCode = 500;
                        $error_message = "Internal Server Error. Please contact techsupport@docboyz.in.";
                        return view('kyc.autocomplate', compact('autostatusCode', 'error_message'));
                    }

                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.autocomplate', compact('auto_complate', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.autocomplate', compact('auto_complate', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
    public function pantogst(Request $request)
    {
       
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $pantogstDetails = null;
        if ($request->isMethod('GET')) {
            return view('kyc.pantogst', compact('pantogstDetails', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pantogst')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/pantogst',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'pancard_number' => $request->pancardNumber,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $pantogstDetails = json_decode($result, true);
                // return $pantogstDetails;
                if (isset($pantogstDetails['status_code']) && $pantogstDetails['status_code'] == 200) {
                    return view('kyc.pantogst', compact('pantogstDetails'));
                } elseif (isset($pantogstDetails['statusCode']) && $pantogstDetails['statusCode'] == 102) {
                    $error_message = $pantogstDetails['message'];
                    return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                } elseif (isset($pantogstDetails['statusCode']) && $pantogstDetails['statusCode'] == 103) {
                    $error_message = $pantogstDetails['message'];
                    return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                } elseif (isset($pantogstDetails[0]['statusCode']) && $pantogstDetails[0]['statusCode'] == 403) {
                    $error_message = $pantogstDetails[0]['message'];
                    return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                } elseif (isset($pantogstDetails[0]['statusCode']) && $pantogstDetails[0]['statusCode'] == 404) {
                    $error_message = $pantogstDetails[0]['message'];
                    return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                } else {
                    $pangststatusCode = 500;
                    $error_message = "Internal Server Error.";
                    return view('kyc.pantogst', compact('pangststatusCode', 'error_message'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/pantogst',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'pancard_number' => $request->pancardNumber,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $pantogstDetails = json_decode($result, true);
                    if (isset($pantogstDetails['status_code']) && $pantogstDetails['status_code'] == 200) {
                        return view('kyc.pantogst', compact('pantogstDetails'));
                    } elseif (isset($pantogstDetails['statusCode']) && $pantogstDetails['statusCode'] == 102) {
                        $error_message = $pantogstDetails['message'];
                        return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                    } elseif (isset($pantogstDetails['statusCode']) && $pantogstDetails['statusCode'] == 103) {
                        $error_message = $pantogstDetails['message'];
                        return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                    } elseif (isset($pantogstDetails[0]['statusCode']) && $pantogstDetails[0]['statusCode'] == 403) {
                        $error_message = $pantogstDetails[0]['message'];
                        return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                    } elseif (isset($pantogstDetails[0]['statusCode']) && $pantogstDetails[0]['statusCode'] == 404) {
                        $error_message = $pantogstDetails[0]['message'];
                        return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                    } else {
                        $pangststatusCode = 500;
                        $error_message = "Internal Server Error.";
                        return view('kyc.pantogst', compact('pantogstDetails', 'error_message'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.pantogst', compact('pantogstDetails', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.pantogst', compact('pantogstDetails', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
    public function pantogstapi()
    {
        return view('kyc.pantogst_api');
    }
    public function basicGstinVerification(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $BasicGstinVerification = null;
        if ($request->isMethod('GET')) {
            return view('kyc.basicGstin', compact('BasicGstinVerification', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'gstin')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/gstverification',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        'gstin_number' => $request->gstinNumber,
                    ),
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $BasicGstinVerification = json_decode($result, true);
                if (isset($BasicGstinVerification['status_code']) && $BasicGstinVerification['status_code'] == 200) {
                    return view('kyc.basicGstin', compact('BasicGstinVerification'));
                } elseif (isset($BasicGstinVerification['statusCode']) && $BasicGstinVerification['statusCode'] == 102 || isset($BasicGstinVerification['status_code']) && $BasicGstinVerification['status_code'] == 102) {
                    $error_message = $BasicGstinVerification['message'];
                    return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                } elseif (isset($BasicGstinVerification['statusCode']) && $BasicGstinVerification['statusCode'] == 103) {
                    $error_message = $BasicGstinVerification['message'];
                    return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                } elseif (isset($BasicGstinVerification[0]['statusCode']) && $BasicGstinVerification[0]['statusCode'] == 403) {
                    $error_message = $BasicGstinVerification[0]['message'];
                    return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                } elseif (isset($BasicGstinVerification[0]['statusCode']) && $BasicGstinVerification[0]['statusCode'] == 404) {
                    $error_message = $BasicGstinVerification[0]['message'];
                    return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                } elseif (isset($BasicGstinVerification['statusCode']) && $BasicGstinVerification['statusCode'] == 500) {
                    $error_message = $BasicGstinVerification['message'];
                    return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                } else {
                    $basicgstinStatusCode = 500;
                    return view('kyc.basicGstin', compact('BasicGstinVerification'));
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/gstverification',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            'gstin_number' => $request->gstinNumber,
                        ),
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $BasicGstinVerification = json_decode($result, true);
                    if (isset($BasicGstinVerification['status_code']) && $BasicGstinVerification['status_code'] == 200) {
                        return view('kyc.basicGstin', compact('BasicGstinVerification'));
                    } elseif (isset($BasicGstinVerification['statusCode']) && $BasicGstinVerification['statusCode'] == 102 || isset($BasicGstinVerification['status_code']) && $BasicGstinVerification['status_code'] == 102) {
                        $error_message = $BasicGstinVerification['message'];
                        return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                    } elseif (isset($BasicGstinVerification['statusCode']) && $BasicGstinVerification['statusCode'] == 103) {
                        $error_message = $BasicGstinVerification['message'];
                        return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                    } elseif (isset($BasicGstinVerification[0]['statusCode']) && $BasicGstinVerification[0]['statusCode'] == 403) {
                        $error_message = $BasicGstinVerification[0]['message'];
                        return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                    } elseif (isset($BasicGstinVerification[0]['statusCode']) && $BasicGstinVerification[0]['statusCode'] == 404) {
                        $error_message = $BasicGstinVerification[0]['message'];
                        return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                    } elseif (isset($BasicGstinVerification['statusCode']) && $BasicGstinVerification['statusCode'] == 500) {
                        $error_message = $BasicGstinVerification['message'];
                        return view('kyc.basicGstin', compact('BasicGstinVerification', 'error_message'));
                    } else {
                        $basicgstinStatusCode = 500;
                        return view('kyc.basicGstin', compact('BasicGstinVerification'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.basicGstin', compact('BasicGstinVerification', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.basicGstin', compact('BasicGstinVerification', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
    public function basicGstinVerificationApi()
    {
        return view('kyc.basicgstin_api');
    }
    public function corporate_basic_api()
    {
        return view('kyc.corporate_cin_basic_apis');
    }
    public function corporate_basic(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $corporate_basic = null;
        if ($request->isMethod('GET')) {
            return view('kyc.corporate_cin_basic', compact('corporate_basic', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'cinbasic')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/corporate_cin_basicv2',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array('cin_number' => $request->cin_number),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));

                $response = curl_exec($curl);
                curl_close($curl);
                $corporate_basic = json_decode($response, true);
                if (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 200) {
                    return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 102) {
                    return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 201) {
                    return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 103) {
                    return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 500) {
                    return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                } else {
                    $cinadbasicStatusCode = 500;
                    return view('kyc.corporate_cin_basic', compact('cinadbasicStatusCode'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/corporate_cin_basicv2',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array('cin_number' => $request->cin_number),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));

                    $response = curl_exec($curl);
                    curl_close($curl);
                    $corporate_basic = json_decode($response, true);
                    if (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 200) {
                        return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                    } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 102) {
                        return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                    } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 201) {
                        return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                    } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 103) {
                        return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                    } elseif (isset($corporate_basic['statusCode']) && $corporate_basic['statusCode'] == 500) {
                        return view('kyc.corporate_cin_basic', compact('corporate_basic'));
                    } else {
                        $cinadbasicStatusCode = 500;
                        return view('kyc.corporate_cin_basic', compact('cinadbasicStatusCode'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.corporate_cin_basic', compact('corporate_basic', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function corporate_advanced_api()
    {

        return view('kyc.corporate_cin_advanced_apis');
    }
    public function corporate_advanced(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $corporate_advance = null;
        if ($request->isMethod('GET')) {
            return view('kyc.corporate_cin_advance', compact('corporate_advance', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'cin')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/corporate_cin_advancev2',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array('cinNumber' => $request->cinNumber),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));

                $response = curl_exec($curl);
                curl_close($curl);
                $corporate_advance = json_decode($response, true);
                if (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 200) {
                    return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 102) {
                    return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 201) {
                    return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 103) {
                    return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 500) {
                    return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                } else {
                    $cinadvancedStatusCode = 500;
                    return view('kyc.corporate_cin_advance', compact('cinadvancedStatusCode'));
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/corporate_cin_advancev2',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array('cinNumber' => $request->cinNumber),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));

                    $response = curl_exec($curl);
                    curl_close($curl);
                    $corporate_advance = json_decode($response, true);
                    if (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 200) {
                        return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                    } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 102) {
                        return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                    } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 201) {
                        return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                    } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 103) {
                        return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                    } elseif (isset($corporate_advance['statusCode']) && $corporate_advance['statusCode'] == 500) {
                        return view('kyc.corporate_cin_advance', compact('corporate_advance'));
                    } else {
                        $cinadvancedStatusCode = 500;
                        return view('kyc.corporate_cin_advance', compact('cinadvancedStatusCode'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.corporate_cin_advance', compact('corporate_advance', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function verify_email(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $verify_email = null;
        if ($request->isMethod('GET')) {
            return view('kyc.email_verify', compact('verify_email', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'verifyemail')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/verify_email',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "email_to_verify" => $request->email_id,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $verify_email = json_decode($response, true);
                if (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 200) {

                    return view('kyc.email_verify', compact('verify_email'));
                } elseif (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 102) {
                    $error_message = $verify_email['message'];
                    return view('kyc.email_verify', compact('verify_email', 'error_message'));
                } elseif (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 103) {
                    $error_message = $verify_email['message'];
                    return view('kyc.email_verify', compact('verify_email', 'error_message'));
                } elseif (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 500) {
                    $error_message = $verify_email['message'];
                    return view('kyc.email_verify', compact('verify_email', 'error_message'));
                } else {
                    $verifyEmailStatusCode = 500;
                    return view('kyc.email_verify');
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/verify_email',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "email_to_verify" => $request->email_id,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $verify_email = json_decode($response, true);
                    if (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 200) {

                        return view('kyc.email_verify', compact('verify_email'));
                    } elseif (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 102) {
                        $error_message = $verify_email['message'];
                        return view('kyc.email_verify', compact('verify_email', 'error_message'));
                    } elseif (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 103) {
                        $error_message = $verify_email['message'];
                        return view('kyc.email_verify', compact('verify_email', 'error_message'));
                    } elseif (isset($verify_email['statusCode']) && $verify_email['statusCode'] == 500) {
                        $error_message = $verify_email['message'];
                        return view('kyc.email_verify', compact('verify_email', 'error_message'));
                    } else {
                        $verifyEmailStatusCode = 500;
                        return view('kyc.email_verify');
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.email_verify', compact('email_verify', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function check_verify_email_status(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $check_verify_email_status = null;
        if ($request->isMethod('GET')) {
            return view('kyc.check_email_varifaction_status', compact('check_verify_email_status', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'checkverificationemailstatus')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/check_verification_email_status',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "identity" => $request->email_id,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $check_verify_email_status = json_decode($response, true);

                if (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 200) {
                    return view('kyc.check_email_varifaction_status', compact('check_verify_email_status'));
                } elseif (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 102) {
                    return view('kyc.check_email_varifaction_status', compact('verify_email'));
                } elseif (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 103) {
                    return view('kyc.check_email_varifaction_status', compact('verify_email'));
                } elseif (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 500) {
                    return view('kyc.check_email_varifaction_status', compact('verify_email'));
                } else {
                    $verifyEmailStatusCode = 500;
                    return view('kyc.check_email_varifaction_status', compact('verifyEmailStatusCode'));
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/check_verification_email_status',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "identity" => $request->email_id,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $check_verify_email_status = json_decode($response, true);

                    if (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 200) {
                        return view('kyc.check_email_varifaction_status', compact('check_verify_email_status'));
                    } elseif (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 102) {
                        $error_message = $check_verify_email_status['message'];
                        return view('kyc.check_email_varifaction_status', compact('check_verify_email_status', 'error_message'));
                    } elseif (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 103) {
                        $error_message = $check_verify_email_status['message'];
                        return view('kyc.check_email_varifaction_status', compact('check_verify_email_status', 'error_message'));
                    } elseif (isset($check_verify_email_status['statusCode']) && $check_verify_email_status['statusCode'] == 500) {
                        $error_message = $check_verify_email_status['message'];
                        return view('kyc.check_email_varifaction_status', compact('check_verify_email_status', 'error_message'));
                    } else {
                        $verifyEmailStatusCode = 500;
                        return view('kyc.check_email_varifaction_status', compact('verifyEmailStatusCode'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.check_email_varifaction_status', compact('check_verify_email_status', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

    }
    public function email_verify_api()
    {
        return view('kyc.email_verify_api');
    }
    public function check_verify_email_status_api()
    {
        return view('kyc.check_email_verifaction_status_api');
    }
    public function dedupe(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $dedupe_details = null;
        if ($request->isMethod('GET')) {
            return view('kyc.dedupe', compact('dedupe_details', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $accessToken = Auth::user()->access_token;
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'dedupe')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/dedupe_s3',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "bucket_name" => $request->bucket_name,
                        "prefix" => $request->prefix,
                        "aws_access_key_id" => $request->aws_access_key_id,
                        "aws_secret_access_key" => $request->aws_secret_access_key,
                        "region_name" => $request->region_name,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $dedupe_details = json_decode($response, true);
                if (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 200) {
                    return view('kyc.dedupe', compact('dedupe_details'));
                } elseif (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 102) {
                    $error_message = $dedupe_details['message'];
                    return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                } elseif (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 103) {
                    $error_message = $dedupe_details['message'];
                    return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                } elseif (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 500) {
                    $error_message = $dedupe_details['message'];
                    return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                } else {
                    $dedupeStatusCode = 500;
                    return view('kyc.dedupe');
                }

            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/dedupe_s3',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "bucket_name" => $request->bucket_name,
                            "prefix" => $request->prefix,
                            "aws_access_key_id" => $request->aws_access_key_id,
                            "aws_secret_access_key" => $request->aws_secret_access_key,
                            "region_name" => $request->region_name,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $dedupe_details = json_decode($response, true);
                    if (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 200) {
                        return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                    } elseif (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 102) {
                        $error_message = $dedupe_details['message'];
                        return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                    } elseif (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 103) {
                        $error_message = $dedupe_details['message'];
                        return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                    } elseif (isset($dedupe_details['statusCode']) && $dedupe_details['statusCode'] == 500) {
                        $error_message = $dedupe_details['message'];
                        return view('kyc.dedupe', compact('dedupe_details', 'error_message'));
                    } else {
                        $dedupeStatusCode = 500;
                        return view('kyc.dedupe');
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.dedupe', compact('dedupe_details', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function dedupe_api()
    {
        return view('kyc.dedupe_api');
    }
    public function company_product(Request $request)
    {
        $statusCode = null;
        $companyProductDetails = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.company_product', compact('companyProductDetails', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $companyName = $request->company_name;
                $flrsLicenseNo = $request->license_no;
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/company-products',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "companyName" => $companyName,
                        "flrsLicenseNo" => $flrsLicenseNo
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));

                $response = curl_exec($curl);
                curl_close($curl);
                $companyProductDetails = json_decode($response, true);
                if (isset($companyProductDetails['status_code']) && $companyProductDetails['status_code'] == 200) {
                    return view('kyc.company_product', compact('companyProductDetails'));
                }
                return view('kyc.company_product', compact('companyProductDetails'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $companyName = $request->company_name;
                    $flrsLicenseNo = $request->license_no;
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/company-products',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "companyName" => $companyName,
                            "flrsLicenseNo" => $flrsLicenseNo
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));

                    $response = curl_exec($curl);
                    curl_close($curl);
                    $companyProductDetails = json_decode($response, true);
                    if (isset($companyProductDetails['status_code']) && $companyProductDetails['status_code'] == 200) {
                        return view('kyc.company_product', compact('companyProductDetails'));
                    }
                    return view('kyc.company_product', compact('companyProductDetails'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.company_product', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function company_product_api()
    {
        return view('kyc.company_product_api');
    }
    public function community_area(Request $request)
    {
        $statusCode = null;
        $community_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.community_area', compact('community_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $longitude = $request->latitude;
                $latitude = $request->longitude;
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/community_area',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "latitude" => $latitude,
                        "longitude" => $longitude
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));

                $response = curl_exec($curl);
                curl_close($curl);
                $community_details = json_decode($response, true);
                if (isset($community_details['status']) && $community_details['status'] == 200) {
                    return view('kyc.community_area', compact('community_details'));
                }
                return view('kyc.community_area', compact('community_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $longitude = $request->latitude;
                    $latitude = $request->longitude;
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/community_area',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "latitude" => $latitude,
                            "longitude" => $longitude
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));

                    $response = curl_exec($curl);
                    curl_close($curl);
                    $community_details = json_decode($response, true);
                    if (isset($community_details['status']) && $community_details['status'] == 200) {
                        return view('kyc.community_area', compact('community_details'));
                    }
                    return view('kyc.community_area', compact('community_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.community_area', compact('', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function community_area_api()
    {
        return view('kyc.community_area_api');
    }
    public function land_record(Request $request)
    {
        $statusCode = null;
        $land_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.land_record', compact('land_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $url = $request->url;
                $original_ploat = $request->original_ploat_number;
                $gstStateCode = $request->gst_state_code;
                $levels = $request->levels;
                $xCoordinate = $request->x_coordinate;
                $yCoordinate = $request->y_coordinate;
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/land',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "Url" => $url,
                        "OP" => $original_ploat,
                        "GstStateCode" => $gstStateCode,
                        "Levels" => $levels,
                        "X_Coordinate" => $xCoordinate,
                        "Y_Coordinate" => $yCoordinate,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));

                $response = curl_exec($curl);
                curl_close($curl);
                $land_details = json_decode($response, true);
                if (isset($land_details['status']) && $land_details['status'] == 200) {
                    return view('kyc.land_record', compact('land_details'));
                }
                return view('kyc.land_record', compact('land_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $url = $request->url;
                    $original_ploat = $request->original_ploat_number;
                    $gstStateCode = $request->gst_state_code;
                    $levels = $request->levels;
                    $xCoordinate = $request->x_coordinate;
                    $yCoordinate = $request->y_coordinate;
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/land',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "Url" => $url,
                            "OP" => $original_ploat,
                            "GstStateCode" => $gstStateCode,
                            "Levels" => $levels,
                            "X_Coordinate" => $xCoordinate,
                            "Y_Coordinate" => $yCoordinate,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));

                    $response = curl_exec($curl);
                    curl_close($curl);
                    $land_details = json_decode($response, true);
                    if (isset($land_details['status']) && $land_details['status'] == 200) {
                        return view('kyc.land_record', compact('land_details'));
                    }
                    return view('kyc.land_record', compact('land_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.land_record', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function land_record_api(Request $request)
    {
        return view('kyc.land_record_api');
    }
    public function gstin_details(Request $request)
    {
        $statusCode = null;
        $gstin_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.gstin_details', compact('gstin_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $gstin_id = $request->gstin_details_number;
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/gstin_details',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "gstin_id" => $gstin_id,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $gstin_details = json_decode($response, true);
                if (isset($gstin_details['status']) && $gstin_details['status'] == 200) {
                    return view('kyc.gstin_details', compact('gstin_details'));
                }
                return view('kyc.gstin_details', compact('gstin_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $gstin_id = $request->gstin_details_number;
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/gstin_details',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "gstin_id" => $gstin_id,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $gstin_details = json_decode($response, true);
                    if (isset($gstin_details['status']) && $gstin_details['status'] == 200) {
                        return view('kyc.gstin_details', compact('gstin_details'));
                    }
                    return view('kyc.gstin_details', compact('gstin_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.gstin_details', compact('statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function gstin_details_api()
    {
        return view('kyc.gstin_details_api');
    }
    public function ByPancard(Request $request)
    {
        $statusCode = null;
        $bypancard_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.bypancard', compact('bypancard_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $pan_number = $request->pan_number;
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/bypan',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "bypan_id" => $pan_number,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));

                $response = curl_exec($curl);
                curl_close($curl);
                $bypancard_details = json_decode($response, true);
                if (isset($bypancard_details['statusCode']) && $bypancard_details['statusCode'] == 200) {
                    return view('kyc.bypancard', compact('bypancard_details'));
                }
                return view('kyc.bypancard', compact('bypancard_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $pan_number = $request->pan_number;
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/bypan',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "bypan_id" => $pan_number,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $bypancard_details = json_decode($response, true);
                    if (isset($bypancard_details['statusCode']) && $bypancard_details['statusCode'] == 200) {
                        return view('kyc.bypancard', compact('bypancard_details'));
                    }
                    return view('kyc.bypancard', compact('bypancard_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.bypancard', compact('statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function bypancard_api()
    {
        return view('kyc.bypancard_api');
    }
    public function Pincode(Request $request)
    {
        $statusCode = null;
        $pincode_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.pincode', compact('pincode_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $frompincode = $request->from_pincode;
                $topincode = $request->to_pincode;
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/pincode',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "from_pin" => $frompincode,
                        "to_pin" => $topincode,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $pincode_details = json_decode($response, true);
                if (isset($pincode_details['statusCode']) && $pincode_details['statusCode'] == 200) {
                    return view('kyc.pincode', compact('pincode_details'));
                }
                return view('kyc.pincode', compact('pincode_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $frompincode = $request->from_pincode;
                    $topincode = $request->to_pincode;
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/pincode',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "from_pin" => $frompincode,
                            "to_pin" => $topincode,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $pincode_details = json_decode($response, true);
                    if (isset($pincode_details['statusCode']) && $pincode_details['statusCode'] == 200) {
                        return view('kyc.pincode', compact('pincode_details'));
                    }
                    return view('kyc.pincode', compact('pincode_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.pincode', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function pincode_api()
    {
        return view('kyc.pincode_api');
    }
    public function image_scanner(Request $request)
    {
        $statusCode = null;
        $image_scanner_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.image_scanner', compact('image_scanner_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/image_scanner',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['image_file']['tmp_name'], $_FILES['image_file']['type'], $_FILES['image_file']['name'])],
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $image_scanner_details = json_decode($response, true);
                if (isset($image_scanner_details['statusCode']) && $image_scanner_details['statusCode'] == 200) {
                    return view('kyc.image_scanner', compact('image_scanner_details'));
                }
                return view('kyc.image_scanner', compact('image_scanner_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/image_scanner',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['image_file']['tmp_name'], $_FILES['image_file']['type'], $_FILES['image_file']['name'])],
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $image_scanner_details = json_decode($response, true);
                    if (isset($image_scanner_details['statusCode']) && $image_scanner_details['statusCode'] == 200) {
                        return view('kyc.image_scanner', compact('image_scanner_details'));
                    }
                    return view('kyc.image_scanner', compact('image_scanner_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.image_scanner', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function image_scanner_api()
    {
        return view('kyc.image_scanner_api');
    }
    public function faceMatch(Request $request)
    {
        $statusCode = null;
        $facematch_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.face_matchv2', compact('facematch_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/facematch',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => [
                        'KnownFace' => new \CURLFILE($_FILES['known_face_image']['tmp_name'], $_FILES['known_face_image']['type'], $_FILES['known_face_image']['name']),
                        'Img' => new \CURLFILE($_FILES['image']['tmp_name'], $_FILES['image']['type'], $_FILES['image']['name'])
                    ],
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $facematch_details = json_decode($response, true);
                if (isset($facematch_details['statusCode']) && $facematch_details['statusCode'] == 200) {
                    return view('kyc.face_matchv2', compact('facematch_details'));
                }
                return view('kyc.face_matchv2', compact('facematch_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/facematch',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => [
                            'KnownFace' => new \CURLFILE($_FILES['known_face_image']['tmp_name'], $_FILES['known_face_image']['type'], $_FILES['known_face_image']['name']),
                            'Img' => new \CURLFILE($_FILES['image']['tmp_name'], $_FILES['image']['type'], $_FILES['image']['name'])
                        ],
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $facematch_details = json_decode($response, true);
                    if (isset($facematch_details['statusCode']) && $facematch_details['statusCode'] == 200) {
                        return view('kyc.face_matchv2', compact('facematch_details'));
                    }
                    return view('kyc.face_matchv2', compact('facematch_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.face_matchv2', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function detection_face(Request $request)
    {
        $statusCode = null;
        $facedetection_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.face_detection', compact('facedetection_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/detection_face',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => [
                        'file' => new \CURLFILE($_FILES['image_file']['tmp_name'], $_FILES['image_file']['type'], $_FILES['image_file']['name']),
                    ],
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $facematch_details = json_decode($response, true);
                if (isset($facematch_details['statusCode']) && $facematch_details['statusCode'] == 200) {
                    return view('kyc.face_detection', compact('facematch_details'));
                }
                return view('kyc.face_detection', compact('facematch_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/detection_face',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => [
                            'file' => new \CURLFILE($_FILES['image_file']['tmp_name'], $_FILES['image_file']['type'], $_FILES['image_file']['name']),
                        ],
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $facematch_details = json_decode($response, true);
                    if (isset($facematch_details['statusCode']) && $facematch_details['statusCode'] == 200) {
                        return view('kyc.face_detection', compact('facematch_details'));
                    }
                    return view('kyc.face_detection', compact('facematch_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.face_detection', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function detection_face_api()
    {
        return view('kyc.face_detection_api');
    }
    public function detection_emotion(Request $request)
    {
        $statusCode = null;
        $detection_emotion_details = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.detection_emotion', compact('detection_emotion_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/detection_emotion',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => [
                        'image_file' => new \CURLFILE($_FILES['image_file']['tmp_name'], $_FILES['image_file']['type'], $_FILES['image_file']['name']),
                    ],
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $detection_emotion_details = json_decode($response, true);
                if (isset($detection_emotion_details['statusCode']) && $detection_emotion_details['statusCode'] == 200) {
                    return view('kyc.detection_emotion', compact('detection_emotion_details'));
                }
                return view('kyc.detection_emotion', compact('detection_emotion_details'));
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/detection_emotion',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => [
                            'image_file' => new \CURLFILE($_FILES['image_file']['tmp_name'], $_FILES['image_file']['type'], $_FILES['image_file']['name']),
                        ],
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $detection_emotion_details = json_decode($response, true);
                    if (isset($detection_emotion_details['statusCode']) && $detection_emotion_details['statusCode'] == 200) {
                        return view('kyc.detection_emotion', compact('detection_emotion_details'));
                    }
                    return view('kyc.detection_emotion', compact('detection_emotion_details'));
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.detection_emotion', compact('hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function detection_emotion_api()
    {
        return view('kyc.detection_emotion_api');
    }
    public function bankstatementReader(Request $request)
    {
        $statusCode = null;
        $bank_statement_reader = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.bank_statement_reader', compact('hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank_statement')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, array(
                    CURLOPT_URL => "http://regtechapi.in/api/bankstatement_reader",
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "POST",
                    CURLOPT_POSTFIELDS => array(
                        "bankStmt" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                        "password" => $request->password,
                        "BankName" => $request->bank_name,
                        'accountType' => $request->account_type,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        "AccessToken: " . $accessToken,
                    ),
                ));
                $result = curl_exec($curl1);
                $bank_statement_reader = json_decode($result, true);
                if ($bank_statement_reader['statusCode'] == '200') {
                    $statmendata = $bank_statement_reader['response']['transactions'];
                    $pdf = PDF::loadView('kyc.statementpdf', compact('statmendata'))->setPaper('A4');
                    return $pdf->stream('invoice.pdf');
                } else {
                    return view('kyc.bank_statement_reader', compact('bank_statement_reader'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl1 = curl_init();
                    curl_setopt_array($curl1, array(
                        CURLOPT_URL => "http://regtechapi.in/api/bankstatement_reader",
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => "",
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => "POST",
                        CURLOPT_POSTFIELDS => array(
                            "bankStmt" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                            "password" => $request->password,
                            "BankName" => $request->bank_name,
                            'accountType' => $request->account_type,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            "AccessToken: " . $accessToken,
                        ),
                    ));
                    $result = curl_exec($curl1);
                    $bank_statement_reader = json_decode($result, true);
                    if ($bank_statement_reader['statusCode'] == '200') {
                        $statmendata = $bank_statement_reader['response']['transactions'];
                        $pdf = PDF::loadView('kyc.statementpdf', compact('statmendata'))->setPaper('A4');
                        return $pdf->stream('invoice.pdf');
                    } else {
                        return view('kyc.bank_statement_reader', compact('bank_statement_reader'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.bank_statement_reader', compact('hit_limits_exceeded'));
                }
            }
        }
    }
    public function bankAnalyser(Request $request)
    {

        $statusCode = null;
        $bank_statement_analyser = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.bank_statement_analyser', compact('hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
            ];
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'bank_anlyser')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, array(
                    CURLOPT_URL => 'http://regtechapi.in/api/bank_analyser_new',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => array(
                        "bankStemt" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                        "password" => $request->password,
                        "bankName" => $request->bank_name,
                        'accountType' => $request->account_type,
                    ),
                    CURLOPT_HTTPHEADER => array(
                        'AccessToken:' . $accessToken,
                    ),
                ));
                $response = curl_exec($curl);
                curl_close($curl);
                $bank_statement_analyser = json_decode($response, true);
                if (isset($bank_statement_analyser['statusCode']) && $bank_statement_analyser['statusCode'] == 200) {
                    $statmendata = $bank_statement_analyser['response'];
                    $statusCode = $bank_statement_analyser['statusCode'];
                    $atm_withdrawl = $bank_statement_analyser['response']['atm_withdrawls'];
                    $averageMonthlyBalance = $bank_statement_analyser['response']['averageMonthlyBalance'];
                    $averageQuarterlyBalance = $bank_statement_analyser['response']['averageQuarterlyBalance'];
                    $expenses = $bank_statement_analyser['response']['expenses'];
                    $high_value_transactions = $bank_statement_analyser['response']['high_value_transactions'];
                    $incomes = $bank_statement_analyser['response']['incomes'];
                    $minimum_balances = $bank_statement_analyser['response']['minimum_balances'];
                    $money_received_transactions = $bank_statement_analyser['response']['money_received_transactions'];
                    $customPaper = [0, 0, 967.0, 967.8];
                    $pdf = PDF::loadView('kyc.analyserpdf', compact('atm_withdrawl', 'averageMonthlyBalance', 'averageQuarterlyBalance', 'expenses', 'high_value_transactions', 'incomes', 'minimum_balances', 'money_received_transactions'))->setPaper($customPaper, 'A4');
                    return $pdf->stream('invoice.pdf');

                } else {
                    return view('kyc.bank_statement_analyser', compact('bank_statement_analyser'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $curl = curl_init();
                    curl_setopt_array($curl, array(
                        CURLOPT_URL => 'http://regtechapi.in/api/bank_analyser_new',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => array(
                            "bankStemt" => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name']),
                            "password" => $request->password,
                            "bankName" => $request->bank_name,
                            'accountType' => $request->account_type,
                        ),
                        CURLOPT_HTTPHEADER => array(
                            'AccessToken:' . $accessToken,
                        ),
                    ));
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $bank_statement_analyser = json_decode($response, true);
                    if (isset($bank_statement_analyser['statusCode']) && $bank_statement_analyser['statusCode'] == 200) {
                        $statmendata = $bank_statement_analyser['response'];
                        $statusCode = $bank_statement_analyser['statusCode'];
                        $atm_withdrawl = $bank_statement_analyser['response']['atm_withdrawls'];
                        $averageMonthlyBalance = $bank_statement_analyser['response']['averageMonthlyBalance'];
                        $averageQuarterlyBalance = $bank_statement_analyser['response']['averageQuarterlyBalance'];
                        $expenses = $bank_statement_analyser['response']['expenses'];
                        $high_value_transactions = $bank_statement_analyser['response']['high_value_transactions'];
                        $incomes = $bank_statement_analyser['response']['incomes'];
                        $minimum_balances = $bank_statement_analyser['response']['minimum_balances'];
                        $money_received_transactions = $bank_statement_analyser['response']['money_received_transactions'];
                        $customPaper = [0, 0, 967.0, 967.8];
                        $pdf = PDF::loadView('kyc.analyserpdf', compact('atm_withdrawl', 'averageMonthlyBalance', 'averageQuarterlyBalance', 'expenses', 'high_value_transactions', 'incomes', 'minimum_balances', 'money_received_transactions'))->setPaper($customPaper, 'A4');
                        return $pdf->stream('invoice.pdf');

                    } else {
                        return view('kyc.bank_statement_analyser', compact('bank_statement_analyser'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.bank_statement_analyser', compact('hit_limits_exceeded'));
                }
            }
        }
    }
    public function bank_analyser_api(Request $request)
    {

        return view('kyc.bank_statement_analyser_api');
    }
    public function extract_aadharcard(Request $request)
    {
        $statusCode = null;
        $aadharcard_extract = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.aadharcard_extract', compact('aadharcard_extract', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                $accessToken = Auth::user()->access_token;
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'aadharextracttext')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/extract_aadharcard_text',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $aadharcard_extract = json_decode($result, true);
                if (isset($aadharcard_extract['status_code']) && $aadharcard_extract['status_code'] == 200) {
                    return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                } elseif (isset($aadharcard_extract['status_code']) && $aadharcard_extract['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an aadhar card image.";
                    return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                } elseif (isset($aadharcard_extract['status_code']) && $aadharcard_extract['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                } else {
                    $astatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/extract_aadharcard_text',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $aadharcard_extract = json_decode($result, true);
                    if (isset($aadharcard_extract['status_code']) && $aadharcard_extract['status_code'] == 200) {
                        return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                    } elseif (isset($aadharcard_extract['status_code']) && $aadharcard_extract['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an aadhar card image.";
                        return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                    } elseif (isset($aadharcard_extract['status_code']) && $aadharcard_extract['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                    } else {
                        $astatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.aadharcard_extract', compact('aadharcard_extract'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.aadharcard_extract', compact('aadharcardocr', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function extract_drivinglicense(Request $request)
    {
        $statusCode = null;
        $lincense_extract = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        if ($request->isMethod('get')) {
            return view('kyc.lincense_extract', compact('lincense_extract', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'license')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/extract_driving_text',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                ]);
                $result = curl_exec($curl);
                $lincense_extract = json_decode($result, true);

                if (isset($lincense_extract['status_code']) && $lincense_extract['status_code'] == 200) {

                    return view('kyc.lincense_extract', compact('lincense_extract'));
                } elseif (isset($lincense_extract['status_code']) && $lincense_extract['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an driving license image.";
                    return view('kyc.lincense_extract', compact('lincense_extract', 'errorMessage'));
                } elseif (isset($lincense_extract['status_code']) && $lincense_extract['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.lincense_extract', compact('lincense_extract', 'errorMessage'));
                } else {
                    $listatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.lincense_extract', compact('lincense_extract', 'listatusCode', 'errorMessage'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/extract_driving_text',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ['AccessToken:' . $accessToken],
                    ]);
                    $result = curl_exec($curl);
                    $lincense_extract = json_decode($result, true);
                    if (isset($lincense_extract['status_code']) && $lincense_extract['status_code'] == 200) {

                        return view('kyc.lincense_extract', compact('lincense_extract'));
                    } elseif (isset($lincense_extract['status_code']) && $lincense_extract['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an driving license image.";
                        return view('kyc.lincense_extract', compact('lincense_extract', 'errorMessage'));
                    } elseif (isset($lincense_extract['status_code']) && $lincense_extract['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.lincense_extract', compact('lincense_extract', 'errorMessage'));
                    } else {
                        $listatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.lincense_extract', compact('lincense_extract', 'listatusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.lincense_extract', compact('lincensedocr', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function extract_pancard(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $extract_pancard_text = null;
        if ($request->isMethod('get')) {
            return view('kyc.pancard_extract', compact('extract_pancard_text', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'pancardextracttext')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/extract_pancard_text',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                ]);
                $response = curl_exec($curl);
                curl_close($curl);
                $extract_pancard_text = json_decode($response, true);
                if (isset($extract_pancard_text['status_code']) && $extract_pancard_text['status_code'] == 200) {
                    return view('kyc.pancard_extract', compact('extract_pancard_text'));
                } elseif (isset($extract_pancard_text['status_code']) && $extract_pancard_text['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an  pancard image.";
                    return view('kyc.pancard_extract', compact('extract_pancard_text', 'errorMessage'));
                } elseif (isset($extract_pancard_text['status_code']) && $extract_pancard_text['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.pancard_extract', compact('extract_pancard_text', 'errorMessage'));
                } else {
                    $vostatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.pancard_extract', compact('extract_pancard_text'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/extract_pancard_text',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                    ]);
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $extract_pancard_text = json_decode($response, true);
                    if (isset($extract_pancard_text['status_code']) && $extract_pancard_text['status_code'] == 200) {
                        return view('kyc.pancard_extract', compact('extract_pancard_text'));
                    } elseif (isset($extract_pancard_text['status_code']) && $extract_pancard_text['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an  pancard image.";
                        return view('kyc.pancard_extract', compact('extract_pancard_text', 'errorMessage'));
                    } elseif (isset($extract_pancard_text['status_code']) && $extract_pancard_text['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.pancard_extract', compact('extract_pancard_text', 'errorMessage'));
                    } else {
                        $vostatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.pancard_extract', compact('extract_pancard_text'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.pancard_extract', compact('extract_pancard_text', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function extract_voterId(Request $request)
    {
        $statusCode = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $extract_voterid = null;
        if ($request->isMethod('get')) {
            return view('kyc.extract_voterid', compact('extract_voterid', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'voterextracttext')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/extract_voterId_text',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                    CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                ]);
                $response = curl_exec($curl);
                curl_close($curl);
                $extract_voterid = json_decode($response, true);
                if (isset($extract_voterid['status_code']) && $extract_voterid['status_code'] == 200) {
                    return view('kyc.extract_voterid', compact('extract_voterid'));
                } elseif (isset($extract_voterid['status_code']) && $extract_voterid['status_code'] == 102) {
                    $errorMessage = "Invalid file type, must be an  voter id image.";
                    return view('kyc.extract_voterid', compact('extract_voterid'));
                } elseif (isset($extract_voterid['status_code']) && $extract_voterid['status_code'] == 404) {
                    $errorMessage = "No file found.";
                    return view('kyc.extract_voterid', compact('extract_voterid'));
                } else {
                    $vostatusCode = 500;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.extract_voterid', compact('extract_voterid'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/extract_voterId_text',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['file']['tmp_name'], $_FILES['file']['type'], $_FILES['file']['name'])],
                        CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                    ]);
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $extract_voterid = json_decode($response, true);
                    if (isset($extract_voterid['status_code']) && $extract_voterid['status_code'] == 200) {
                        return view('kyc.extract_voterid', compact('extract_voterid'));
                    } elseif (isset($extract_voterid['status_code']) && $extract_voterid['status_code'] == 102) {
                        $errorMessage = "Invalid file type, must be an  voter id image.";
                        return view('kyc.extract_voterid', compact('extract_voterid'));
                    } elseif (isset($extract_voterid['status_code']) && $extract_voterid['status_code'] == 404) {
                        $errorMessage = "No file found.";
                        return view('kyc.extract_voterid', compact('extract_voterid'));
                    } else {
                        $vostatusCode = 500;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.extract_voterid', compact('extract_voterid'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.voterId_ocr', compact('voterid', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
    }
    public function predictPPL(Request $request)
    {
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $predictppl_details = null;
        if ($request->isMethod('get')) {
            return view('kyc.predictppl', compact('predictppl_details', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('post')) {
            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'predictppl')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => 'http://regtechapi.in/api/predictppl',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['csv_file']['tmp_name'], $_FILES['csv_file']['type'], $_FILES['csv_file']['name'])],
                    CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                ]);
                $response = curl_exec($curl);
                curl_close($curl);
                $predictppl_details = json_decode($response, true);
                if (isset($predictppl_details['statusCode']) && $predictppl_details['statusCode'] == 200) {
                    return view('kyc.predictppl', compact('predictppl_details'));
                } elseif (isset($predictppl_details['statusCode']) && $predictppl_details['statusCode'] == 102) {
                    return view('kyc.predictppl', compact('predictppl_details'));
                } elseif (isset($predictppl_details['statusCode']) && $predictppl_details['statusCode'] == 500) {
                    return view('kyc.predictppl', compact('predictppl_details'));
                } else {
                    $statusCode = 404;
                    $errorMessage = 'Internal Server Error.';
                    return view('kyc.predictppl', compact('predictppl_details'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count = $user->scheme_hit_count + 1;
                    $user->save();
                    $accessToken = Auth::user()->access_token;
                    $curl = curl_init();
                    curl_setopt_array($curl, [
                        CURLOPT_URL => 'http://regtechapi.in/api/predictppl',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => ['file' => new \CURLFILE($_FILES['csv_file']['tmp_name'], $_FILES['csv_file']['type'], $_FILES['csv_file']['name'])],
                        CURLOPT_HTTPHEADER => ["AccessToken:$accessToken"],
                    ]);
                    $response = curl_exec($curl);
                    curl_close($curl);
                    $predictppl_details = json_decode($response, true);

                    if (isset($predictppl_details['statusCode']) && $predictppl_details['statusCode'] == 200) {
                        return view('kyc.predictppl', compact('predictppl_details'));
                    } elseif (isset($predictppl_details['statusCode']) && $predictppl_details['statusCode'] == 102) {
                        return view('kyc.predictppl', compact('predictppl_details'));
                    } elseif (isset($predictppl_details['statusCode']) && $predictppl_details['statusCode'] == 500) {
                        return view('kyc.predictppl', compact('predictppl_details'));
                    } else {
                        $statusCode = 404;
                        $errorMessage = 'Internal Server Error.';
                        return view('kyc.predictppl', compact('predictppl_details'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.predictppl', compact('predictppl_details', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }

    }
    public function predictPPL_api()
    {
        return view('kyc.predictppl_api');
    }

    public function demoform(Request $request)
    {
        $statusCode = null;
        $rc_validation = null;
        $checkWeight = null;
        $hit_limits_exceeded = 0;
        if ($request->isMethod('get')) {
            return view('kyc.Demo', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('post')) {
            $client = new Client();

            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken
            ];

            $body = [
                'rc_number' => $request->rc
            ];

            if (Auth::user()->scheme_type != 'demo') {
                if (Auth::user()->role_id == 1) {
                    $apimaster = ApiMaster::where('api_slug', 'rc')->first();
                    $api_id = $apimaster->id;
                }

                try {
                    $res = $client->post('http://regtechapi.in/api/rc_validation', ['headers' => $headers, 'json' => $body]);
                    $rc_validation = json_decode($res->getBody(), true);
                    if (isset($rc_validation['rc_validation']['data']['vehicle_gross_weight'])) {
                        $grossWeight = $rc_validation['rc_validation']['data']['vehicle_gross_weight'];
                        if ($grossWeight == null) {
                            $grossWeight = 0;
                        }
                        $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();

                        if (isset($rc_validation['status_code'])) {
                            $statusCode = $rc_validation['status_code'];
                        }
                    }

                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    return view('kyc.Demo', compact('statusCode', 'errorMessage'));
                }

            } else {
                // return 'ok';
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                // dd($scheme_type);

                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    try {
                        $res = $client->post('http://regtechapi.in/api/rc_validation', ['headers' => $headers, 'json' => $body]);
                        $rc_validation = json_decode($res->getBody(), true);
                        dd($rc_validation);
                        // dd($rc_validation['rc_validation']['data']['vehicle_gross_weight']);
                        if (isset($rc_validation['rc_validation']['data']['vehicle_gross_weight'])) {
                            $grossWeight = $rc_validation['rc_validation']['data']['vehicle_gross_weight'];
                            if ($grossWeight == null) {
                                $grossWeight = 0;
                            }
                            $checkWeight = Rcfull::where('min_weight', '<=', $grossWeight)->Where('max_weight', '>=', $grossWeight)->first();
                        }
                        if (isset($rc_validation['status_code']) && $rc_validation['status_code'] != 500) {
                            $user = User::where('id', Auth::user()->id)->first();
                            $user->scheme_hit_count = $user->scheme_hit_count + 1;
                            $user->save();
                        }
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        return view('kyc.Demo', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.Demo', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
                }
            }


        }
        return view('kyc.Demo', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
    }


    public function demopanform(Request $request){
        $statusCode = null;
        $rc_validation = null;
        $checkWeight = null;
        $hit_limits_exceeded = 0;
        if ($request->isMethod('get')) {
            return view('kyc.PanDemo', compact('rc_validation', 'checkWeight', 'statusCode', 'hit_limits_exceeded'));
        }
        if ($request->isMethod('post')){
            dd($request->all());
        }
    }

     public function ckycSearchAdvance(Request $request)
    {
        $statusCode = null;
        $searchkyc = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $mobile = $request->mobile;
        if ($request->isMethod('GET')) {
            return view('kyc.ckycsearch_advance', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
            ];
            $pano = $request->pan_number;
            // $mobile = $request->mobile;
            $client_ref_num = rand(10000, 99999);
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'ckycdownload')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, [
                    CURLOPT_URL => 'http://regtechapi.in/api/ckyc_searchadvance',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => [
                        'pano' => $pano,
                        'client_ref_num' => $client_ref_num,
                        'mobile' => '9090909090',
                        'identifier_type' => 'PAN'
                    ],
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);

                // $get_data1 = curl_exec($curl1);
                $result = curl_exec($curl1);
                $searchkyc = json_decode($result, true);
                if (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 200 && $searchkyc['response']['status'] == "VALID") {
                    $statusCode = 200;
                    $pdf = Pdf::loadView('kyc.ckyc_advance_pdf', [
                                         'searchkyc' => $searchkyc
                                        ]);
                    return $pdf->download('ckyc_advance_pdf.pdf');
                    return view('kyc.ckycsearch_advance', compact('statusCode', 'searchkyc'));
                } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 102) {
                    $statusCode = 102;
                    return view('kyc.ckycsearch_advance', compact('statusCode'));
                } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 103) {
                    $statusCode = 103;
                    return view('kyc.ckycsearch_advance', compact('statusCode'));
                } else {
                    $statusCode = 500;
                    return view('kyc.ckycsearch_advance', compact('statusCode'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $curl1 = curl_init();
                    curl_setopt_array($curl1, [
                        CURLOPT_URL => 'http://regtechapi.in/api/ckyc_searchadvance',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => [
                            'pano' => $pano,
                            'client_ref_num' => $client_ref_num,
                            'mobile' => $mobile,
                            'identifier_type' => 'PAN'
                        ],
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    // $get_data1 = curl_exec($curl1);
                    $result = curl_exec($curl1);
                    $searchkyc = json_decode($result, true);

                    if (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 200 && $searchkyc['response']['status'] == "VALID") {
                                        $pdf = Pdf::loadView('kyc.ckyc_advance_pdf', [
                                         'searchkyc' => $searchkyc
                                        ]);
                                    return $pdf->download('ckyc_advance_pdf.pdf');
                        $statusCode = 200;
                        return view('kyc.ckycsearch_advance', compact('statusCode', 'searchkyc', 'hit_limits_exceeded', 'low_wallet_balance'));
                    } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 102) {
                        $statusCode = 102;
                        return view('kyc.ckycsearch_advance', compact('statusCode'));
                    } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 103) {
                        $statusCode = 103;
                        return view('kyc.ckycsearch_advance', compact('statusCode'));
                    } else {
                        $statusCode = 500;
                        return view('kyc.ckycsearch_advance', compact('statusCode'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.ckycsearch_advance', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        if($searchkyc['response']['status'] == 'VALID' ){
                $pdf = Pdf::loadView('kyc.ckyc_advance_pdf', [
                'searchkyc' => $searchkyc
            ]);
           return $pdf->download('ckyc_advance_pdf.pdf');
        }

        return view('kyc.ckycsearch_advance', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
    

    public function enquieryform(Request $request)
    {
        // Assuming you have aadhaar_validation data in DB/session/API call
       return view('enquiery.html');
    }

   

    public function downloadPdf($client_id)
    {
        // Assuming you have aadhaar_validation data in DB/session/API call
        $aadhaar_validation = $client_id;

        if(!$aadhaar_validation || $aadhaar_validation['status'] != 200){
            return redirect()->back()->with('error', 'No Aadhaar details found!');
        }

        $pdf = Pdf::loadView('aadhaar_pdf', compact('aadhaar_validation'));
        return $pdf->download(' -'.$client_id.'.pdf');
    }

    public function ckycSearchAdvance_production(Request $request)
    {
        $statusCode = null;
        $searchkyc = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;
        $mobile = $request->mobile;
        if ($request->isMethod('GET')) {
            return view('kyc.ckycproduction', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }
        if ($request->isMethod('POST')) {

            $accessToken = Auth::user()->access_token;
            $headers = [
                'AccessToken' => $accessToken,
            ];
            $pano = $request->pan_number;
            // $mobile = $request->mobile;
            $client_ref_num = rand(10000, 99999);
            if (Auth::user()->scheme_type != 'demo') {
                // return 'demo';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'ckycdownload')->first();
                    if ($apiamster) {
                        $api_id = $apiamster->id;
                    }
                }
                $accessToken = Auth::user()->access_token;
                $curl1 = curl_init();
                curl_setopt_array($curl1, [
                    CURLOPT_URL => 'http://regtechapi.in/api/ckyc_sendotp',
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => '',
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 0,
                    CURLOPT_FOLLOWLOCATION => true,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_POSTFIELDS => [
                        'pano' => $pano,
                        'client_ref_num' => $client_ref_num,
                        'mobile' => '9090909090',
                        'identifier_type' => 'PAN'
                    ],
                    CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                ]);

                // $get_data1 = curl_exec($curl1);
                $result = curl_exec($curl1);
                $searchkyc = json_decode($result, true);
                if (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 200 && $searchkyc['response']['status'] == "VALID") {
                    $statusCode = 200;
                    $pdf = Pdf::loadView('kyc.ckyc_advance_pdf', [
                                         'searchkyc' => $searchkyc
                                        ]);
                    return $pdf->download('ckyc_advance_pdf.pdf');
                    return view('kyc.ckycproduction', compact('statusCode', 'searchkyc'));
                } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 102) {
                    $statusCode = 102;
                    return view('kyc.ckycproduction', compact('statusCode'));
                } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 103) {
                    $statusCode = 103;
                    return view('kyc.ckycproduction', compact('statusCode'));
                } else {
                    $statusCode = 500;
                    return view('kyc.ckycproduction', compact('statusCode'));
                }
            } else {
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {
                    $accessToken = Auth::user()->access_token;
                    $curl1 = curl_init();
                    curl_setopt_array($curl1, [
                        CURLOPT_URL => 'http://regtechapi.in/api/ckyc_sendotp',
                        CURLOPT_RETURNTRANSFER => true,
                        CURLOPT_ENCODING => '',
                        CURLOPT_MAXREDIRS => 10,
                        CURLOPT_TIMEOUT => 0,
                        CURLOPT_FOLLOWLOCATION => true,
                        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                        CURLOPT_CUSTOMREQUEST => 'POST',
                        CURLOPT_POSTFIELDS => [
                            'pano' => $pano,
                            'client_ref_num' => $client_ref_num,
                            'mobile' => $mobile,
                            'identifier_type' => 'PAN'
                        ],
                        CURLOPT_HTTPHEADER => ['AccessToken: ' . $accessToken],
                    ]);
                    // $get_data1 = curl_exec($curl1);
                    $result = curl_exec($curl1);
                    $searchkyc = json_decode($result, true);

                    if (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 200 && $searchkyc['response']['status'] == "VALID") {
                                        $pdf = Pdf::loadView('kyc.ckyc_advance_pdf', [
                                         'searchkyc' => $searchkyc
                                        ]);
                                    return $pdf->download('ckyc_advance_pdf.pdf');
                        $statusCode = 200;
                        return view('kyc.ckycproduction', compact('statusCode', 'searchkyc', 'hit_limits_exceeded', 'low_wallet_balance'));
                    } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 102) {
                        $statusCode = 102;
                        return view('kyc.ckycproduction', compact('statusCode'));
                    } elseif (isset($searchkyc['statusCode']) && $searchkyc['statusCode'] == 103) {
                        $statusCode = 103;
                        return view('kyc.ckycproduction', compact('statusCode'));
                    } else {
                        $statusCode = 500;
                        return view('kyc.ckycproduction', compact('statusCode'));
                    }
                } else {
                    $hit_limits_exceeded = 1;

                    return view('kyc.ckycproduction', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        if($searchkyc['response']['status'] == 'VALID' ){
                $pdf = Pdf::loadView('kyc.ckyc_advance_pdf', [
                'searchkyc' => $searchkyc
            ]);
           return $pdf->download('ckyc_advance_pdf.pdf');
        }

        return view('kyc.ckycproduction', compact('searchkyc', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }

    public function sendOtp(Request $request)
{
    $accessToken = Auth::user()->access_token;
    $pano = $request->pan_number;
    $mobile = $request->mobile;
    $client_ref_num = rand(10000, 99999);

    $curl = curl_init();
    curl_setopt_array($curl, [
        CURLOPT_URL => 'http://regtechapi.in/api/ckyc_sendotp',
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => [
            'pano' => $pano,
            'client_ref_num' => $client_ref_num,
            'mobile' => $mobile,
            'identifier_type' => 'PAN'
        ],
        CURLOPT_HTTPHEADER => [
            'AccessToken: ' . $accessToken,
        ]
    ]);

    $response = curl_exec($curl);
    curl_close($curl);

    $result = json_decode($response, true);

    return response()->json([
        'result_code' => $result['result_code'] ?? 500,
        'error' => $result['error'] ?? 'Failed',
        'ckyc_response_request_id' => $result['ckyc_response_request_id'] ?? null,
        'request_id' => $result['request_id'] ?? null
    ]);
}

public function verifyOtp(Request $request)
{
    $accessToken = Auth::user()->access_token;

    $curl = curl_init();
    curl_setopt_array($curl, [
        CURLOPT_URL => 'http://regtechapi.in/api/ckyc_verifycOtp_prod',
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => [
            'otp' => $request->otp,
            'ckyc_response_request_id' => $request->ckyc_response_request_id,
            'request_id' => $request->request_id
        ],
        CURLOPT_HTTPHEADER => [
            'AccessToken: ' . $accessToken
        ]
    ]);

    $response = curl_exec($curl);
    curl_close($curl);

    $result = json_decode($response, true);
    // return $request->otp;
    // return $result;
    if ($result['statusCode'] == 200) {
        $pdf = \PDF::loadView('kyc.ckycprodpdf', [
            'searchkyc' => $result
        ]);
        return $pdf->download('ckycprodpdf.pdf');
    } else {
        return response()->json(['error' => 'OTP verification failed'], 422);
    }
}


public function udyam_advanced_ui(Request $request)
{
    $statusCode = null;
    $udyamData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.udyam_info', compact(
            'udyamData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {

// if (true) {

//     $udyamData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "message" => "Udyam Found",
//         "result" => [
//             "udyam_reg_no" => $request->udyam_reg_no,
//             "date_of_reg"  => "01/01/2020",
//             "gender"       => "Male",
//             "dob"          => "01/01/1985",
//             "udyam_category" => "Micro",
//             "district_industries_center" => "Mumbai",
//             "profile" => [
//                 "enterprise_name" => "ABC ENTERPRISES",
//                 "enterprise_type" => "Manufacturing"
//             ],
//             "official_address" => [
//                 "state" => "Maharashtra",
//                 "district" => "Mumbai",
//                 "pincode" => "400001"
//             ]
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.udyam_info', compact(
//         'udyamData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }

        $request->validate([
            'udyam_reg_no' => [
                'required',
                'regex:/^(UDYAM-[A-Z]{2}-\d{2}-\d{7})$/'
            ]
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'udyam_reg_no' => $request->udyam_reg_no
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'udyambasic')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/udyam_authentication',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $udyamData = json_decode($res->getBody(), true);
                $statusCode = $udyamData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Udyam verification failed. Please enter a valid Udyam number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.udyam_info', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/udyam_authentication',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $udyamData = json_decode($res->getBody(), true);
                    $statusCode = $udyamData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Udyam verification failed. Please enter a valid Udyam number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.udyam_info', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.udyam_info', compact(
                    'udyamData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.udyam_info', compact(
            'udyamData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}

 public function mobilenamelookup(Request $request)
{
    $statusCode = null;
    $mobilenum = null;
    $api_id = null;
    $errorMessage = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    /* =====================
       GET REQUEST (UI)
    ====================== */
    if ($request->isMethod('GET')) {
        return view('kyc.mobilename_info', compact(
            'mobilenum',
            'statusCode',
            'errorMessage',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    /* =====================
       POST REQUEST
    ====================== */
    if ($request->isMethod('POST')) {

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile' => $request->mobile
        ];

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'mobilename')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {
                $res = $client->post(
                    'http://regtechapi.in/api/mobile-name-lookup',
                    ['headers' => $headers, 'json' => $body]
                );

                $mobilenum = json_decode($res->getBody(), true);
                $statusCode = $mobilenum['statusCode'] ?? 200;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct mobile number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.mobilename_info', compact(
                    'mobilenum',
                    'statusCode',
                    'errorMessage',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }

        } else {

            $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
            $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {
                    $res = $client->post(
                        'http://regtech.in/api/mobile-name-lookup',
                        ['headers' => $headers, 'json' => $body]
                    );

                    $mobilenum = json_decode($res->getBody(), true);
                    $statusCode = $mobilenum['statusCode'] ?? 200;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct mobile number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }
                }

            } else {
                $hit_limits_exceeded = 1;
            }
        }
    }

    return view('kyc.mobilename_info', compact(
        'mobilenum',
        'statusCode',
        'errorMessage',
        'hit_limits_exceeded',
        'low_wallet_balance'
    ));
}


public function email_otp(Request $request)
{
    $statusCode = null;
    $message = null;
    $errorMessage = null;
    $showOtp = false;
    $email = null;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.email_otp', compact(
            'statusCode',
            'message',
            'errorMessage',
            'showOtp',
            'email'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {

        $request->validate([
            'email' => 'required|email'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        try {

           
            $res = $client->post(
                'https://collectkart.docboyz.in/api/send-email-otp',
                [
                    'headers' => $headers,
                    'json'    => [
                        'email' => $request->email
                    ]
                ]
            );

            $apiResponse = json_decode($res->getBody(), true);
            $statusCode  = $apiResponse['statusCode'] ?? $res->getStatusCode();
            $message     = $apiResponse['message'] ?? 'OTP sent successfully';
            $showOtp     = true;
            $email       = $request->email;

        } catch (BadResponseException $e) {

            $statusCode = $e->getResponse()->getStatusCode();

            // ---------- SAME ERROR HANDLING AS GSTIN ----------
            if ($statusCode == 500) {
                $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
            } elseif ($statusCode == 422) {
                $errorMessage = 'Email verification failed. Please enter a valid email.';
            } else {
                $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
            }

            return view('kyc.email_otp', compact(
                'statusCode',
                'errorMessage',
                'showOtp',
                'email'
            ));
        }

        return view('kyc.email_otp', compact(
            'statusCode',
            'message',
            'showOtp',
            'email'
        ));
    }
}


public function verify_email_otp(Request $request)
{
    $statusCode = null;
    $message = null;
    $errorMessage = null;
    $showOtp = true;
    $email = $request->email;

    // ---------- POST ----------
    if ($request->isMethod('POST')) {

        $request->validate([
            'email' => 'required|email',
            'otp'   => 'required|digits:6'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        try {

            $res = $client->post(
                'https://collectkart.docboyz.in/api/verify-email-otp',
                [
                    'headers' => $headers,
                    'json'    => [
                        'email' => $request->email,
                        'otp'   => $request->otp
                    ]
                ]
            );

            $apiResponse = json_decode($res->getBody(), true);
            $statusCode  = $apiResponse['statusCode'] ?? $res->getStatusCode();
            $message     = $apiResponse['message'] ?? 'Email verified successfully';
            $showOtp     = false;

        } catch (BadResponseException $e) {

            $statusCode = $e->getResponse()->getStatusCode();

         
            if ($statusCode == 400) {
                $errorMessage = 'Invalid OTP. Please enter the correct OTP.';
            } elseif ($statusCode == 404) {
                $errorMessage = 'OTP not found. Please resend OTP.';
            } elseif ($statusCode == 500) {
                $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
            } else {
                $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
            }

            return view('kyc.email_otp', compact(
                'statusCode',
                'errorMessage',
                'showOtp',
                'email'
            ));
        }

        return view('kyc.email_otp', compact(
            'statusCode',
            'message',
            'showOtp',
            'email'
        ));
    }
}


   
public function mobile_validation(Request $request)
    {

        $statusCode = null;
        $email = null;
        $hit_limits_exceeded = 0;
        $low_wallet_balance = 0;

        if ($request->isMethod('GET')) {
            return view('kyc.mobile_info', compact('mobile', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
        }

        if ($request->isMethod('POST')) {
            $client = new Client();
            $accessToken = Auth::user()->access_token;

            $headers = [
                'AccessToken' => $accessToken,
            ];
            $body = [
                'mobile' => $request->mobile_no
            ];
            if (Auth::user()->scheme_type != 'demo') {
                // return 't11';
                if (Auth::user()->role_id == 1) {
                    $apiamster = ApiMaster::where('api_slug', 'mobile')->first();
                    if ($apiamster)
                        $api_id = $apiamster->id;
                }
                try {
                    $res = $client->post('http://regtechapi.in/api/mobile-validation', ['headers' => $headers, 'json' => $body]);

                    $mobile= json_decode($res->getBody(), true);
                    // return $pancard;
                    if (isset($mobile[0]['mobile']['code'])) {
                        $statusCode = $mobile[0]['mobile']['code'];
                    }
                } catch (BadResponseException $e) {
                    $statusCode = $e->getResponse()->getStatusCode();
                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                    } else if ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct Mobile Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                    }
                    return view('kyc.mobile_info', compact('statusCode', 'errorMessage'));
                }
            } else {
                //    return 't2';
                $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
                $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;
                if ($hit_count_remaining > 0) {

                    try {
                        $res = $client->post('http://regtechapi.in/api/mobile-validation', ['headers' => $headers, 'json' => $body]);
                        $mobile = json_decode($res->getBody(), true);
                        $user = User::where('id', Auth::user()->id)->first();
                        $user->scheme_hit_count = $user->scheme_hit_count + 1;
                        $user->save();
                    } catch (BadResponseException $e) {
                        $statusCode = $e->getResponse()->getStatusCode();
                        if ($statusCode == 500) {
                            $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in. for more details';
                        } else if ($statusCode == 422) {
                            $errorMessage = 'Verification Failed. Please enter correct Mobile Number.';
                        } else {
                            $errorMessage = 'Error. Please contact techsupport@docboyz.in. for more details';
                        }
                        return view('kyc.mobile_info', compact('statusCode', 'errorMessage'));
                    }
                } else {
                    $hit_limits_exceeded = 1;
                    return view('kyc.mobile_info', compact('mobile', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
                }
            }
        }
        return view('kyc.mobile_info', compact('mobile', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance'));
    }
   public function pandetails(Request $request)
{
    $statusCode = null;
    $panData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.pandetailss', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {
// ================= MOCK MODE (FOR TESTING UI) =================
// if (true) {

//     $panData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "request_id" => "mock-request-id",
//         "client_ref_num" => "test",
//         "result" => [
//             "pan" => strtoupper($request->pan),
//             "pan_type" => "Individual",
//             "fullname" => "ASHUTOSH SUBHASH DEORE",
//             "first_name" => "ASHUTOSH",
//             "middle_name" => "SUBHASH",
//             "last_name" => "DEORE",
//             "gender" => "male",
//             "aadhaar_number" => "XXXXXXXX7659",
//             "aadhaar_linked" => true,
//             "dob" => "04/01/2004",
//             "address" => [
//                 "building_name" => "",
//                 "locality" => "",
//                 "street_name" => "",
//                 "pincode" => "",
//                 "city" => "",
//                 "state" => "",
//                 "country" => "India"
//             ],
//             "mobile" => "",
//             "email" => ""
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.pandetailss', compact(
//         'panData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }


        $request->validate([
            'pan' => 'required|string|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => strtoupper($request->pan)
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'panno')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/pan-validation',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $panData = json_decode($res->getBody(), true);
                $statusCode = $panData['statusCode']
                    ?? $panData['http_response_code']
                    ?? $res->getStatusCode();
        
            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'PAN verification failed. Please enter a valid PAN.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.pandetailss', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/pan-validation',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $panData = json_decode($res->getBody(), true);
                    $statusCode = $panData['statusCode']
                        ?? $panData['http_response_code']
                        ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'PAN verification failed. Please enter a valid PAN.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.pandetailss', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.pandetailss', compact(
                    'panData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.pandetailss', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}


public function pandetailsplus(Request $request)
{
    $statusCode = null;
    $panData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.pandetailsplus', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {
    // ================= MOCK TEST (TEMPORARY) =================
// if (true) {

//     $panData = [
//         "statusCode" => 200,
//         "message" => "PAN details fetched successfully",
//         "data" => [
//             "pan" => $request->pan,
//             "pan_type" => "Individual",
//             "fullname" => "TEST USER",
//             "first_name" => "TEST",
//             "middle_name" => null,
//             "last_name" => "USER",
//             "gender" => "male",
//             "dob" => "01-01-1990",
//             "pan_status" => "Active",
//             "pan_allotment_date" => "15-08-2010",
//             "aadhaar_linked" => true,
//             "address" => [
//                 "building_name" => "",
//                 "street_name" => "",
//                 "locality" => "",
//                 "city" => "Mumbai",
//                 "state" => "MH",
//                 "pincode" => "400001",
//                 "country" => "India"
//             ],
//             "mobile" => null,
//             "email" => null,
//             "is_salaried" => true,
//             "is_director" => false,
//             "is_sole_proprietor" => false
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.pandetailsplus', compact(
//         'panData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }
// ================= END MOCK =================

        $request->validate([
            'pan' => 'required|string|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => strtoupper($request->pan)
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'pannoplus')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/pan-validation-plus',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $panData = json_decode($res->getBody(), true);
                $statusCode = $panData['statusCode']
                    ?? $panData['http_response_code']
                    ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'PAN verification failed. Please enter a valid PAN.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.pandetailsplus', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/pan-validation-plus',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $panData = json_decode($res->getBody(), true);
                    $statusCode = $panData['statusCode']
                        ?? $panData['http_response_code']
                        ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'PAN verification failed. Please enter a valid PAN.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.pandetailsplus', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.pandetailsplus', compact(
                    'panData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.pandetailsplus', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}

public function pandetailsv4(Request $request)
{
    $statusCode = null;
    $pan = null;
    $errorMessage = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.pandetailsv4', compact(
            'pan',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance',
            'errorMessage'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {
//  if (true) {

//     $pan = [
//         'result_code' => 101,
//         'data' => [
//             'pan' => $request->pan,
//             'fullname' => 'TEST USER',
//             'first_name' => 'TEST',
//             'middle_name' => '',
//             'last_name' => 'USER',
//             'dob' => '01-01-1990',
//             'pan_status' => 'Active',
//             'pan_type' => 'Individual',
//             'father_name' => 'TEST FATHER',
//             'gender' => 'male',
//             'aadhaar_linked' => true,
//             'address' => [
//                 'building_name' => '',
//                 'street_name' => '',
//                 'locality' => '',
//                 'city' => 'Mumbai',
//                 'state' => 'MH',
//                 'pincode' => '400001',
//                 'country' => 'India',
//             ],
//             'mobile' => '',
//             'email' => '',
//         ]
//     ];

//     $statusCode = 101;

//     return view('kyc.pandetailsv4', compact(
//         'pan',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => $request->pan
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/pandetails-v4',
                    ['headers' => $headers, 'json' => $body]
                );

                $pan = json_decode($res->getBody(), true);

                /**
                 * SUCCESS
                 * result_code = 101
                 */
                if (isset($pan['result_code']) && $pan['result_code'] == 101) {
                    $statusCode = 101;

                    return view('kyc.pandetailsv4', compact(
                        'pan',
                        'statusCode',
                        'hit_limits_exceeded',
                        'low_wallet_balance'
                    ));
                }

                /**
                 * IN-PROGRESS
                 * statusCode = 104
                 */
                if (isset($pan['statusCode']) && $pan['statusCode'] == 104) {
                    $statusCode = 104;
                    $errorMessage = $pan['message'] ?? 'PAN verification is in progress. Please retry after some time.';

                    return view('kyc.pandetailsv4', compact(
                        'statusCode',
                        'errorMessage',
                        'pan',
                        'hit_limits_exceeded',
                        'low_wallet_balance'
                    ));
                }

                /**
                 * FAILED
                 * statusCode = 102
                 */
                if (isset($pan['statusCode']) && $pan['statusCode'] == 102) {
                    $statusCode = 102;
                    $errorMessage = $pan['message'] ?? 'PAN validation failed';

                    return view('kyc.pandetailsv4', compact(
                        'statusCode',
                        'errorMessage',
                        'pan',
                        'hit_limits_exceeded',
                        'low_wallet_balance'
                    ));
                }

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in for more details.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in for more details.';
                }

                return view('kyc.pandetailsv4', compact(
                    'statusCode',
                    'errorMessage',
                    'pan',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }

        }
        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where('id', Auth::user()->scheme_type_id)->first();
            $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/pandetails-v4',
                        ['headers' => $headers, 'json' => $body]
                    );

                    $pan = json_decode($res->getBody(), true);

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                    return view('kyc.pandetailsv4', compact(
                        'pan',
                        'statusCode',
                        'hit_limits_exceeded',
                        'low_wallet_balance'
                    ));

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in for more details.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in for more details.';
                    }

                    return view('kyc.pandetailsv4', compact(
                        'statusCode',
                        'errorMessage',
                        'pan',
                        'hit_limits_exceeded',
                        'low_wallet_balance'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.pandetailsv4', compact(
                    'pan',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }
    }
}


public function dl_validation3(Request $request)
{
    $statusCode = null;
    $dl = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.dl_validation', compact(
            'dl',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {

        // ---------- VALIDATION ----------
        $request->validate([
            'dlno'         => 'required|string',
            'mobileNumber' => 'required|string|min:10|max:10',
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'Content-Type' => 'application/json',
            'AccessToken'  => $accessToken,
        ];

        $body = [
            'dlno'         => $request->dlno,
            'mobileNumber' => $request->mobileNumber,
            'recordId' => '69642721', 
            'deviceId' => 'p38e0od88a649e62', 
            'token' => 'sJ8K3a(n0tMUu1Ls',
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'dl')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                //  Call YOUR backend API (not vendor directly)
                $res = $client->post(
                    'http://regtechapi.in/api/dl-validation',
                    [
                        'headers' => $headers,
                        'json'    => $body,
                        'timeout' => 30
                    ]
                );

                $dl = json_decode($res->getBody(), true);
                $statusCode = $dl['statusCode']
                    ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'DL verification failed. Please enter correct Driving Licence Number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.dl_validation', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/dl-validation',
                        [
                            'headers' => $headers,
                            'json'    => $body,
                            'timeout' => 20
                        ]
                    );

                    $dl = json_decode($res->getBody(), true);
                    $statusCode = $dl['statusCode']
                        ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'DL verification failed. Please enter correct Driving Licence Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.dl_validation', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.dl_validation', compact(
                    'dl',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.dl_validation', compact(
            'dl',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}

public function rc_validate(Request $request)
{
    $statusCode = null;
    $rcData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;

  
    if ($request->isMethod('GET')) {
        return view('kyc.rc_validate', compact(
            'rcData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {
    //      $rcData = [
    //     'statusCode' => 200,
    //     'message' => 'TEST OK',
    //     'result' => [
    //         'registration' => [
    //             'number' => $request->rcNumber
    //         ]
    //     ]
    // ];

    // return view('kyc.rc_validate', [
    //     'rcData' => $rcData,
    //     'statusCode' => 200,
    //     'hit_limits_exceeded' => 0,
    //     'low_wallet_balance' => 0
    // ]);
        $request->validate([
            'rcNumber' => 'required'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'rcNumber' => $request->rcNumber
        ];

      
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'rcno')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/rc-validation',
                    ['headers' => $headers, 'json' => $body]
                );

                $rcData = json_decode($res->getBody(), true);
                $statusCode = $rcData['statusCode'] ?? 200;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct RC Number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.rc_validate', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/rc-validation',
                        ['headers' => $headers, 'json' => $body]
                    );

                    $rcData = json_decode($res->getBody(), true);
                    $statusCode = $rcData['statusCode'] ?? 200;

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct RC Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.rc_validate', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.rc_validate', compact(
                    'rcData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

    
        return view('kyc.rc_validate', compact(
            'rcData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}

public function pan_compliance(Request $request)
{
    $statusCode = null;
    $panData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;

  
    if ($request->isMethod('GET')) {
        return view('kyc.pan_compliance', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {

        $request->validate([
            'pan' => 'required'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => $request->pan
        ];

      
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'pancomp')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/pan-compliance',
                    ['headers' => $headers, 'json' => $body]
                );

                $panData = json_decode($res->getBody(), true);
                $statusCode = $panData['statusCode'] ?? 200;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct RC Number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.pan_compliance', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/pan-compliance',
                        ['headers' => $headers, 'json' => $body]
                    );

                    $panData = json_decode($res->getBody(), true);
                    $statusCode = $panData['statusCode'] ?? 200;

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct RC Number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.pan_compliance', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.pan_compliance', compact(
                    'panData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

    
        return view('kyc.pan_compliance', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function epfo(Request $request)
{
    $statusCode = null;
    $epfoData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;

    if ($request->isMethod('GET')) {
        return view('kyc.epfo', compact(
            'epfoData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    if ($request->isMethod('POST')) {

        $request->validate([
            'employee_name' => 'required|string',
            'employer_name' => 'required|string',
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken
        ];

        $body = [
            'employee_name' => $request->employee_name,
            'employer_name' => $request->employer_name
        ];

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'epfoev')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {
                $res = $client->post(
                    'http://regtechapi.in/api/epfo-ev',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                /* =======================
                 *  FIX START
                 * ======================= */
                $responseData = json_decode($res->getBody(), true);

                // unwrap API response
                $statusCode = $responseData['statusCode'] ?? 200;
                $epfoData   = $responseData['data'] ?? null;
                /* =======================
                 *  FIX END
                 * ======================= */

                if (!isset($epfoData['result_code']) && isset($epfoData['result'])) {
                    $epfoData['result_code'] = 101;
                }

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification failed. Please enter correct details.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.epfo', compact(
                    'statusCode',
                    'errorMessage',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }

        } else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {
                    $res = $client->post(
                        'http://regtechapi.in/api/epfo-ev',
                        [
                            'headers' => $headers,
                            'json'    => $body
                        ]
                    );

                    /*  SAME FIX FOR DEMO */
                    $responseData = json_decode($res->getBody(), true);
                    $statusCode   = $responseData['statusCode'] ?? 200;
                    $epfoData     = $responseData['data'] ?? null;

                    if (!isset($epfoData['result_code']) && isset($epfoData['result'])) {
                        $epfoData['result_code'] = 101;
                    }

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification failed. Please enter correct details.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.epfo', compact(
                        'statusCode',
                        'errorMessage',
                        'hit_limits_exceeded',
                        'low_wallet_balance'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;
            }
        }

        return view('kyc.epfo', compact(
            'epfoData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}



public function upi_basic(Request $request)
{
    $statusCode = null;
    $upiData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;


    if ($request->isMethod('GET')) {
        return view('kyc.upi_basic', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }


    if ($request->isMethod('POST')) {

        $request->validate([
            'vpa' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
            
        ];

        $body = [
            'vpa' => $request->vpa
        ];

       
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'upibasic')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/upi-basic',
                    [
                        'headers'         => $headers,
                        'json'            => $body,
                           
                    ]
                );

                $upiData = json_decode($res->getBody(), true);

                $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct VPA.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.upi_basic', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
     
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/upi-basic',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 15,
                            'connect_timeout' => 5
                        ]
                    );

                    $upiData = json_decode($res->getBody(), true);
                    $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct VPA.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.upi_basic', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.upi_basic', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

       
        return view('kyc.upi_basic', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
// if (true) { // =
//     $upiData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "message" => "VPA Found",
//         "result" => [
//             "vpa_details" => [
//                 "vpa" => $request->vpa,
//                 "account_holder_name" => $request->name
//             ],
//             "name_match" => true,
//             "name_match_score" => 92
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.upi_basic_name', compact(
//         'upiData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }
public function gstin_authentication(Request $request)
{ 
    $statusCode = null;
    $upiData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;


    if ($request->isMethod('GET')) {
        return view('kyc.upi_basic_name', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

 
    if ($request->isMethod('POST')) {

        $request->validate([
            'vpa'  => 'required|string',
            'name' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'vpa'  => $request->vpa,
            'name' => $request->name
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'upinamematch')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/upi-basic-name',
                    [
                        'headers'         => $headers,
                        'json'            => $body,
                        'timeout'         => 15,
                        'connect_timeout' => 5
                    ]
                );

                $upiData = json_decode($res->getBody(), true);
                $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct VPA or Name.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.upi_basic_name', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/upi-basic-name',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 15,
                            'connect_timeout' => 5
                        ]
                    );

                    $upiData = json_decode($res->getBody(), true);
                    $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct VPA or Name.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.upi_basic_name', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.upi_basic_name', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

     
        return view('kyc.upi_basic_name', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function upi_basic_name(Request $request)
{ 
    $statusCode = null;
    $upiData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;


    if ($request->isMethod('GET')) {
        return view('kyc.upi_basic_name', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

 
    if ($request->isMethod('POST')) {

        $request->validate([
            'vpa'  => 'required|string',
            'name' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'vpa'  => $request->vpa,
            'name' => $request->name
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'upinamematch')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/upi-basic-name',
                    [
                        'headers'         => $headers,
                        'json'            => $body,
                        'timeout'         => 15,
                        'connect_timeout' => 5
                    ]
                );

                $upiData = json_decode($res->getBody(), true);
                $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct VPA or Name.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.upi_basic_name', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/upi-basic-name',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 15,
                            'connect_timeout' => 5
                        ]
                    );

                    $upiData = json_decode($res->getBody(), true);
                    $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct VPA or Name.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.upi_basic_name', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.upi_basic_name', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

     
        return view('kyc.upi_basic_name', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function gstin_authentication_ui(Request $request)
{
    $statusCode = null;
    $gstData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.gstin_authentication', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {

//         if (true) { 

//     $gstData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "message" => "GSTIN Found",
//         "result" => [
//             "taxpayerDetails" => [
//                 "gstin" => $request->gstin,
//                 "lgnm" => "RELIANCE INDUSTRIES LIMITED",
//                 "tradeNam" => "RELIANCE INDUSTRIES LIMITED",
//                 "sts" => "Active",
//                 "ctb" => "Public Limited Company",
//                 "dty" => "Regular",
//                 "rgdt" => "01/07/2017",
//                 "pradr" => [
//                     "adr" => "Navi Mumbai, Maharashtra, 400701"
//                 ]
//             ]
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.gstin_authentication', compact(
//         'gstData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));

// }


        $request->validate([
            'gstin' => 'required|string|size:15'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'gstin' => $request->gstin
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'gstinauth')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
//    return 'test';
            try {

// $apiRequest = HttpRequest::create(
//     '/api/gstin-authentication',
//     'POST',
//     ['gstin' => $request->gstin]
// );

// // attach AccessToken header
// $apiRequest->headers->set(
//     'AccessToken',
//     Auth::user()->access_token
// );

// // call API
// $api = app(\App\Http\Controllers\ApiController2::class);
// $response = $api->gstin_authentication($apiRequest);

// // convert JsonResponse  array
// $gstData = $response->getData(true);
// $statusCode = $gstData['http_response_code'] ?? 200;

                $res = $client->post(
                    
                    'http://regtechapi.in/api/gstin-authentication',
                    [
                        'headers'         => $headers,
                        'json'            => $body,
                        
                    ]
                );


                $gstData = json_decode($res->getBody(), true);
                $statusCode = $gstData['http_response_code'] ?? $res->getStatusCode();
                // return $gstData;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'GSTIN verification failed. Please enter a valid GSTIN.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.gstin_authentication', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/gstin-authentication',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $gstData = json_decode($res->getBody(), true);
                    $statusCode = $gstData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'GSTIN verification failed. Please enter a valid GSTIN.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.gstin_authentication', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.gstin_authentication', compact(
                    'gstData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

      
        return view('kyc.gstin_authentication', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function gstin_advanced_ui(Request $request)
{
    $statusCode = null;
    $gstData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.gstin_advanced', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {

        $request->validate([
            'gstin' => 'required|string|size:15'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'gstin' => $request->gstin
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'gstinadvanced')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {
//                    if (true) { 

//     $gstData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "message" => "GSTIN Found",
//         "result" => [
//             "taxpayerDetails" => [
//                 "gstin" => $request->gstin,
//                 "lgnm" => "RELIANCE INDUSTRIES LIMITED",
//                 "tradeNam" => "RELIANCE INDUSTRIES LIMITED",
//                 "sts" => "Active",
//                 "ctb" => "Public Limited Company",
//                 "dty" => "Regular",
//                 "rgdt" => "01/07/2017",
//                 "einvoiceStatus" => "Yes",
//                 "adhrVFlag" => "Yes",
//                 "ekycVFlag" => "Not Applicable",
//                 "pradr" => [
//                     "adr" => "Navi Mumbai, Maharashtra, 400701"
//                 ]
//             ]
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.gstin_advanced', compact(
//         'gstData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }

                $res = $client->post(
                    'http://regtechapi.in/api/gstin-advanced',
                    [
                        'headers'         => $headers,
                        'json'            => $body
                    ]
                );

                $gstData = json_decode($res->getBody(), true);
                $statusCode = $gstData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'GSTIN advanced verification failed. Please enter a valid GSTIN.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.gstin_advanced', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }
        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/gstin-advanced',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $gstData = json_decode($res->getBody(), true);
                    $statusCode = $gstData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'GSTIN advanced verification failed. Please enter a valid GSTIN.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.gstin_advanced', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.gstin_advanced', compact(
                    'gstData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.gstin_advanced', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function pan_aadhaar_link_ui(Request $request)
{
    $statusCode = null;
    $linkData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.pan_aadhaar_link', compact(
            'linkData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {
//         if (true) {

//     $linkData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "request_id" => "mock-request-id",
//         "client_ref_num" => "test",
//         "result" => [
//             "message" => "Is already linked to given Aadhaar",
//             "code" => "LINK-001"
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.pan_aadhaar_link', compact(
//         'linkData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }
        $request->validate([
            'pan'     => 'required|string|size:10',
            'aadhaar' => 'required|string|size:12'
        ]);
       
        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan'     => strtoupper($request->pan),
            'aadhaar' => $request->aadhaar
        ];

        // ---------- NON-DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'panaadhaar')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/pan-aadhaar-link',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $linkData = json_decode($res->getBody(), true);
                $statusCode = $linkData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'PANAadhaar verification failed. Please enter valid details.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.pan_aadhaar_link', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

       
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/pan-aadhaar-link',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $linkData = json_decode($res->getBody(), true);
                    $statusCode = $linkData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'PANAadhaar verification failed. Please enter valid details.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.pan_aadhaar_link', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.pan_aadhaar_link', compact(
                    'linkData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.pan_aadhaar_link', compact(
            'linkData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}

public function pan_to_fname_ui(Request $request)
{
    $statusCode = null;
    $fnameData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

 
    if ($request->isMethod('GET')) {
        return view('kyc.pan_to_fname', compact(
            'fnameData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

 
    if ($request->isMethod('POST')) {
  
// if (true) {

//     $fnameData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "request_id" => "mock-request-id",
//         "client_ref_num" => "test",
//         "result" => [
//             "pan" => strtoupper($request->pan),
//             "father_name" => "SUBHASH SHRIRAM DEORE"
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.pan_to_fname', compact(
//         'fnameData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }


        $request->validate([
            'pan' => 'required|string|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => strtoupper($request->pan)
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'pantofname')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'https://regtechapi.in/api/pan-fname',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $fnameData = json_decode($res->getBody(), true);
                $statusCode = $fnameData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'PAN to Father Name verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.pan_to_fname', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

    
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'https://regtechapi.in/api/pan-fname',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $fnameData = json_decode($res->getBody(), true);
                    $statusCode = $fnameData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'PAN to Father Name verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.pan_to_fname', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.pan_to_fname', compact(
                    'fnameData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.pan_to_fname', compact(
            'fnameData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function arm_verification(Request $request)
{
    $statusCode = null;
    $armData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    

    if ($request->isMethod('GET')) {
        return view('kyc.arm_verification', compact(
            'armData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }


    if ($request->isMethod('POST')) {
// if (true) {

//     $armData = [
//         "message" => "Success",
//         "http_response_code" => 200,
//         "transaction_id" => "test-txn-123",
//         "client_ref_id" => "test_ref",
//         "result" => [
//             "status" => "OK",
//             "risk_score" => 452,
//             "risk_band" => "medium",
//             "services" => [
//                 "pan_insights" => [
//                     "result" => [
//                         "fullname" => "ASHUTOSH SUBHASH DEORE",
//                         "dob" => "04/01/2004"
//                     ]
//                 ]
//             ],
//             "raw_feature_url" => "#"
//         ],
//         "raw_input" => [
//             "pan" => strtoupper($request->pan),
//             "name" => strtolower($request->name),
//             "email" => $request->email,
//             "mobile_no" => $request->mobile_no
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.arm_verification', compact(
//         'armData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }

        $request->validate([
            'pan'       => 'required|string|size:10',
            'name'      => 'required|string',
            'email'     => 'required|email',
            'mobile_no' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan'           => strtoupper($request->pan),
            'name'          => $request->name,
            'email'         => $request->email,
            'mobile_no'     => $request->mobile_no,
            'client_ref_id' => uniqid('arm_')
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'arm')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/arm-verification',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $armData = json_decode($res->getBody(), true);
                $statusCode = $armData['statusCode']
                    ?? $armData['http_response_code']
                    ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();
            
                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'ARM verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.arm_verification', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/arm-verification',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $armData = json_decode($res->getBody(), true);
                    $statusCode = $armData['statusCode']
                        ?? $armData['http_response_code']
                        ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'ARM verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.arm_verification', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.arm_verification', compact(
                    'armData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.arm_verification', compact(
            'armData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function pan_to_name(Request $request)
{
    $statusCode = null;
    $panData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $errorMessage = null;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.pan_to_name', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance',
            'errorMessage'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        // ---------- VALIDATION ----------
        $request->validate([
            'pan' => 'required|string|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => strtoupper($request->pan)
        ];
     
        // ---------- LIVE USERS ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'pantoname')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'https://regtechapi.in/api/pan-name',
                    [
                        'headers'         => $headers,
                        'json'            => $body,
                        
                    ]
                );

                $panData = json_decode($res->getBody(), true);
            // return  $panData ;
                $statusCode = $panData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'PAN to Name verification failed.';
                } elseif ($statusCode == 401) {
                    $errorMessage = 'Unauthorized request. Please check Access Token.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }
            }
        }

        // ---------- DEMO USERS ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'https://regtechapi.in/api/pa-name',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                           
                        ]
                    );

                    $panData = json_decode($res->getBody(), true);
                    $statusCode = $panData['http_response_code'] ?? $res->getStatusCode();

                    // update hit count
                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'PAN to Name verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }
                }

            } else {
                $hit_limits_exceeded = 1;
            }
        }

        return view('kyc.pan_to_name', compact(
            'panData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance',
            'errorMessage'
        ));
    }
}
public function upi_merchant(Request $request)
{
    $statusCode = null;
    $upiData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.upi_merchant', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
    if ($request->isMethod('POST')) {

        $request->validate([
            'vpa' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'vpa' => $request->vpa
        ];

        // ---------- NON DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'upibasic')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/upi-basic',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $upiData = json_decode($res->getBody(), true);
                $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'UPI validation failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.upi_merchant', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/upi-basic',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $upiData = json_decode($res->getBody(), true);
                    $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'UPI validation failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.upi_basic', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.upi_merchant', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.upi_merchant', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function address_verification_ui(Request $request)
{
    $statusCode = null;
    $addressData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ---------- GET ----------
    if ($request->isMethod('GET')) {
        return view('kyc.address_verification', compact(
            'addressData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ---------- POST ----------
//     if ($request->isMethod('POST')) {
//       if (true) {

//     $addressData = [
//         "code" => "200",
//         "model" => [
//             "address"  => "I-17, HAL 2nd Stage, Kodihalli, Bengaluru, Karnataka 560008, India",
//             "pincode"  => "560008",
//             "district" => "Bangalore Division",
//             "state"    => "Karnataka"
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.address_verification', compact(
//         'addressData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }

        $request->validate([
            'latitude'  => 'required|string',
            'longitude' => 'required|string',
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'uniqueId'  => $request->uniqueId ?? 'DIGITAP001',
            'latitude'  => $request->latitude,
            'longitude' => $request->longitude,
        ];

        // ---------- NON DEMO ----------
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'addressverification')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/address-verification',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $addressData = json_decode($res->getBody(), true);
                $statusCode = $addressData['code']
                    ?? $addressData['statusCode']
                    ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Address verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.address_verification', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ---------- DEMO ----------
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/address-verification',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $addressData = json_decode($res->getBody(), true);
                    $statusCode = $addressData['code']
                        ?? $addressData['statusCode']
                        ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Address verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.address_verification', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.address_verification', compact(
                    'addressData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.address_verification', compact(
            'addressData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
    public function upi_enhanced(Request $request)
{
    $statusCode = null;
    $upiData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.upi_enhanced', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }


    if ($request->isMethod('POST')) {

        $request->validate([
            'vpa' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'ref_' . time(),
            'vpa'            => $request->vpa
        ];

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'upienhanced')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/upi-enhanced',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $upiData = json_decode($res->getBody(), true);
                $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'UPI Enhanced verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.upi_enhanced', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/upi-enhanced',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $upiData = json_decode($res->getBody(), true);
                    $statusCode = $upiData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'UPI Enhanced verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.upi_enhanced', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.upi_enhanced', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.upi_enhanced', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function company_to_pan(Request $request)
{
    $statusCode = null;
    $companyData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.company_to_pan', compact(
            'companyData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {

        $request->validate([
            'company_name' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'company_name'         => $request->company_name,
            'output_count'         => $request->output_count ?? '10',
            'client_ref_num'       => $request->client_ref_num ?? 'ref_' . time(),
            'search_by_trade_name' => $request->search_by_trade_name ? true : false
        ];

      
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'companytopan')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/company-to-pan',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $companyData = json_decode($res->getBody(), true);
                $statusCode = $companyData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Company to PAN verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.company_to_pan', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/company-to-pan',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $companyData = json_decode($res->getBody(), true);
                    $statusCode = $companyData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Company to PAN verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.company_to_pan', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.company_to_pan', compact(
                    'companyData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.company_to_pan', compact(
            'companyData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function tds_quarterly(Request $request)
{
    $statusCode = null;
    $tdsData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.tds_quarterly', compact(
            'tdsData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    if ($request->isMethod('POST')) {

        $request->validate([
            'pan'            => 'required|string|size:10',
            'tan'            => 'required|string',
            'financial_year' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'test',
            'pan'            => strtoupper($request->pan),
            'tan'            => strtoupper($request->tan),
            'financial_year' => $request->financial_year
        ];

    
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'tdsquarterly')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/tds-quarterly',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $tdsData = json_decode($res->getBody(), true);
                $statusCode = $tdsData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'TDS Quarterly verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.tds_quarterly', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

       
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/tds-quarterly',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $tdsData = json_decode($res->getBody(), true);
                    $statusCode = $tdsData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'TDS Quarterly verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.tds_quarterly', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.tds_quarterly', compact(
                    'tdsData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.tds_quarterly', compact(
            'tdsData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function rc_validationthree(Request $request)
{
    $statusCode = null;
    $rcData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.rc_validationthree', compact(
            'rcData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {
// if (true) {

//    $cars24Data = [
//     'success' => true,
//     'detail' => [
//         'rcStatus' => 'ACTIVE',
//         'registeredPlace' => 'Mumbai RTO',
//         'registeredAt' => '2021-07-14',
//         'fitnessUpTo' => '2036-07-13',
//         'rc_owner_name' => 'TEST USER',
//         'rc_owner_sr' => 1,
//         'vehicleClassDesc' => 'LMV',
//         'vehicleCategory' => 'Car',
//         'brand' => [
//             'make_display' => 'MARUTI'
//         ],
//         'model' => [
//             'model_display' => 'SWIFT',
//             'bodyType' => 'Hatchback'
//         ],
//         'regn_year' => '2021',
//         'color' => 'White',
//         'fuelType' => 'Petrol',
//         'seatCap' => 5,
//         'isCommercial' => false,
//         'insuranceCompany' => 'ICICI Lombard',
//         'insurancePolicyNo' => 'POL123',
//         'insuranceUpTo' => '2026-01-01',
//         'hypothecation' => 'HDFC',
//         'financier' => 'HDFC Bank'
//     ]
// ];



//     $statusCode = 200;
// return view('kyc.rc_validationthree', compact(
//     'cars24Data',
//     'statusCode',
//     'hit_limits_exceeded',
//     'low_wallet_balance'
// ));

// }

        $request->validate([
            'rcNumber' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'rcNumber' => strtoupper(str_replace('-', '', $request->rcNumber))
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'rcthree')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/rc-validation-three',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $rcData = json_decode($res->getBody(), true);
                $statusCode = $rcData['statusCode'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'RC verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.rc_validationthree', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

       
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/rc-validation-three',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                           
                        ]
                    );

                    $rcData = json_decode($res->getBody(), true);
                    $statusCode = $rcData['statusCode'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'RC verification failed.';

                    return view('kyc.rc_validationthree', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.rc_validationthree', compact(
                    'rcData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.rc_validationthree', compact(
            'rcData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function employment_uan(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    if ($request->isMethod('GET')) {
        return view('kyc.employment_uan', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    if ($request->isMethod('POST')) {

        $request->validate([
            'employee_name' => 'required|string',
            'dob'           => 'required|date'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'employee_name' => $request->employee_name,
            'dob'           => $request->dob
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'employmentuan')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'https://regtechapi.in/api/employment-uan',
                    options: [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $uanData = json_decode($res->getBody(), true);
                $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Employment UAN verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.employment_uan', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

       
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'https://regtechapi.in/api/employment-uan',
                        [
                            'headers' => $headers,
                            'json'    => $body
                        ]
                    );

                    $uanData = json_decode($res->getBody(), true);
                    $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Employment UAN verification failed.';

                    return view('kyc.employment_uan', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.employment_uan', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.employment_uan', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function dl_validate(Request $request)
{
    $statusCode = null;
    $dlData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

  
    if ($request->isMethod('GET')) {
        return view('kyc.dl_validate', compact(
            'dlData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {

        $request->validate([
            'dl_number' => 'required|string',
            'dob'       => 'required|date'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'test',
            'dl_number'      => strtoupper($request->dl_number),
            'dob'            => $request->dob
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'dlvalidation')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/dl-validation-v3',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $dlData = json_decode($res->getBody(), true);
                $statusCode = $dlData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'DL verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.dl_validate', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/dl-validation-v3',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $dlData = json_decode($res->getBody(), true);
                    $statusCode = $dlData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'DL verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.dl_validate', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.dl_validate', compact(
                    'dlData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.dl_validate', compact(
            'dlData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function dl_validation(Request $request)
{
    $statusCode = null;
    $dlData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.dl_validation', compact(
            'dlData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'dl_number' => 'required|string',
            'dob'       => 'required|date'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'dl_number'      => $request->dl_number,
            'dob'            => $request->dob,
            'client_ref_num' => uniqid('dl_')
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'dlvalidationnew'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/dl-validation-v3',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $responseData['http_response_code']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                // SUCCESS DATA
                if (($responseData['result_code'] ?? null) == 101) {
                    $dlData = $responseData['result'] ?? null;
                }

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Driving License verification failed.';
                }

                return view('kyc.dl_validation', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/dl-validation-v3',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $responseData['http_response_code']
                        ?? $res->getStatusCode();

                    if (($responseData['result_code'] ?? null) == 101) {
                        $dlData = $responseData['result'] ?? null;
                    }

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Driving License verification failed.';
                    }

                    return view('kyc.dl_validation', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.dl_validation', compact(
                    'dlData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.dl_validation', compact(
            'dlData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}

public function employment_uan_v3(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.employment_uan_v3', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'uan' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'test',
            'uan'            => $request->uan
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'employmentuanvthree')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/employment-uan-v3',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $uanData = json_decode($res->getBody(), true);
                $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Employment UAN v3 verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.employment_uan_v3', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/employment-uan-v3',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $uanData = json_decode($res->getBody(), true);
                    $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Employment UAN v3 verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.employment_uan_v3', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.employment_uan_v3', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.employment_uan_v3', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function employment_uan_v4(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.employment_uan_v4', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'uan' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'test',
            'uan'            => $request->uan
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'employmentuanvfour')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/employment-uan-v4',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $uanData = json_decode($res->getBody(), true);
                $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Employment UAN v4 verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.employment_uan_v4', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/employment-uan-v4',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $uanData = json_decode($res->getBody(), true);
                    $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Employment UAN v4 verification failed.';

                    return view('kyc.employment_uan_v4', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.employment_uan_v4', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.employment_uan_v4', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function employment_uan_v5(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.employment_uan_v5', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'uan_list' => 'required|string'
        ]);

        // Convert comma-separated UANs to array
        $uanList = array_values(array_filter(array_map(
            'trim',
            explode(',', $request->uan_list)
        )));

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'test',
            'uan_list'       => $uanList
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'employmentuanvfive')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/employment-uan-v5',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $uanData = json_decode($res->getBody(), true);
                $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Employment UAN v5 verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.employment_uan_v5', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/employment-uan-v5',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $uanData = json_decode($res->getBody(), true);
                    $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Employment UAN v5 verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.employment_uan_v5', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.employment_uan_v5', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.employment_uan_v5', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function employment_uan_advanced_v2(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.employment_uan_advanced_v2', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'employee_name' => 'required|string',
            'dob'           => 'required|date'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => $request->client_ref_num ?? 'test',
            'employee_name'  => $request->employee_name,
            'dob'            => $request->dob
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'employmentuanadvancedv2'
                )->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/employment-uan-advanced-v2',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $uanData = json_decode($res->getBody(), true);
                $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Employment UAN Advanced verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view(
                    'kyc.employment_uan_advanced_v2',
                    compact('statusCode', 'errorMessage')
                );
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::find(
                Auth::user()->scheme_type_id
            );

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/employment-uan-advanced-v2',
                        [
                            'headers' => $headers,
                            'json'    => $body,
                            'timeout' => 20
                        ]
                    );

                    $uanData = json_decode($res->getBody(), true);
                    $statusCode = $uanData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();
                    $errorMessage = 'Employment UAN Advanced verification failed.';

                    return view(
                        'kyc.employment_uan_advanced_v2',
                        compact('statusCode', 'errorMessage')
                    );
                }

            } else {
                $hit_limits_exceeded = 1;
            }
        }

        return view('kyc.employment_uan_advanced_v2', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_prefill(Request $request)
{
    $statusCode = null;
    $mobilePrefillData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;


    if ($request->isMethod('GET')) {
        return view('kyc.mobile_prefill', compact(
            'mobilePrefillData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile_no' => 'required|digits:10'

        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile_no'      => $request->mobile_no,
            'client_ref_num' => uniqid('mp_'),
            'name_lookup'    => 1
        ];

      
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'mobileprefills')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-prefill',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);
                $statusCode   = $responseData['statusCode']
                    ?? $responseData['status_code']
                    ?? $res->getStatusCode();

               
                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $mobilePrefillData = $responseData[0]['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Mobile Prefill failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.mobile_prefill', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

     
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-prefill',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);
                    $statusCode   = $responseData['statusCode']
                        ?? $responseData['status_code']
                        ?? $res->getStatusCode();

                    $mobilePrefillData = $responseData[0]['data'] ?? null;

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Mobile Prefill failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.mobile_prefill', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.mobile_prefill', compact(
                    'mobilePrefillData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_prefill', compact(
            'mobilePrefillData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function employment_uan_advanced_v3(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.uan_advanced', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'uan' => 'required|digits:12'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'uan'            => $request->uan,
            'client_ref_num' => uniqid('uan_')
        ];

       
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'uanadvanced')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/employment-uan-advanced-v3',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }
                
                $uanData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'UAN verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.uan_advanced', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

       
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/employment-uan-advanced-v3',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $uanData = $responseData['data'] ?? null;

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'UAN verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.uan_advanced', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.uan_advanced', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.uan_advanced', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function whatsapp_number_check(Request $request)
{
    $statusCode = null;
    $whatsappData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;


    if ($request->isMethod('GET')) {
        return view('kyc.whatsapp_number_check', compact(
            'whatsappData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'client_ref_num' => uniqid('wnc_')
        ];

       
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'whatsapp_number_check'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/whatsapp-number-check',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $whatsappData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'WhatsApp number verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.whatsapp_number_check', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/whatsapp-number-check',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $whatsappData = $responseData['data'] ?? null;

                    $user = User::where(
                        'id',
                        Auth::user()->id
                    )->first();

                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'WhatsApp number verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.whatsapp_number_check', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.whatsapp_number_check', compact(
                    'whatsappData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.whatsapp_number_check', compact(
            'whatsappData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function whatsapp_advanced(Request $request)
{
    $statusCode = null;
    $whatsappData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.whatsapp_advanced', compact(
            'whatsappData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'client_ref_num' => uniqid('wa_')
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'whatsapp_advanced'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/whatsapp-advanced',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $whatsappData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage = 'WhatsApp verification failed.';
                }

                return view('kyc.whatsapp_advanced', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/whatsapp-advanced',
                        [
                            'headers' => $headers,
                            'json'    => $body
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $whatsappData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    return view('kyc.whatsapp_advanced', compact(
                        'statusCode'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;
            }
        }

        return view('kyc.whatsapp_advanced', compact(
            'whatsappData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function contact_to_gst(Request $request)
{
    $statusCode = null;
    $gstData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // GET
    if ($request->isMethod('GET')) {
        return view('kyc.contact_to_gst', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // POST
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'client_ref_num' => uniqid('ctg_')
        ];

        // NON-DEMO
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'contact_to_gst'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/contact-to-gst',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $gstData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'GST verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.contact_to_gst', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // DEMO
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/contact-to-gst',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $gstData = $responseData['data'] ?? null;

                    $user = User::where(
                        'id',
                        Auth::user()->id
                    )->first();

                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'GST verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.contact_to_gst', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.contact_to_gst', compact(
                    'gstData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.contact_to_gst', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function gst_to_contacts(Request $request)
{
    $statusCode = null;
    $gstData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // GET
    if ($request->isMethod('GET')) {
        return view('kyc.gst_to_contacts', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // POST
    if ($request->isMethod('POST')) {

        $request->validate([
            'gstin' => 'required|size:15'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'gstin'          => $request->gstin,
            'client_ref_num' => uniqid('gtc_')
        ];

        // NON-DEMO
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'gst_to_contacts'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/gst-to-contacts',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $gstData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'GST contact verification failed.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.gst_to_contacts', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // DEMO
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/gst-to-contacts',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $gstData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'GST contact verification failed.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.gst_to_contacts', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.gst_to_contacts', compact(
                    'gstData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.gst_to_contacts', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function ecom_generate_url(Request $request)
{
    $statusCode = null;
    $ecomData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.ecom_generate_url', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'client_ref_num'      => 'required',
            'txn_completed_cburl' => 'required|url',
            'return_url'          => 'required|url'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        
        $body = [
            'payload' => [
                'client_ref_num'      => $request->client_ref_num,
                'txn_completed_cburl' => $request->txn_completed_cburl,
                'return_url'          => $request->return_url,
                'website'             => $request->website ?? '1'
            ]
        ];

        
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'ecom_generate_url'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/ecom-generate-url',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $ecomData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to generate transaction URL.';
                }

                return view('kyc.ecom_generate_url', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

    
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/ecom-generate-url',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $ecomData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to generate transaction URL.';
                    }

                    return view('kyc.ecom_generate_url', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.ecom_generate_url', compact(
                    'ecomData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.ecom_generate_url', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function ecom_url_username(Request $request)
{
    $statusCode = null;
    $ecomData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.ecom_url_username', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'client_ref_num'      => 'required',
            'txn_completed_cburl' => 'required|url',
            'return_url'          => 'required|url',
            'username'            => 'required'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

       
        $body = [
            'payload' => [
                'client_ref_num'      => $request->client_ref_num,
                'txn_completed_cburl' => $request->txn_completed_cburl,
                'return_url'          => $request->return_url,
                'username'            => $request->username,
                'is_editable'         => $request->is_editable ?? 'true'
            ]
        ];

       
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'ecom_generate_url'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/ecom-url-username',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $ecomData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to generate transaction URL.';
                }

                return view('kyc.ecom_url_username', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/ecom-url-username',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $ecomData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to generate transaction URL.';
                    }

                    return view('kyc.ecom_url_username', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.ecom_url_username', compact(
                    'ecomData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.ecom_url_username', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function ecom_generate_url_username(Request $request)
{
    $statusCode = null;
    $ecomData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.ecom_generate_url_username', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'client_ref_num'      => 'required',
            'txn_completed_cburl' => 'required|url',
            'return_url'          => 'required|url',
            'username'            => 'required'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

       
        $body = [
            'payload' => [
                'client_ref_num'      => $request->client_ref_num,
                'txn_completed_cburl' => $request->txn_completed_cburl,
                'return_url'          => $request->return_url,
                'username'            => $request->username,
                'is_editable'         =>  'false'
            ]
        ];


        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'ecom_generate_url'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/ecom-generate-url-username',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $ecomData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to generate transaction URL.';
                }

                return view('kyc.ecom_generate_url_username', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/ecom-generate-url-username',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $ecomData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to generate transaction URL.';
                    }

                    return view('kyc.ecom_generate_url_username', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                
                $hit_limits_exceeded = 1;

                return view('kyc.ecom_generate_url_username', compact(
                    'ecomData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        
        return view('kyc.ecom_generate_url_username', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function tan_to_company(Request $request)
{
    $statusCode = null;
    $tanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // GET
    if ($request->isMethod('GET')) {
        return view('kyc.tan_to_company', compact(
            'tanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // POST
    if ($request->isMethod('POST')) {

        $request->validate([
            'tan' => 'required|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'tan'            => $request->tan,
            'client_ref_num' => uniqid('tan_')
        ];

        // NON-DEMO
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'tan_to_company'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/tan-to-company',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $tanData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'TAN verification failed.';
                }

                return view('kyc.tan_to_company', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // DEMO
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/tan-to-company',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $tanData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'TAN verification failed.';
                    }

                    return view('kyc.tan_to_company', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {
                $hit_limits_exceeded = 1;

                return view('kyc.tan_to_company', compact(
                    'tanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.tan_to_company', compact(
            'tanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function ecom_generate_url_order_duration(Request $request)
{
    $statusCode = null;
    $ecomData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.ecom_generate_url_order_duration', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'client_ref_num'      => 'required',
            'txn_completed_cburl' => 'required|url',
            'return_url'          => 'required|url',
            'order_duration'      => 'required'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'payload' => [
                'client_ref_num'      => $request->client_ref_num,
                'txn_completed_cburl' => $request->txn_completed_cburl,
                'return_url'          => $request->return_url,
                'order_duration'      => $request->order_duration
            ]
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'ecom_generate_url'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/ecom-generate-url-order-duration',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $ecomData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to generate transaction URL.';
                }

                return view('kyc.ecom_generate_url_order_duration', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/ecom-generate-url-order-duration',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $ecomData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to generate transaction URL.';
                    }

                    return view('kyc.ecom_generate_url_order_duration', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.ecom_generate_url_order_duration', compact(
                    'ecomData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }
     
        return view('kyc.ecom_generate_url_order_duration', compact(
            'ecomData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function ecom_websites_list(Request $request)
{
    $statusCode = null;
    $websiteData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.ecom_websites_list', compact(
            'websiteData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {
           if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'contact_to_gst'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
            try {

                $res = $client->get(
                    'http://regtechapi.in/api/ecom-websites-list',
                    [
                        'headers' => $headers,
                        'timeout' => 20
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $websiteData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to fetch website list.';
                }

                return view('kyc.ecom_websites_list', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->get(
                        'http://regtechapi.in/api/ecom-websites-list',
                        [
                            'headers'         => $headers,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $websiteData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to fetch website list.';
                    }

                    return view('kyc.ecom_websites_list', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.ecom_websites_list', compact(
                    'websiteData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.ecom_websites_list', compact(
            'websiteData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_upi_lookup(Request $request)
{
    $statusCode = null;
    $upiData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_upi_lookup', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => uniqid('upi_'),
            'mobile'         => $request->mobile
        ];

        
        
        if (Auth::user()->scheme_type != 'demo') {

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-upi-lookup',
                    [
                        'headers' => $headers,
                        'json'    => $body,
                        'timeout' => 20
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $upiData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to fetch mobile UPI details.';
                }

                return view('kyc.mobile_upi_lookup', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-upi-lookup',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $upiData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to fetch mobile UPI details.';
                    }

                    return view('kyc.mobile_upi_lookup', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_upi_lookup', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_upi_lookup', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_upi_name(Request $request)
{
    $statusCode = null;
    $upiData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

 
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_upi_name', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10',
            'name'   => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => uniqid('upi_'),
            'mobile'         => $request->mobile,
            'name'           => $request->name
        ];

        if (Auth::user()->scheme_type != 'demo') {

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-upi-name',
                    [
                        'headers' => $headers,
                        'json'    => $body,
                        
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $upiData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to fetch mobile UPI details.';
                }

                return view('kyc.mobile_upi_name', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

     
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-upi-name',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $upiData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to fetch mobile UPI details.';
                    }

                    return view('kyc.mobile_upi_name', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_upi_name', compact(
                    'upiData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_upi_name', compact(
            'upiData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function uan_basic_pan(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

  
    if ($request->isMethod('GET')) {
        return view('kyc.uan_basic_pan', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

   
    if ($request->isMethod('POST')) {

        $request->validate([
            'pan' => 'required|string|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => uniqid('uan_'),
            'pan'            => $request->pan
        ];

     
        if (Auth::user()->scheme_type != 'demo') {
          if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'uanbasicpan'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
            try {

                $res = $client->post(
                    'http://regtechapi.in/api/uan-basic-sync',
                    [
                        'headers' => $headers,
                        'json'    => $body,
                        'timeout' => 20
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $uanData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to fetch UAN details.';
                }

                return view('kyc.uan_basic_pan', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/uan-basic-sync',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $uanData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to fetch UAN details.';
                    }

                    return view('kyc.uan_basic_pan', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.uan_basic_pan', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.uan_basic_pan', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function uan_basic_pan_v4(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    if ($request->isMethod('GET')) {
        return view('kyc.uan_basic_pan_v4', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'pan' => 'required|string|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'client_ref_num' => uniqid('uan_'),
            'pan'            => $request->pan
        ];

       
        if (Auth::user()->scheme_type != 'demo') {
           if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'uanbasicvfour'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
            try {

                $res = $client->post(
                    'http://regtechapi.in/api/uan-basic-pan-v4',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $uanData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Failed to fetch UAN details.';
                }

                return view('kyc.uan_basic_pan_v4', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/uan-basic-pan-v4',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $uanData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Failed to fetch UAN details.';
                    }

                    return view('kyc.uan_basic_pan_v4', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.uan_basic_pan_v4', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.uan_basic_pan_v4', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function pan_to_din(Request $request)
{
    $statusCode = null;
    $dinData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

   
    if ($request->isMethod('GET')) {
        return view('kyc.pan_to_din', compact(
            'dinData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    if ($request->isMethod('POST')) {

        $request->validate([
            'pan' => 'required|size:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan'            => $request->pan,
            'client_ref_num' => uniqid('din_')
        ];

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'pantodinvone'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/pan-to-din',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $dinData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'PAN to DIN verification failed.';
                }

                return view('kyc.pan_to_din', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

      
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/pan-to-din',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $dinData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'PAN to DIN verification failed.';
                    }

                    return view('kyc.pan_to_din', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.pan_to_din', compact(
                    'dinData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.pan_to_din', compact(
            'dinData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_with_name_lookup(Request $request)
{
    $statusCode = null;
    $mobileData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

  
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_name_lookup', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

 
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10',
            'name'   => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'name'           => $request->name,
            'client_ref_num' => uniqid('mnl_')
        ];

    
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'mobilenamelookupvone'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-with-name-lookup',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $mobileData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Mobile name lookup failed.';
                }

                return view('kyc.mobile_name_lookup', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-with-name-lookup',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $mobileData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Mobile name lookup failed.';
                    }

                    return view('kyc.mobile_name_lookup', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_name_lookup', compact(
                    'mobileData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_name_lookup', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_number_lookup(Request $request)
{
   
    $statusCode = null;
    $mobileData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_number_lookup', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10',
            'name'   => 'required|string'
        ]);
         
        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'name'           => $request->name,
            'client_ref_num' => uniqid('mnl_')
        ];

     
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'mobilenumberlookup'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-number-lookup',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $mobileData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Mobile name lookup failed.';
                }

                return view('kyc.mobile_number_lookup', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-name-lookup-v1',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $mobileData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Mobile name lookup failed.';
                    }

                    return view('kyc.mobile_number_lookup', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_number_lookup', compact(
                    'mobileData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_number_lookup', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_porting_history(Request $request)
{
    // return 'test';
    $statusCode = null;
    $mobileData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_porting_history', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile_number' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile_number' => $request->mobile_number,
            'client_ref_num'=> uniqid('mph_')
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'mobileportinghistory'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-porting-history',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $mobileData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                $errorMessage = $statusCode == 500
                    ? 'Internal server error. Please contact techsupport@docboyz.in.'
                    : 'Mobile porting history lookup failed.';

                return view('kyc.mobile_porting_history', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-porting-history',
                        [
                            'headers' => $headers,
                            'json'    => $body
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $mobileData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    $errorMessage = 'Mobile porting history lookup failed.';

                    return view('kyc.mobile_porting_history', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_porting_history', compact(
                    'mobileData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_porting_history', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_customer_details(Request $request)
{
    $statusCode = null;
    $mobileData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_customer_details', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile_number' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile_number' => $request->mobile_number,
            'client_ref_num'=> uniqid('ml_'),
            'options'       => ['customer_details']
        ];

       
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'mobilecustomerdetails'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-customer-details',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $mobileData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'Mobile customer lookup failed.';
                }

                return view('kyc.mobile_customer_details', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-customer-details',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $mobileData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'Mobile customer lookup failed.';
                    }

                    return view('kyc.mobile_customer_details', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_customer_details', compact(
                    'mobileData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_customer_details', compact(
            'mobileData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function mobile_vintage_lookup(Request $request)
{
    $statusCode = null;
    $vintageData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.mobile_vintage_lookup', compact(
            'vintageData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'client_ref_num' => uniqid('mv_')
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'mobilevintage'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-vintage-lookup',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $vintageData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                $errorMessage = ($statusCode == 500)
                    ? 'Internal server error. Please contact techsupport@docboyz.in.'
                    : 'Mobile vintage lookup failed.';

                return view('kyc.mobile_vintage_lookup', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($remaining > 0) {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-vintage-lookup',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                $vintageData = $responseData['data'] ?? null;

                $user = User::find(Auth::user()->id);
                $user->scheme_hit_count += 1;
                $user->save();

            } else {
                $hit_limits_exceeded = 1;
            }
        }

        return view('kyc.mobile_vintage_lookup', compact(
            'vintageData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function uan_basic_mobile_name(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.uan_basic_mobile', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile'        => 'required|digits:10',
            'employee_name' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'employee_name'  => $request->employee_name,
            'client_ref_num' => uniqid('uan_')
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'uanbasicmobile'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/uan-mobile-name',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $uanData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                $errorMessage = ($statusCode == 500)
                    ? 'Internal server error. Please contact techsupport@docboyz.in.'
                    : 'UAN lookup failed.';

                return view('kyc.uan_basic_mobile', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($remaining > 0) {

                $res = $client->post(
                    'http://regtechapi.in/api/uan-mobile-name',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                $uanData = $responseData['data'] ?? null;

                $user = User::find(Auth::user()->id);
                $user->scheme_hit_count += 1;
                $user->save();

            } else {
                $hit_limits_exceeded = 1;
            }
        }

        return view('kyc.uan_basic_mobile', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function uan_basic(Request $request)
{
    $statusCode = null;
    $uanData = null;
    $api_id = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;

    // ================= GET =================
    if ($request->isMethod('GET')) {
        return view('kyc.uan_basic', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    // ================= POST =================
    if ($request->isMethod('POST')) {

        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile'         => $request->mobile,
            'client_ref_num' => uniqid('uan_')
        ];

        // ================= NON-DEMO =================
        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where(
                    'api_slug',
                    'uanbasic'
                )->first();

                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/uan-basic',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $responseData = json_decode($res->getBody(), true);

                $statusCode = $responseData['statusCode']
                    ?? $res->getStatusCode();

                if ($statusCode == 500) {
                    $low_wallet_balance = 1;
                }

                if ($statusCode == 103) {
                    $hit_limits_exceeded = 1;
                }

                $uanData = $responseData['data'] ?? null;

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage =
                        'Internal server error. Please contact techsupport@docboyz.in.';
                } else {
                    $errorMessage =
                        'UAN basic verification failed.';
                }

                return view('kyc.uan_basic', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }

        // ================= DEMO =================
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/uan-basic',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 20,
                            'connect_timeout' => 5
                        ]
                    );

                    $responseData = json_decode($res->getBody(), true);

                    $statusCode = $responseData['statusCode']
                        ?? $res->getStatusCode();

                    $uanData = $responseData['data'] ?? null;

                    $user = User::find(Auth::user()->id);
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage =
                            'Internal server error. Please contact techsupport@docboyz.in.';
                    } else {
                        $errorMessage =
                            'UAN basic verification failed.';
                    }

                    return view('kyc.uan_basic', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.uan_basic', compact(
                    'uanData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.uan_basic', compact(
            'uanData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function company_search_v1(Request $request)
{
    $statusCode = null;
    $companyData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;

    
    if ($request->isMethod('GET')) {
        return view('kyc.company_search_v1', compact(
            'companyData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    if ($request->isMethod('POST')) {

        $request->validate([
            'employer_name' => 'required|string'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'employer_name' => $request->employer_name
        ];

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'companysearchvone')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/company-search-v1',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $companyData = json_decode($res->getBody(), true);
                $statusCode  = $companyData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct company name.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.company_search_v1', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }

    
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/company-search-v1',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 15,
                            'connect_timeout' => 5
                        ]
                    );

                    $companyData = json_decode($res->getBody(), true);
                    $statusCode  = $companyData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct company name.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.company_search_v1', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.company_search_v1', compact(
                    'companyData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.company_search_v1', compact(
            'companyData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function gstin_pan_search(Request $request)
{
    $statusCode = null;
    $gstData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;

    /* ---------------- GET ---------------- */

    if ($request->isMethod('GET')) {
        return view('kyc.gstin_pan_search', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    /* ---------------- POST ---------------- */

    if ($request->isMethod('POST')) {
//         if (true) {

//     $gstData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "request_id" => "mock-request-id",
//         "client_ref_num" => "test",
//         "result" => [
//             "count" => 2,
//             "gstinResList" => [
//                 [
//                     "gstin" => "27AAJCN6404D1ZM",
//                     "authStatus" => "Active",
//                     "state" => "Maharashtra",
//                     "stateCd" => "27"
//                 ],
//                 [
//                     "gstin" => "29AAJCN6404D1ZP",
//                     "authStatus" => "Active",
//                     "state" => "Karnataka",
//                     "stateCd" => "29"
//                 ]
//             ]
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.gstin_pan_search', compact(
//         'gstData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }
        $request->validate([
            'pan' => 'required|string|min:10|max:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'pan' => $request->pan
        ];

        /* ---------------- NON-DEMO FLOW ---------------- */

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'gstpansearch')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/gstin-pan-search',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $gstData = json_decode($res->getBody(), true);
                $statusCode = $gstData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification Failed. Please enter correct PAN.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.gstin_pan_search', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }

        }

        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/gstin-pan-search',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 15,
                            'connect_timeout' => 5
                        ]
                    );

                    $gstData = json_decode($res->getBody(), true);
                    $statusCode = $gstData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification Failed. Please enter correct PAN.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.gstin_pan_search', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.gstin_pan_search', compact(
                    'gstData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.gstin_pan_search', compact(
            'gstData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function bankPassbook_ocr(Request $request)
{
    $statusCode = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $bankData = null;

    
    if ($request->isMethod('get')) {
        return view(
            'kyc.bankPassbook_ocr',
            compact('bankData', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance')
        );
    }

    
    if ($request->isMethod('post')) {

        if (!$request->hasFile('file')) {
            $errorMessage = "File is required.";
            return view('kyc.bankPassbook_ocr', compact('bankData', 'errorMessage'));
        }

        
        if (Auth::user()->scheme_type != 'demo') {

            $accessToken = Auth::user()->access_token;

            $curl = curl_init();
            curl_setopt_array($curl, [
                CURLOPT_URL => url('/api/bank-passbook-ocr'), 
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_CUSTOMREQUEST => 'POST',
                CURLOPT_HTTPHEADER => [
                    "AccessToken: $accessToken"
                ],
                CURLOPT_POSTFIELDS => [
                    'file' => new \CURLFile(
                        $_FILES['file']['tmp_name'],
                        $_FILES['file']['type'],
                        $_FILES['file']['name']
                    ),
                    'client_ref_id' => uniqid('bspb_'),
                    'account_holder_name' => $request->account_holder_name ?? ''
                ],
            ]);

            $response = curl_exec($curl);
            curl_close($curl);

            $bankData = json_decode($response, true);

            if (isset($bankData['statusCode']) && $bankData['statusCode'] == 200) {
                return view('kyc.bankPassbook_ocr', compact('bankData'));
            }

            $errorMessage = $bankData['message'] ?? 'Internal Server Error.';
            return view('kyc.bankPassbook_ocr', compact('bankData', 'errorMessage'));
        }

       
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                $user = User::where('id', Auth::user()->id)->first();
                $user->scheme_hit_count += 1;
                $user->save();

                $accessToken = Auth::user()->access_token;

                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => url('http://regtechapi.in/api/bank-passbook-ocr'),
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_HTTPHEADER => [
                        "AccessToken: $accessToken"
                    ],
                    CURLOPT_POSTFIELDS => [
                        'file' => new \CURLFile(
                            $_FILES['file']['tmp_name'],
                            $_FILES['file']['type'],
                            $_FILES['file']['name']
                        ),
                        'client_ref_id' => uniqid('bspb_'),
                        'account_holder_name' => $request->account_holder_name ?? ''
                    ],
                ]);

                $response = curl_exec($curl);
                curl_close($curl);

                $bankData = json_decode($response, true);

                if (isset($bankData['statusCode']) && $bankData['statusCode'] == 200) {
                    return view('kyc.bankPassbook_ocr', compact('bankData'));
                }

                $errorMessage = $bankData['message'] ?? 'Internal Server Error.';
                return view('kyc.bankPassbook_ocr', compact('bankData', 'errorMessage'));
            }

         
            $hit_limits_exceeded = 1;
            return view(
                'kyc.bankPassbook_ocr',
                compact('bankData', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance')
            );
        }
    }
}

public function mobile_to_udyam_search(Request $request)
{
    $statusCode = null;
    $udyamData = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $api_id = null;


    if ($request->isMethod('GET')) {
        return view('kyc.mobile_to_udyam_search', compact(
            'udyamData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }

    
    if ($request->isMethod('POST')) {
    
// if (true) {

//     $udyamData = [
//         "http_response_code" => 200,
//         "result_code" => 101,
//         "request_id" => "mock-udyam-request-id",
//         "client_ref_num" => "test_udyam",
//         "mobile" => "8470067555",
//         "result" => [
//             [
//                 "udyam_number" => "UDYAM-MH-26-0194830",
//                 "enterprise_name" => "M/S ZAPFIN TEKNOLOGIES PRIVATE LIMITED"
//             ],
//             [
//                 "udyam_number" => "UDYAM-MH-26-0685022",
//                 "enterprise_name" => "NovaCred Private Limited"
//             ]
//         ]
//     ];

//     $statusCode = 200;

//     return view('kyc.mobile_to_udyam_search', compact(
//         'udyamData',
//         'statusCode',
//         'hit_limits_exceeded',
//         'low_wallet_balance'
//     ));
// }


        $request->validate([
            'mobile' => 'required|digits:10'
        ]);

        $client = new Client();
        $accessToken = Auth::user()->access_token;

        $headers = [
            'AccessToken' => $accessToken,
        ];

        $body = [
            'mobile' => $request->mobile,
            'client_ref_num' => uniqid('mobile_udyam_')
        ];

        if (Auth::user()->scheme_type != 'demo') {

            if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'mobiletoudyam')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }

            try {

                $res = $client->post(
                    'http://regtechapi.in/api/mobile-to-udyam',
                    [
                        'headers' => $headers,
                        'json'    => $body
                    ]
                );

                $udyamData = json_decode($res->getBody(), true);
                $statusCode = $udyamData['http_response_code'] ?? $res->getStatusCode();

            } catch (BadResponseException $e) {

                $statusCode = $e->getResponse()->getStatusCode();

                if ($statusCode == 500) {
                    $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                } elseif ($statusCode == 422) {
                    $errorMessage = 'Verification failed. Please enter correct mobile number.';
                } else {
                    $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                }

                return view('kyc.mobile_to_udyam_search', compact(
                    'statusCode',
                    'errorMessage'
                ));
            }
        }
         else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining =
                $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                try {

                    $res = $client->post(
                        'http://regtechapi.in/api/mobile-to-udyam',
                        [
                            'headers'         => $headers,
                            'json'            => $body,
                            'timeout'         => 15,
                            'connect_timeout' => 5
                        ]
                    );

                    $udyamData = json_decode($res->getBody(), true);
                    $statusCode = $udyamData['http_response_code'] ?? $res->getStatusCode();

                    $user = User::where('id', Auth::user()->id)->first();
                    $user->scheme_hit_count += 1;
                    $user->save();

                } catch (BadResponseException $e) {

                    $statusCode = $e->getResponse()->getStatusCode();

                    if ($statusCode == 500) {
                        $errorMessage = 'Internal server error. Please contact techsupport@docboyz.in.';
                    } elseif ($statusCode == 422) {
                        $errorMessage = 'Verification failed. Please enter correct mobile number.';
                    } else {
                        $errorMessage = 'Error. Please contact techsupport@docboyz.in.';
                    }

                    return view('kyc.mobile_to_udyam_search', compact(
                        'statusCode',
                        'errorMessage'
                    ));
                }

            } else {

                $hit_limits_exceeded = 1;

                return view('kyc.mobile_to_udyam_search', compact(
                    'udyamData',
                    'statusCode',
                    'hit_limits_exceeded',
                    'low_wallet_balance'
                ));
            }
        }

        return view('kyc.mobile_to_udyam_search', compact(
            'udyamData',
            'statusCode',
            'hit_limits_exceeded',
            'low_wallet_balance'
        ));
    }
}
public function cheque_ocr(Request $request)
{
    $statusCode = null;
    $hit_limits_exceeded = 0;
    $low_wallet_balance = 0;
    $chequeData = null;

    
    if ($request->isMethod('get')) {
        return view(
            'kyc.cheque_ocr',
            compact('chequeData', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance')
        );
    }

   
    if ($request->isMethod('post')) {

        if (!$request->hasFile('file')) {
            $errorMessage = "File is required.";
            return view('kyc.cheque_ocr', compact('chequeData', 'errorMessage'));
        }

    
        if (Auth::user()->scheme_type != 'demo') {

            $accessToken = Auth::user()->access_token;
              if (Auth::user()->role_id == 1) {
                $apiamster = ApiMaster::where('api_slug', 'chequeocr')->first();
                if ($apiamster) {
                    $api_id = $apiamster->id;
                }
            }
            $curl = curl_init();
            curl_setopt_array($curl, [
                CURLOPT_URL => url('http://regtechapi.in/api/cheque-ocr'),
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_CUSTOMREQUEST => 'POST',
                CURLOPT_HTTPHEADER => [
                    "AccessToken: $accessToken"
                ],
                CURLOPT_POSTFIELDS => [
                    'file' => new \CURLFile(
                        $_FILES['file']['tmp_name'],
                        $_FILES['file']['type'],
                        $_FILES['file']['name']
                    ),
                    'client_ref_id' => uniqid('chq_'),
                    'account_holder_name' => $request->account_holder_name ?? '',
                    'is_complete_image' => 'yes'
                ],
            ]);

            $response = curl_exec($curl);
            curl_close($curl);

            $chequeData = json_decode($response, true);

            if (isset($chequeData['statusCode']) && $chequeData['statusCode'] == 200) {
                return view('kyc.cheque_ocr', compact('chequeData'));
            }

            $errorMessage = $chequeData['message'] ?? 'Internal Server Error.';
            return view('kyc.cheque_ocr', compact('chequeData', 'errorMessage'));
        }

        
        else {

            $scheme_type = SchemeTypeMaster::where(
                'id',
                Auth::user()->scheme_type_id
            )->first();

            $hit_count_remaining = $scheme_type->hit_limits - Auth::user()->scheme_hit_count;

            if ($hit_count_remaining > 0) {

                $user = User::where('id', Auth::user()->id)->first();
                $user->scheme_hit_count += 1;
                $user->save();

                $accessToken = Auth::user()->access_token;

                $curl = curl_init();
                curl_setopt_array($curl, [
                    CURLOPT_URL => url('/api/cheque-ocr'),
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_CUSTOMREQUEST => 'POST',
                    CURLOPT_HTTPHEADER => [
                        "AccessToken: $accessToken"
                    ],
                    CURLOPT_POSTFIELDS => [
                        'file' => new \CURLFile(
                            $_FILES['file']['tmp_name'],
                            $_FILES['file']['type'],
                            $_FILES['file']['name']
                        ),
                        'client_ref_id' => uniqid('chq_'),
                        'account_holder_name' => $request->account_holder_name ?? '',
                        'is_complete_image' => 'yes'
                    ],
                ]);

                $response = curl_exec($curl);
                curl_close($curl);

                $chequeData = json_decode($response, true);

                if (isset($chequeData['statusCode']) && $chequeData['statusCode'] == 200) {
                    return view('kyc.cheque_ocr', compact('chequeData'));
                }

                $errorMessage = $chequeData['message'] ?? 'Internal Server Error.';
                return view('kyc.cheque_ocr', compact('chequeData', 'errorMessage'));
            }

            
            $hit_limits_exceeded = 1;
            return view(
                'kyc.cheque_ocr',
                compact('chequeData', 'statusCode', 'hit_limits_exceeded', 'low_wallet_balance')
            );
        }
    }
}

}



